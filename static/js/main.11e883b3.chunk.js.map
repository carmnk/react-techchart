{"version":3,"sources":["Chart/Types/CChartStateTypes.ts","Chart/CChartDataSchema.ts","Chart/Types/CChartTypes.ts","Chart/CChartLabel.tsx","Chart/CChartCrosshair.tsx","Chart/Charts/CCandleChart.tsx","Chart/utils.ts","Chart/Charts/CLineChart.tsx","Chart/Charts/CBarChart.tsx","Chart/Time/CChartDateTime.ts","Chart/Time/CChartPeriod.ts","Chart/CChartModel.ts","Chart/Time/CChartDateStat.ts","Chart/ChartState/CChartStateReducer.ts","Chart/ChartState/CChartStateMethods.ts","Chart/ChartState/CChartStateXaxis.ts","Chart/ChartState/CChartStateYaxis.ts","Chart/ChartState/CChartStateInteractions.ts","Chart/ChartState/CChartState.ts","Chart/Tools/CTrendline.tsx","Chart/Tools/CVLine.tsx","Chart/Tools/CHLine.tsx","Chart/MuiTheme.ts","Chart/Menu2/ChartMenuHome.tsx","Chart/CIndicator.ts","Chart/CTreeItem.tsx","Chart/Colorpicker.tsx","Chart/Menu2/ChartMenuIndicators.tsx","Chart/Menu2/ChartMenuTools.tsx","Chart/Menu2/ChartMenuSettings.tsx","Chart/Menu2/ChartMenuQuickys.tsx","Chart/CSnackbar.tsx","Chart/Menu2/ChartMenuChart.tsx","Chart/Menu2/ChartMenu.tsx","Chart/CChart.tsx","App.tsx","reportWebVitals.js","index.js"],"names":["isIndicatorGraph","graph","type","isChartGraph","chartDataSchema","minItems","items","properties","data","nullable","date","open","high","low","close","required","name","isCandleChartDataset","dataset","isLineChartDataset","isVolumeDataset","isIndicatorDataset","CChartLabel","props","decimals","onClick","top","style","position","left","Button","textTransform","startIcon","path","mdiChartBellCurve","mdiChartLine","size","color","Typography","prices","map","price","toFixed","join","variant","CChartCrosshair","fullState","containerWidth","containerSize","width","containerHeight","height","widthYAxis","yaxis","xaxis","heightXAxis","heightTickMarkLines","pixYSnap","ySnap","pointer","move","xy","i","subCharts","length","subchart","j","graphs","chartPointer","snapDatasets","subchartIdx","findIndex","val","bottom","methods","pixToY","curgraph","indicator","default","Math","round","parseFloat","pow","toString","Fragment","x","y","points","xToPix","pixToX","stroke","strokeWidth","sceneFunc","context","shape","ctx","_context","yStart","moveTo","lineTo","fillStrokeShape","fill","font","fontSize","fontName","fillStyle","fontColor","textAlign","textBaseline","fillText","widthTickmarkLines","xUnlimited","xEnd","xStart","dateString","CCandleChart","curData","dxHalfCandle","forEach","valIdx","idx","widthPerTick","floor","beginPath","datasetIdx","xPix","pixXStart","yPixHigh","yToPix","yPixLow","yPixClose","closePath","candleStrokeColor","filter","gainDataset","gainDatasetIdx","yPixOpen","maxWidth","pixXEnd","rect","candleUpColor","candleDownColor","isNullish","undefined","isNaN","getDecimals","split","includesOne","array","res","params","param","includes","colorNames","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","hexToRgb","hex","replace","m","r","g","b","result","exec","parseInt","CLineChart","yaxisIdx","graphIdx","indSeriesIdxIn","indSeriesIdx","graphVals","Array","isArray","push","flat","graphValsNN","strokeColor","CBarChart","volume","yPixVol","yPix0","getDateString","period","format","getDateSubValue","getMinutes","getHours","getDate","getISOWeek","getMonth","getYear","getDateObject","minute","hour","day","week","month","year","chartPeriods","minutes","scaleMultiplys","range","hours","days","weeks","months","years","getOptimalPeriod","metaData","noDataPortion","dateStat","chartPeriod","periodsConstIdx","chartPeriodName","nCurrent","curDateStat","Object","assign","nInDateStat","accAmt","keys","key","keyIdx","targetIntervals","opt","optPeriod","optMultiply","multiply","abs","isNewYear","curYearDateStat","thisMonthStat","isNewMonth","curMonthIdx","periodMultiply","isNewIsoWeek","curWeekIdx","daysInMonth","curDays","optWeekIdx","optimalDaysTarget","weekInMonth","isNewPeriod","optPeriodName","curYearStat","e","curMonthStat","curMonthStatIdx","indexOf","curWeekStat","curWeekStatIdx","curDayStat","curDayStatIdx","curDayIdx","isNewDay","getGraphMetaData","dataSeries","nData","getDeltaT","dataPoint1","dataPoint0","deltaPeriods","dT","amt","curWeek","curYear","curWeekDays","weekDays","deltaPeriod","iDataWeek","iyear","weekDaysFiltered","amtDays","console","log","weekDayIdx","occ","datasetDecimals","curDataset","maxDecimals","max","deltaTs","item","amts","maxIdx","reduce","arr","maxDaysPerWeekOccurences","totalOcc","maxDaysPerWeekOccIdx","maxDaysPerWeek","maxDaysPerWeekGuessConfidence","isDesc","dataPeriod","dataPeriodKeys","chartPeriodKey","chartPeriodRange","getChartPeriod","periodGuessConfidence","tradingDaysPerWeek","tradingDaysPerWeekGuessConfidence","isDescending","createSubChartModel","chartData","chartName","createYaxisModel","newGraph","createIndicatorGraphModel","createChartGraphModel","tools","translatedY","optIntervalY","heightPerPt","drawTicks","graphProps","reverse","stat","makeSingleDayStat","makeSingleWeekStat","makeSingleMonthStat","makeSingleYearStat","incrementPeriodAccAmt","addPeriod","curStatIdx","addOrIncrementPeriod","periodStat","periodStatFilter","filteredStatIdx","nextLowerPeriod","getDateStat","meta","yMax","yMaxExact","yMin","yMinExact","datasets","first","last","indicatorData","indicatorFn","decimalsData","graphColorsLight","getGraphColors","colorArr","isSetCandleChartUpColor","action","task","isSetCandleChartDownColor","isSetCandleChartStrokeColor","isSetToolStrokeColorAction","isSetToolAnchorColor","chartStateReducer","current","isAddSubchartAction","chartSeries","reset","minMainHeight","heightNewSubchart","min","totalTranslatedX","scaledWidthPerTick","maxHeight","subChart","subChartIdx","isRemoveSubchartAction","dHeight","dHeightEach","dHeightRest","slice","subchartSliced","subchartSlicedIdx","isRemoveGraphAction","isClearChartAction","mode","isAddGraphAction","isDrawAction","draw","isDrawing","pixXy","isSetBackgroundColorAction","backgroundColor","isSetGridStrokeColorAction","grid","isSetAxisFillColorAction","fillColor","isSetAxisStrokeColorAction","isSetAxisTextColorAction","isToggleXaxisGridAction","useGridX","isToggleYaxisGridAction","useGridY","isToggleFullscreenAction","fullscreen","isSetLineChartStrokeColor","prop","toolIdx","isSetIndicatorParam","paramIdx","indicatorGraph","fn","srcData","isSetHlineYlevelAction","newAnchor","isUpdateInteractionState","newState","getChartMethods","ChartState","Dispatch","addGraph","addSubchart","getSubchart","getYaxis","getGraph","translatedX","pixX","stateTranslatedY","translatedYint","pixY","pureXToPix","translated","purePixToX","pureYToPix","pixYBottom","pixPerPt","purePixToY","snapPixYToPrices","subcharts","snapTolerance","snapTol","snapRes","priceIdx","yPixPrice","sort","a","calculateCurrentGraphs","pixXstart","pixXend","calculatedSubcharts","mainYaxis","yMinExactAllGraphs","yMaxExactAllGraphs","graphM","fixedYScale","intervalsTarget","dec","targetSteps","initIntervalStep","curIntervalStep","optIntervalStep","optimizationFunction","steps","optimizer","factor","curOptimizerRes","GetYOptInterval","yMaxAllGraphs","yMinAllGraphs","ceil","y_bottom","yi","yvalstr","label","getSubchartIdxByVector","getDragActionType","dragInitXy","isEditing","canvasWidth","canvasHeight","init","editToolPath","toolsIdx","singleYaxis","singleYaxisIdx","tool","anchorXy","anchorIdx","getToolsByXy","resizeSubchartIdx","getSubchartIdxByBottom","initBottom","editToolPosition","dragActionType","curPixX","pixXSnap","drag","curPixY","initX","initial","subIdx","yAdjusted","localInitY","newPixX","newPixY","newX","newY","toolsSubIdx","toolsYaxisIdx","resizeSubchart","newBottom","addToolAnchor","drawToolType","dragpixXy","dequal","require","defaultState","totalScaleX","startNoDataPeriod","endNoDataPeriod","noDataPeriodPortion","optPeriodRes","xAxisTicks","strokeStyle","isHovering","isMoving","wheel","isWheeling","delta","dragPointerUp","isDragPointerUp","movementInitial","isDragging","xDateString","click","clickedSubchartIdx","useChartState","HtmlElementRef","settings","maxUpdatesPerSec","initWidthPerTick","viewModeInternal","viewMode","React","useReducer","PreStateRef","useRef","tmp","scaleInitWidthPerTick","scaleInitTranslatedX","amtLastSubcharts","lastMainChartData","lastUpdate","Date","shallUpdate","userInteractedChartState","useGesture","onDrag","dragState","deltaX","deltaY","movement","active","onMove","moveState","onHover","hoverState","onWheel","wheelState","onDragEnd","domTarget","transform","useTouch","experimental_preventWindowScrollY","useEffect","clientWidth","clientHeight","getBoundingClientRect","handleWindowResize","parentElement","addEventListener","window","removeEventListener","userInteractedSubcharts","addIndicatorDeps","onTimer","PreState","DragEndState","DragState","currentPointer","widthYaxis","widthChart","heightChart","heightXaxis","calcSubcharts","calcXaxis","calcDraw","dHproportionalTmp","newMainSizeTmp","dHeightMain","dHeightSingleSubchart","currentRest","lastBottom","correctRest","tempRest","sign","newTop","dragInit","mainGraph","currentXaxis","initWidthTickX","shallUpdateDrag","clickedChart","clickedXaxis","nDatasets","wheeldY","initWheelMousePos","scaleFn","translatedXonStart","initPixX","initXexact","getInteractiveXaxisState","translatedPixX","nMainData","pixXi","xi","periodToDraw","calculateCurrentXaxis","calcCurrentSubchart","xpointerRes","xIdx","xPointerUnlimited","xPointer","xPointerDateStr","pixXPointer","calculateXPointer","xpointer","xpointerUnlimited","xPointerDateString","getSubchartIdx","snapPriceRes","calculateCurrentPointerDataset","nPoints","xyArr","pixXyIdx","anchorColor","addTool","state","handleTimer","setInterval","clearInterval","CTrendline","subchartTop","subchartBottom","modeInt","pixXyAdjusted","dx","dy","slope","pixYTarget","pixXTarget","pixYSrc","pixXSrc","radius","CVline","CHline","muiTheme","localTheme","createMuiTheme","palette","primary","main","secondary","typography","h1","fontFamily","fontWeight","lineHeight","h2","h3","h4","h5","h6","responsiveFontSizes","ChartMenuHome","onNavigate","useMediaQuery","theme","useTheme","List","ListItem","button","ListItemIcon","border","borderRadius","marginRight","background","minWidth","contrastText","ListItemText","primaryTypographyProps","mdiPencilRuler","mdiTune","mdiStarShooting","iSMA","srcChartData","srcChartName","srcDataset","srcDatasetIdx","singleSmaAcc","selSrcDataset","newSubchart","iEMACalc","initSMA","multiplier","ema","iEMA","iATR","singleValAcc","dataset1","singleAtr","hl","hc1","lc1","iRSI","calcData","dClose","up","dwn","w","lastUpEma","lastDwnEma","upSmoothed","dwnSmoothed","rsi","iOBV","obv","iVolume","iMACD","periodEmaShort","periodEmaLong","periodSignal","emaShort","emaLong","macd","emaLongVal","emaShortVal","priceLabels","signal","macdComplete","macdVal","macdIdx","macdValPrice","signalVal","macdHistogramm","useTreeItemStyles","makeStyles","createStyles","root","text","hover","grey","content","borderTopRightRadius","spacing","borderBottomRightRadius","paddingRight","fontWeightMedium","fontWeightRegular","group","marginLeft","paddingLeft","expanded","selected","labelRoot","display","alignItems","padding","labelRootBtn","btnLabel","labelIcon","labelText","flexGrow","CTreeItem","classes","LabelIcon","labelInfo","bgColor","onLabelClick","onIconClick","labelTypographyVariant","infoTypographyVariant","labelTypographyColor","infoTypographyColor","other","TreeItem","className","rgbaColor","ColorRect","container","boxSizing","Colorpicker","onColorSelected","useState","Open","setOpen","ColorHover","setColorHover","InputRef","isHex","test","hexToRgbRes","isRgb","match","isRgba","rgbInternal","colorNameRes","alphaProp","AlphaVal","setAlphaVal","IconButton","ref","Popover","id","anchorEl","onClose","anchorOrigin","vertical","horizontal","transformOrigin","Grid","alignContent","justify","margin","clr","clrIdx","xs","onMouseOver","onMouseLeave","Slider","value","onChange","TextField","inputProps","target","borderTop","paddingBottom","component","align","fullWidth","onIndicatorLabelClick","indi","CIndicatorGraphTreeItem","ChartStateDispatch","graphGeneric","nodeId","Icon","preventDefault","mdiClose","mdiBorderColor","mdiIframeVariableOutline","defaultValue","ChartMenuIndicators","FilterCat","setFilterCat","categorys","icon","mdiDiameterVariant","mdiArrowExpandVertical","mdiPoll","indicators","category","amtIndicators","yaxixsIdx","fgraph","acc","cur","right","zIndex","ToggleButtonGroup","exclusive","ToggleButton","borderBottomLeftRadius","borderTopLeftRadius","light","alert","mdiMagnify","mdiSortAlphabeticalAscending","mdiFilter","TreeView","defaultCollapseIcon","mdiMenuDown","defaultExpandIcon","mdiMenuRight","defaultEndIcon","disableSelection","cat","catIdx","indiIdx","onToolLabelClick","CToolTreeItem","toolIn","mdiMinus","mdiHelp","rotate","mdiArrowSplitHorizontal","mdiBullseye","ChartMenuTools","mdiRuler","mdiRulerSquareCompass","amtTools","ChartMenuSettings","setAnchorEl","handleClose","event","currentTarget","Menu","keepMounted","Boolean","MenuItem","mdiFileChartOutline","mdiWater","mdiFormatText","mdiGrid","Checkbox","checked","mdiChartAreaspline","ChartMenuQuickys","mdiBroom","Alert","elevation","CSnackBar","reason","Snackbar","autoHideDuration","severity","parse","useStyles","popper","tooltip","parseCsvFileObj","then","dataString","rowDelimiter","chars","rowDelimiterAmts","guessedRowDelimiter","rows","delimiter","delimiterAmts","del","guessedDelimiter","amtDecDel","dots","commas","row","lastDot","lastIndexOf","lastComma","isCommaDecDel","isCommaDigitSeparator","newDataString","replaceAll","parseRes","record_delimiter","cast","trim","cast_date","shift","ChartMenuChart","IsError","setIsError","HiddenInputRef","ShowUrlPopup","setShowUrlPopup","CsvUrl","setCsvUrl","evt","files","fetchCsvFromURL","fetch","resp","Error","file","visibility","mdiFileDelimitedOutline","Tooltip","PopperProps","disablePortal","title","helperText","onKeyUp","InputProps","endAdornment","mdiArrowRightThick","interactive","arrow","placement","mdiWeb","paper","minHeight","paperDesktop","CChartMenu2","isMinSm","Drawer","anchor","ModalProps","hideBackdrop","mdiHome","mdiFullscreen","ajv","Ajv","CChart","ContainerRef","ChartMenu2Open","setChartMenu2Open","isContainerInit","validate","compile","errors","xAxis","ThemeProvider","listening","stateGraph","indicatorType","indicatorLines","indicatorDataSeries","indDataSeriesIdx","xaxisTick","xaxisTickIdx","yaxisTick","yaxisTickIdx","tmpDataset","opacity","mdiMenu","App","Data","setData","response","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.11e883b3.chunk.js","sourcesContent":["/** Data types */\r\n\r\nimport {\r\n  CommonGestureState,\r\n  Coordinates,\r\n  DragState,\r\n  FullGestureState,\r\n  SharedGestureState,\r\n} from \"react-use-gesture/dist/types\";\r\nimport { ExcludeEmpty, ReducerActionTaskType, ReducerActionType } from \"../ChartState/CChartStateReducer\";\r\nimport { ChartPeriodType, DateStatType } from \"./CChartTimeTypes\";\r\nimport { ChartDataSeries, ChartDataset, DataSeries, IndicatorDataSeries, IndicatorDataset } from \"./CChartTypes\";\r\n\r\nexport type UseGestureStateType = {\r\n  drag: CommonGestureState & Coordinates & DragState & SharedGestureState;\r\n  move: Omit<FullGestureState<\"move\">, \"event\"> & {\r\n    event: React.PointerEvent<Element> | PointerEvent;\r\n  };\r\n  hover: Omit<FullGestureState<\"move\">, \"event\"> & {\r\n    event: React.PointerEvent<Element> | PointerEvent;\r\n  };\r\n  wheel: CommonGestureState & Coordinates;\r\n  dragEnd: CommonGestureState & Coordinates & DragState & SharedGestureState;\r\n};\r\n\r\n/** Interactive State */\r\nexport type InteractiveContainerSizeType = {\r\n  top: number;\r\n  left: number;\r\n  width: number;\r\n  height: number;\r\n  init: boolean;\r\n};\r\n\r\nexport type InteractivePointerType = {\r\n  isHovering: boolean;\r\n  move: { isMoving: boolean; xy: [number, number] };\r\n  drag: {\r\n    isDragging: boolean;\r\n    xy: [number, number];\r\n    initial: [number, number];\r\n    delta: [number, number];\r\n    first: boolean;\r\n    last: boolean;\r\n    movementInitial: [number, number];\r\n  };\r\n  dragPointerUp: {\r\n    isDragPointerUp: boolean;\r\n    xy: [number, number];\r\n    initial: [number, number];\r\n    first: boolean;\r\n    last: boolean;\r\n    movementInitial: [number, number];\r\n  };\r\n  wheel: { isWheeling: boolean; delta: [number, number] };\r\n  chartPointer: {\r\n    move: {\r\n      pixX: number;\r\n      pixXSnap: number;\r\n      pixY: number;\r\n      x: number|null;\r\n      xUnlimited : number;\r\n      xDateString: string;\r\n      subchartIdx: number;\r\n      snapDatasets: {\r\n        yaxisIdx: number;\r\n        graphIdx: number;\r\n        y: number;\r\n        ySnap: string | null;\r\n        pixYSnap: number | null;\r\n        data: ChartDataset | IndicatorDataset;\r\n        dateString: string;\r\n      }[];\r\n    };\r\n    click: {\r\n      clickedSubchartIdx: number | null;\r\n    };\r\n  };\r\n};\r\n\r\nexport type InteractiveXaxisCalcs = {\r\n  xStart: number;\r\n  pixXStart: number;\r\n  xEnd: number;\r\n  pixXEnd: number;\r\n  widthPerTick: number;\r\n  startNoDataPeriod: number;\r\n  endNoDataPeriod: number;\r\n  noDataPeriodPortion: number;\r\n  xAxisTicks: { x: number; dateString: string }[];\r\n  optPeriodRes: ChartPeriodType | null;\r\n};\r\n\r\nexport type InteractiveXaxisType = {\r\n  totalTranslatedX: number;\r\n  totalScaleX: number; //only int\r\n  scaledWidthPerTick: number;\r\n} & InteractiveXaxisCalcs;\r\n\r\nexport type InteractiveStateType = {\r\n  pointer: InteractivePointerType;\r\n  containerSize: InteractiveContainerSizeType;\r\n  xaxis: InteractiveXaxisType;\r\n};\r\n\r\n///////////////////////////////////////\r\n\r\nexport type ChartPreStateRefType = InteractiveStateType & {\r\n  lastUpdate: Date;\r\n  shallUpdate: (\"drag\" | \"pointerMove\" | \"wheel\" | \"dragEnd\" | \"containerResize\" | \"deps\")[];\r\n  tmp: {\r\n    scaleInitWidthPerTick: number | null;\r\n    scaleInitTranslatedX: number;\r\n    amtLastSubcharts: number;\r\n    lastMainChartData: ChartDataSeries;\r\n    dragActionType:\r\n      | null\r\n      | { type: \"translate\" | \"scale\" }\r\n      | { type: \"resizeSubchart\"; res: number; initBottom: number }\r\n      | { type: \"editTool\"; res: [number, number, number, number][]; init: [number, number] }\r\n      | { type: \"drawTool\"; init: [number, number] };\r\n  };\r\n  userInteractedChartState: any;\r\n};\r\n\r\n/** SubCharts State */\r\nexport type GraphStateType<AdditionalGraphProps = {}> = {\r\n  data: DataSeries;\r\n  style: {\r\n    strokeColor: string[];\r\n  };\r\n  name: string;\r\n  type: \"chart\" | \"indicator\" | \"formula\";\r\n  decimals: number;\r\n  curData?: GraphStateType[\"data\"];\r\n  yMax: number;\r\n  yMaxExact: number;\r\n  yMin: number;\r\n  yMinExact: number;\r\n  // drawPixXy: [number, number][];\r\n  datasets: {\r\n    first: {\r\n      x: number;\r\n      pixX: number;\r\n      data: ChartDataset | IndicatorDataset;\r\n      dateString: string;\r\n    } | null;\r\n    last: {\r\n      x: number;\r\n      pixX: number;\r\n      data: ChartDataset | IndicatorDataset;\r\n      dateString: string;\r\n    } | null;\r\n  };\r\n} & AdditionalGraphProps;\r\n\r\nexport type AdditionalChartGraphStateType = {\r\n  data: ChartDataSeries;\r\n  dateStat: DateStatType;\r\n  meta: {\r\n    nData: number;\r\n    chartPeriod: ChartPeriodType | null;\r\n    dataPeriod: number;\r\n    periodGuessConfidence: number;\r\n    tradingDaysPerWeek: number;\r\n    tradingDaysPerWeekGuessConfidence: number;\r\n    type: \"candlechart\" | \"linechart\";\r\n  };\r\n  style: {\r\n    candleStrokeColor: string;\r\n    candleDownColor: string;\r\n    candleUpColor: string;\r\n  };\r\n};\r\n\r\nexport type AdditionalIndicatorGraphStateType = {\r\n  data: IndicatorDataSeries;\r\n  indicator: {\r\n    name: string;\r\n    params: { name: string; val: number }[];\r\n    type: \"line\" | \"bars\";\r\n    default: {\r\n      params: { name: string; val: number }[];\r\n      newSubchart: boolean;\r\n      fixedYScale?: [number, number]; //\r\n      decimals?: number; //\r\n    };\r\n    indicatorFn: (chartData: ChartDataset[], chartName: string, ...other: any[]) => IndicatorDataSeries;\r\n    \r\n  };\r\n};\r\n\r\nexport type ChartGraphStateType = GraphStateType<AdditionalChartGraphStateType>;\r\nexport type IndicatorGraphStateType = Omit<GraphStateType, \"data\" | \"style\"> &\r\n  AdditionalIndicatorGraphStateType & {\r\n    style: {\r\n      strokeColor: string[];\r\n    };\r\n  };\r\n\r\nexport const isIndicatorGraph = (graph: GraphStateType): graph is GraphStateType<AdditionalIndicatorGraphStateType> => {\r\n  if (graph.type === \"indicator\") return true;\r\n  return false;\r\n};\r\nexport const isChartGraph = (graph: GraphStateType): graph is GraphStateType<AdditionalChartGraphStateType> => {\r\n  if (graph.type === \"chart\") return true;\r\n  return false;\r\n};\r\nexport type DrawingTool = {\r\n  xy: [number, number][];\r\n  type: \"hline\" | \"vline\" | \"trendline\";\r\n  style: {\r\n    strokeColor: string;\r\n    anchorColor: string;\r\n  };\r\n  params?: { [key: string]: any };\r\n};\r\n\r\nexport type userInteractsSubchartStateType = {\r\n  yaxis: {\r\n    graphs: {\r\n      data?: DataSeries;\r\n      style: {\r\n        strokeColor: string[];\r\n      };\r\n      name: string;\r\n      type: \"chart\" | \"indicator\" | \"formula\";\r\n      decimals: number;\r\n    }[];\r\n    tools: Pick<DrawingTool, \"params\" | \"type\" | \"style\">[];\r\n    decimals: number;\r\n  }[];\r\n  // top: number;\r\n  // bottom: number;\r\n}[];\r\n\r\nexport type SubchartStateType = {\r\n  yaxis: YaxisStateType[];\r\n  top: number;\r\n  bottom: number;\r\n};\r\n\r\nexport type YaxisStateType<pure = \"false\"> = {\r\n  graphs: GraphStateType[];\r\n  tools: DrawingTool[];\r\n  decimals: number;\r\n\r\n  optIntervalY: number;\r\n  heightPerPt: number; // yaxis\r\n  translatedY: number; // yaxis\r\n  drawTicks: { pixY: number; label: string }[];\r\n};\r\n\r\n/** ChartState */\r\n\r\nexport type ChartStateType = {\r\n  xaxis: {\r\n    heightXAxis: number;\r\n    heightTickMarkLines: number;\r\n    style: {\r\n      fillColor: string;\r\n      strokeColor: string;\r\n      fontColor: string;\r\n      fontSize: number;\r\n      fontName: string;\r\n    };\r\n  };\r\n  yaxis: {\r\n    widthYAxis: number;\r\n    widthTickmarkLines: number;\r\n    style: {\r\n      fillColor: string;\r\n      strokeColor: string;\r\n      fontColor: string;\r\n      fontSize: number;\r\n      fontName: string;\r\n    };\r\n  };\r\n  grid: {\r\n    useGridX: boolean;\r\n    useGridY: boolean;\r\n    style: {\r\n      strokeColor: string;\r\n      strokeStyle: string;\r\n    };\r\n  };\r\n  backgroundColor: string;\r\n  fullscreen: boolean;\r\n  subCharts: SubchartStateType[];\r\n  draw: Partial<Omit<DrawingTool, \"xy\">> & { isDrawing: boolean; pixXy: [number, number][] };\r\n} & InteractiveStateType;\r\n\r\n/** CalculatedChartState and Hook */\r\n\r\nexport type CalculatedChartStateType = ChartStateType & {\r\n  methods: {\r\n    addSubchart: (\r\n      chartSeries: DataSeries,\r\n      chartName: string,\r\n      indicator?: AdditionalIndicatorGraphStateType[\"indicator\"],\r\n      reset?: boolean,\r\n    ) => void;\r\n    addGraph: (\r\n      chartSeries: ChartDataset[],\r\n      chartName: string,\r\n      subchartIdx: number,\r\n      indicator?: AdditionalIndicatorGraphStateType[\"indicator\"]\r\n    ) => void;\r\n    getSubchart: (subchartIdx: number) => SubchartStateType;\r\n    getYaxis: (subchartIdx: number, yaxisIdx: number) => YaxisStateType;\r\n    getGraph: (subchartIdx: number, yaxisIdx: number, graphIdx: number) => GraphStateType;\r\n    xToPix: (x: number, translatedX?: number) => number;\r\n    pixToX: (pixX: number, translatedX?: number) => number;\r\n    yToPix: (y: number, subchartIdx: number, yaxisIdx: number, translatedY?: number) => number;\r\n    pixToY: (pixY: number, subchartIdx: number, yaxisIdx: number, translatedY?: number) => number;\r\n  };\r\n  // drawProps: { graphs: number[][]; yaxis: { y: number; label: string }[][] }[];\r\n};\r\nexport type TypedDispatcher<Action extends ReducerActionTaskType> = React.Dispatch<ReducerActionType<Action>>;\r\nexport type ChartStateHookType<Action extends ReducerActionTaskType = ReducerActionTaskType> = [\r\n  CalculatedChartStateType,\r\n  TypedDispatcher<Action>\r\n];\r\n","export const singleChartDataSchema = {\r\n  type: \"object\",\r\n  properties: {\r\n    data: {\r\n      type: \"array\",\r\n      nullable: false,\r\n      minItems: 2,\r\n      items: {\r\n        type: \"object\",\r\n        nullable: false,\r\n        properties: {\r\n          date: {\r\n            type: \"object\",\r\n            nullable: false,\r\n            // format: \"date-time\",\r\n          },\r\n          open: { type: \"number\", nullable: false },\r\n          high: { type: \"number\", nullable: false },\r\n          low: { type: \"number\", nullable: false },\r\n          close: { type: \"number\", nullable: false },\r\n        },\r\n        required: [\"date\", \"close\"],\r\n      },\r\n    },\r\n    name: { type: \"string\", nullable: false },\r\n  },\r\n  required: [\"data\", \"name\"],\r\n};\r\nexport const chartDataSchema = {\r\n  type: \"array\",\r\n  minItems: 1,\r\n  // additionalItems: true,\r\n  items: singleChartDataSchema,\r\n};\r\n","// /** Data types */\r\n// types for single datasets\r\nexport type LineChartDataset = {\r\n  date: Date;\r\n  close: number;\r\n  volume?: number;\r\n};\r\nexport type CandleChartDataset = LineChartDataset & {\r\n  open: number;\r\n  high: number;\r\n  low: number;\r\n};\r\nexport type ChartDataset = LineChartDataset | CandleChartDataset;\r\nexport type IndicatorDataset = {\r\n  prices: (number | null)[];\r\n  date: Date;\r\n  priceLabels?: string[];\r\n};\r\nexport type Dataset = ChartDataset | IndicatorDataset;\r\n\r\n// type for dataseries\r\nexport type ChartDataSeries = ChartDataset[];\r\nexport type IndicatorDataSeries = IndicatorDataset[];\r\nexport type DataSeries = (ChartDataset | IndicatorDataset)[];\r\n\r\n// type guard for candle chart\r\nexport const isCandleChartDataset = (dataset: Dataset): dataset is CandleChartDataset => {\r\n  if (\"open\" in dataset && \"high\" in dataset && \"low\" in dataset && \"close\" in dataset) return true;\r\n  return false;\r\n};\r\n// doesn't exclude datasets with close property (like CandleChartDataset -> e.g. a CandleChartDataset will also return true)\r\nexport const isLineChartDataset = (dataset: Dataset): dataset is LineChartDataset => {\r\n  // if (!dataset) return false; \r\n  if (\"close\" in dataset) return true;\r\n  return false;\r\n};\r\nexport const isVolumeDataset = (dataset: Dataset): dataset is ChartDataset & { volume: number } => {\r\n  if (\"volume\" in dataset) return true;\r\n  return false;\r\n};\r\n\r\nexport const isIndicatorDataset = (dataset: Dataset): dataset is IndicatorDataset => {\r\n  if (\"prices\" in dataset) return true;\r\n  return false;\r\n};\r\n\r\n/** CChart Prop types */\r\n// type for chartData prop\r\nexport type ChartDataProp = { data: ChartDataset[]; name: string }[];\r\n\r\n// todo -> chart styling props\r\nexport type StyleProp = \"TODO\"; \r\n\r\n// type of CChart props\r\nexport type CChartProps = {\r\n  chartData: ChartDataProp;\r\n  style: StyleProp;\r\n  width?: number;\r\n  height?: number;\r\n  viewMode?: \"static\" | \"responsive\" | \"fullscreen\"\r\n};\r\n","import { Button, Typography } from \"@material-ui/core\";\r\nimport { mdiChartBellCurve, mdiChartLine } from \"@mdi/js\";\r\nimport Icon from \"@mdi/react\";\r\nimport React from \"react\";\r\nimport { ChartDataset, Dataset, isCandleChartDataset, isIndicatorDataset } from \"./Types/CChartTypes\";\r\n\r\nexport const CChartLabel = (props: {\r\n  name: string;\r\n  dataset: Dataset;\r\n  decimals?: number;\r\n  onClick?: (name?: string) => any;\r\n  top: number;\r\n}) => {\r\n  const { dataset, name, decimals, onClick, top } = props;\r\n  if (!dataset) return null;\r\n\r\n  return (\r\n    <div style={{ position: \"absolute\", top: 10 + top, left: 10 }}>\r\n      <Button\r\n        style={{textTransform: \"none\"}}\r\n        onClick={() => {\r\n          onClick?.(name);\r\n        }}\r\n        startIcon={<Icon path={isIndicatorDataset(dataset) ? mdiChartBellCurve : mdiChartLine} size={1.0} color=\"#333\" />}\r\n      >\r\n      {isIndicatorDataset(dataset) ? (\r\n        <Typography>{`${name}:${dataset.prices.map((price) => price?.toFixed(decimals)).join(\", \") || \"\"}`}</Typography>\r\n      ) : (\r\n        <Typography variant=\"body1\">\r\n          {isCandleChartDataset(dataset)\r\n            ? `${name}\r\n                O:${dataset.open.toFixed(decimals)}\r\n                H:${dataset.high.toFixed(decimals)}\r\n                L:${dataset.low.toFixed(decimals)}\r\n                C:${dataset.close.toFixed(decimals)}`\r\n            : `${name}\r\n                C:${dataset.close.toFixed(decimals)}`}\r\n        </Typography>\r\n      )}\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Line, Rect, Shape } from \"react-konva\";\r\nimport { chartStateReducer } from \"./ChartState/CChartStateReducer\";\r\nimport { isIndicatorGraph, CalculatedChartStateType } from \"./Types/CChartStateTypes\";\r\nimport { getDecimals } from \"./utils\";\r\n\r\nexport const CChartCrosshair = (props: { fullState: CalculatedChartStateType }) => {\r\n  const { fullState } = props;\r\n  const containerWidth = fullState.containerSize.width - 1;\r\n  const containerHeight = fullState.containerSize.height - 1;\r\n  const { widthYAxis } = fullState.yaxis;\r\n  const { heightXAxis, heightTickMarkLines } = fullState.xaxis;\r\n\r\n  let pixYSnap: number | null = null;\r\n  let ySnap: string | null = null;\r\n  if (!!fullState.pointer.move) {\r\n    pixYSnap = fullState.pointer.move.xy[1];\r\n  }\r\n  for (let i = 0; i < fullState.subCharts.length; i++) {\r\n    const subchart = fullState.subCharts[i];\r\n    for (let j = 0; j < subchart.yaxis[0].graphs.length; j++) {\r\n      const graph = subchart.yaxis[0].graphs[j];\r\n      if (!!fullState.pointer?.chartPointer?.move?.snapDatasets?.[0])\r\n        if (fullState.pointer.chartPointer.move?.snapDatasets[0].pixYSnap !== null) {\r\n          pixYSnap = fullState.pointer.chartPointer.move.snapDatasets[0].pixYSnap;\r\n          ySnap = fullState.pointer.chartPointer.move.snapDatasets[0].ySnap;\r\n        }\r\n    }\r\n  }\r\n  let subchartIdx = -1;\r\n  if (!!fullState.pointer.move) {\r\n    const xy = fullState.pointer.move.xy[1];\r\n    subchartIdx = fullState.subCharts.findIndex((val) => val.bottom >= xy && val.top <= xy);\r\n  }\r\n  if (!ySnap && subchartIdx !== -1)\r\n    ySnap = fullState.methods\r\n      .pixToY(fullState.pointer.move?.xy[1] as number, subchartIdx, 0)\r\n      .toFixed(fullState.subCharts[subchartIdx].yaxis[0].decimals);\r\n  if (!!ySnap && subchartIdx !== -1) {\r\n    const curgraph = fullState.subCharts[subchartIdx].yaxis[0].graphs[0];\r\n    if (isIndicatorGraph(curgraph)) {\r\n      if (!!curgraph.indicator.default.decimals)\r\n        ySnap = (\r\n          Math.round(parseFloat(ySnap) * Math.pow(10, curgraph.indicator.default.decimals)) /\r\n          Math.pow(10, curgraph.indicator.default.decimals)\r\n        ).toString();\r\n    }\r\n  }\r\n\r\n  // console.log(fullState.pointer?.chartPointer?.move?.xUnlimited, fullState.xaxis.xEnd, fullState.xaxis.xStart);\r\n  // console.log(fullState.pointer.move.xy[1], fullState.subCharts[fullState.subCharts.length - 1].bottom);\r\n\r\n  return !!fullState.pointer.move && !!pixYSnap ? (\r\n    <React.Fragment>\r\n      <Line // crosshair x\r\n        x={0}\r\n        y={0}\r\n        points={[\r\n          fullState.methods.xToPix(Math.round(fullState.methods.pixToX(fullState.pointer.move.xy[0]))),\r\n          0,\r\n          fullState.methods.xToPix(Math.round(fullState.methods.pixToX(fullState.pointer.move.xy[0]))),\r\n          containerHeight - heightXAxis + heightTickMarkLines,\r\n        ]}\r\n        stroke=\"black\"\r\n        strokeWidth={1}\r\n      />\r\n\r\n      {fullState.pointer.move.xy[1] <= fullState.subCharts[fullState.subCharts.length - 1].bottom ? (\r\n        <React.Fragment>\r\n          <Line // crosshair y\r\n            x={0}\r\n            y={0}\r\n            points={[0, pixYSnap, containerWidth - widthYAxis, pixYSnap]}\r\n            stroke=\"black\"\r\n            strokeWidth={1}\r\n          />\r\n          <Shape // yaxis marker\r\n            sceneFunc={(context, shape) => {\r\n              const ctx = context._context;\r\n              if (!fullState.pointer.move) return;\r\n              const yStart = pixYSnap as number;\r\n              ctx.moveTo(containerWidth - widthYAxis, yStart);\r\n              ctx.lineTo(containerWidth - widthYAxis + 10, yStart + 10);\r\n              ctx.lineTo(containerWidth, yStart + 10);\r\n              ctx.lineTo(containerWidth, yStart + 1);\r\n              ctx.lineTo(containerWidth, yStart - 10);\r\n              ctx.lineTo(containerWidth - widthYAxis + 10, yStart - 10);\r\n              ctx.lineTo(containerWidth - widthYAxis, yStart);\r\n              // (!) Konva specific method, it is very important\r\n              context.fillStrokeShape(shape);\r\n            }}\r\n            stroke=\"black\"\r\n            fill=\"rgba(199, 0, 57, 1)\"\r\n            strokeWidth={1}\r\n          />\r\n          <Shape // yaxis marker text\r\n            sceneFunc={(context, shape) => {\r\n              const ctx = context._context;\r\n              if (!fullState.pointer.move) return;\r\n              const yStart = pixYSnap as number;\r\n              ctx.font = fullState.yaxis.style.fontSize + \"px \" + fullState.yaxis.style.fontName;\r\n              ctx.fillStyle = fullState.yaxis.style.fontColor;\r\n              ctx.textAlign = \"left\";\r\n              ctx.textBaseline = \"middle\";\r\n              ctx.fillText(\r\n                ySnap as string,\r\n                containerWidth - widthYAxis + fullState.yaxis.widthTickmarkLines + 5,\r\n                yStart // additional 5px distance to end of tickmark\r\n              );\r\n              // (!) Konva specific method, it is very important\r\n              context.fillStrokeShape(shape);\r\n            }}\r\n            // stroke=\"black\"\r\n            // strokeWidth={1}\r\n          />\r\n        </React.Fragment>\r\n      ) : null}\r\n\r\n      {fullState.pointer?.chartPointer?.move?.xUnlimited <= fullState.xaxis.xEnd &&\r\n      fullState.pointer?.chartPointer?.move?.xUnlimited >= fullState.xaxis.xStart ? (\r\n        <React.Fragment>\r\n          <Rect // xaxis marker rect\r\n            x={fullState.methods.xToPix(Math.round(fullState.methods.pixToX(fullState.pointer.move?.xy[0]))) - 25}\r\n            y={containerHeight - heightXAxis + heightTickMarkLines + 0.5}\r\n            width={50}\r\n            height={25}\r\n            fill=\"white\"\r\n            stroke=\"black\"\r\n            strokeWidth={1}\r\n          />\r\n          <Shape // xaxis marker text\r\n            sceneFunc={(context, shape) => {\r\n              const ctx = context._context;\r\n              if (!fullState.pointer.move) return;\r\n              ctx.font = fullState.xaxis.style.fontSize + \"px \" + fullState.xaxis.style.fontName;\r\n              ctx.fillStyle = fullState.xaxis.style.fontColor;\r\n              ctx.textAlign = \"center\";\r\n              ctx.textBaseline = \"top\";\r\n\r\n              ctx.fillText(\r\n                !!fullState.pointer?.chartPointer?.move?.snapDatasets?.[0]\r\n                  ? (fullState.pointer.chartPointer.move.snapDatasets[0].dateString as string)\r\n                  : Math.round(fullState.methods.pixToX(fullState.pointer.move.xy[0])).toString(),\r\n                fullState.methods.xToPix(Math.round(fullState.methods.pixToX(fullState.pointer.move.xy[0]))),\r\n                containerHeight - heightXAxis + heightTickMarkLines + 5 + 0.5 // additional 5px distance to end of tickmark\r\n              );\r\n              // (!) Konva specific method, it is very important\r\n              context.fillStrokeShape(shape);\r\n            }}\r\n            // stroke=\"black\"\r\n            // strokeWidth={1}\r\n          />\r\n        </React.Fragment>\r\n      ) : null}\r\n\r\n      {/* ) : null} */}\r\n    </React.Fragment>\r\n  ) : null;\r\n};\r\n","import React from \"react\";\r\nimport { Shape } from \"react-konva\";\r\nimport { CandleChartDataset } from \"../Types/CChartTypes\";\r\nimport { CalculatedChartStateType, isChartGraph } from \"../Types/CChartStateTypes\";\r\n\r\nexport type CCandleChartType = {\r\n  fullState: CalculatedChartStateType;\r\n};\r\n\r\nexport const CCandleChart = (props: CCandleChartType) => {\r\n  const { fullState } = props;\r\n  const yaxis = fullState.subCharts[0].yaxis[0];\r\n  const graph = fullState.subCharts[0].yaxis[0].graphs[0];\r\n  if (!isChartGraph(graph) || !graph || !graph.curData) return null;\r\n\r\n  let curData: (CandleChartDataset & {\r\n    idx: number;\r\n  })[] = [];\r\n  let dxHalfCandle = 0;\r\n  if (0 in fullState.subCharts)\r\n    if (0 in fullState.subCharts[0].yaxis)\r\n      if (0 in fullState.subCharts[0].yaxis[0].graphs) {\r\n        curData = graph.curData as unknown as (CandleChartDataset & {\r\n          idx: number;\r\n        })[];\r\n        curData.forEach((val, valIdx) => (val.idx = valIdx));\r\n        dxHalfCandle =\r\n          fullState.xaxis.widthPerTick <= 2 ? 0 : Math.floor(0.35 * (fullState.xaxis.widthPerTick - 1));\r\n      }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Shape // candle wicks\r\n        sceneFunc={(context, shape) => {\r\n          context.beginPath();\r\n          (graph.curData as CandleChartDataset[]).forEach((dataset, datasetIdx) => {\r\n            const xPix = fullState.methods.xToPix(datasetIdx, 0) + fullState.xaxis.pixXStart;\r\n            const yPixHigh = Math.round(\r\n              fullState.methods.yToPix(dataset.high, 0, 0)\r\n            );\r\n            const yPixLow = Math.round(\r\n              fullState.methods.yToPix(dataset.low, 0, 0)\r\n            );\r\n            const yPixClose = Math.round(\r\n              fullState.methods.yToPix(dataset.close, 0, 0)\r\n            );\r\n            context.moveTo(xPix + 0.5, yPixLow + 0.5);\r\n            context.lineTo(xPix + 0.5, yPixHigh + 0.5);\r\n            if (dataset.close === dataset.open) {\r\n              context.moveTo(xPix - 2, yPixClose);\r\n              context.lineTo(xPix + 2, yPixClose);\r\n            }\r\n          });\r\n          // (!) Konva specific method, it is very important\r\n          context.closePath();\r\n          context.fillStrokeShape(shape);\r\n        }}\r\n        stroke={graph.style.candleStrokeColor}\r\n        strokeWidth={1}\r\n      />\r\n      <Shape // candle bodys upward\r\n        sceneFunc={(context, shape) => {\r\n          context.beginPath();\r\n          curData\r\n            .filter((val) => val.close >= val.open)\r\n            .forEach((gainDataset, gainDatasetIdx) => {\r\n              const xPix =\r\n                fullState.methods.xToPix(gainDataset.idx, 0) + fullState.xaxis.pixXStart;\r\n              const yPixOpen = Math.round(\r\n                fullState.methods.yToPix(\r\n                  gainDataset.open,\r\n                  0,\r\n                  0,\r\n                )\r\n              );\r\n              const yPixClose = Math.round(\r\n                fullState.methods.yToPix(\r\n                  gainDataset.close,\r\n                  0,\r\n                  0,\r\n                )\r\n              );\r\n              if (gainDataset.close !== gainDataset.open) {\r\n                if (dxHalfCandle !== 0) {\r\n                  const maxWidth =\r\n                    xPix + dxHalfCandle > fullState.xaxis.pixXEnd\r\n                      ? fullState.xaxis.pixXEnd - xPix + dxHalfCandle\r\n                      : dxHalfCandle * 2;\r\n                  context.rect(xPix + 0.5 - dxHalfCandle, yPixOpen + 0.5, maxWidth, yPixClose - yPixOpen);\r\n                } else if (dxHalfCandle === 0) {\r\n                  context.moveTo(xPix + 0.5, yPixClose);\r\n                  context.lineTo(xPix + 0.5, yPixOpen);\r\n                }\r\n              }\r\n              context.closePath();\r\n              context.fillStrokeShape(shape);\r\n            });\r\n        }}\r\n        stroke={graph.style.candleStrokeColor}\r\n        fill={graph.style.candleUpColor}\r\n        strokeWidth={1}\r\n      />\r\n      <Shape // candle bodys downward\r\n        sceneFunc={(context, shape) => {\r\n          context.beginPath();\r\n          curData\r\n            .filter((val) => val.close < val.open)\r\n            .forEach((gainDataset, gainDatasetIdx) => {\r\n              const xPix =\r\n                fullState.methods.xToPix(gainDataset.idx, 0) + fullState.xaxis.pixXStart;\r\n              const yPixOpen = Math.round(\r\n                fullState.methods.yToPix(\r\n                  gainDataset.open,\r\n                  0,\r\n                  0,\r\n                )\r\n              );\r\n              const yPixClose = Math.round(\r\n                fullState.methods.yToPix(\r\n                  gainDataset.close,\r\n                  0,\r\n                  0,\r\n                )\r\n              );\r\n              if (gainDataset.close !== gainDataset.open) {\r\n                if (dxHalfCandle !== 0) {\r\n                  const maxWidth =\r\n                    xPix + dxHalfCandle > fullState.xaxis.pixXEnd\r\n                      ? fullState.xaxis.pixXEnd - xPix + dxHalfCandle\r\n                      : dxHalfCandle * 2;\r\n                  context.rect(xPix + 0.5 - dxHalfCandle, yPixOpen + 0.5, maxWidth, yPixClose - yPixOpen);\r\n                } else if (dxHalfCandle === 0) {\r\n                  context.moveTo(xPix + 0.5, yPixClose);\r\n                  context.lineTo(xPix + 0.5, yPixOpen);\r\n                }\r\n              }\r\n              context.closePath();\r\n              context.fillStrokeShape(shape);\r\n            });\r\n        }}\r\n        stroke={graph.style.candleStrokeColor}\r\n        fill={graph.style.candleDownColor}\r\n        strokeWidth={1}\r\n      />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { MutableRefObject, RefObject } from \"react\";\r\n\r\n/** Null/Undefined  */\r\nexport const isNullish = (val: any): val is undefined | null => {\r\n  if (val === undefined || val === null) return true;\r\n  if (typeof val === \"number\") if (isNaN(val)) return true;\r\n  return false;\r\n};\r\n\r\n/** Number utils */\r\nexport const getDecimals = (val: number) => {\r\n  if (Math.floor(val) === val) return 0;\r\n  return val.toString().split(\".\")[1].length || 0;\r\n};\r\n\r\n/** React */\r\n// export const isValidRef = (\r\n//   ref: MutableRefObject<any | null> | RefObject<any>\r\n// ): ref is MutableRefObject<any> | (RefObject<any> & { readonly current: any }) => {\r\n//   if (!ref || !ref.current) return false;\r\n//   return true;\r\n// };\r\n// export const isEmptyRef = (ref: MutableRefObject<any | null> |  RefObject<any>): ref is MutableRefObject<null> | RefObject<null> => {\r\n//   if (!ref || !ref.current) return true;\r\n//   return false;\r\n// };\r\n\r\n// export const isEmptyDOMRef = (\r\n//   ref: RefObject<any>\r\n// ): ref is {current: null} => {\r\n//   if (!ref || !ref.current) return true;\r\n//   return false;\r\n// };\r\n\r\n// Object / Array utils\r\n// export const editDeepProp = (srcObj: {[key: string]: any} | any[], path: (number | string)[], propName: number | string) => {\r\n\r\nexport const includesOne = (array: any[], ...params: any[]): boolean => {\r\n  let res = false;\r\n  params.forEach((param) => {\r\n    if (array.includes(param)) res = true;\r\n  });\r\n  return res;\r\n};\r\n\r\n//   let newObj = srcObj;\r\n//   path.forEach((addr, addrIdx) => {\r\n//     if (typeof newObj !== \"object\") return;\r\n//     if (Array.isArray(newObj) && typeof addr === \"number\") {\r\n//       newObj= newObj[addr]\r\n//     }\r\n//     else if (typeof  newObj === \"object\" && typeof addr === \"string\"){\r\n//       newObj = (newObj as { [key: string]: any })[addr];\r\n//     }\r\n//   })\r\n//   const editedSubcharts: ChartStateType[\"subCharts\"] = [\r\n//     ...srcObj.slice(0, toolsSubIdx),\r\n//     {\r\n//       ...srcObj[toolsSubIdx],\r\n//       yaxis: [\r\n//         ...srcObj[toolsSubIdx].yaxis.slice(0, toolsYaxisIdx),\r\n//         {\r\n//           ...srcObj[toolsSubIdx].yaxis[toolsYaxisIdx],\r\n//           tools: [\r\n//             ...srcObj[toolsSubIdx].yaxis[toolsYaxisIdx].tools.slice(0, toolIdx),\r\n//             {\r\n//               ...srcObj[toolsSubIdx].yaxis[toolsYaxisIdx].tools[toolIdx],\r\n//               xy: [\r\n//                 ...srcObj[toolsSubIdx].yaxis[toolsYaxisIdx].tools[toolIdx].xy.slice(0, anchorIdx),\r\n//                 [newX, newY],\r\n//                 ...srcObj[toolsSubIdx].yaxis[toolsYaxisIdx].tools[toolIdx].xy.slice(anchorIdx + 1),\r\n//               ],\r\n//             },\r\n//             ...srcObj[toolsSubIdx].yaxis[toolsYaxisIdx].tools.slice(toolIdx + 1),\r\n//           ],\r\n//         },\r\n//         ...srcObj[toolsSubIdx].yaxis.slice(toolsYaxisIdx + 1),\r\n//       ],\r\n//     },\r\n//     ...srcObj.slice(toolsSubIdx + 1),\r\n//   ];\r\n// }\r\n\r\nconst colorNames: {[key: string]: string} = {\r\n  aliceblue: \"#f0f8ff\",\r\n  antiquewhite: \"#faebd7\",\r\n  aqua: \"#00ffff\",\r\n  aquamarine: \"#7fffd4\",\r\n  azure: \"#f0ffff\",\r\n  beige: \"#f5f5dc\",\r\n  bisque: \"#ffe4c4\",\r\n  black: \"#000000\",\r\n  blanchedalmond: \"#ffebcd\",\r\n  blue: \"#0000ff\",\r\n  blueviolet: \"#8a2be2\",\r\n  brown: \"#a52a2a\",\r\n  burlywood: \"#deb887\",\r\n  cadetblue: \"#5f9ea0\",\r\n  chartreuse: \"#7fff00\",\r\n  chocolate: \"#d2691e\",\r\n  coral: \"#ff7f50\",\r\n  cornflowerblue: \"#6495ed\",\r\n  cornsilk: \"#fff8dc\",\r\n  crimson: \"#dc143c\",\r\n  cyan: \"#00ffff\",\r\n  darkblue: \"#00008b\",\r\n  darkcyan: \"#008b8b\",\r\n  darkgoldenrod: \"#b8860b\",\r\n  darkgray: \"#a9a9a9\",\r\n  darkgreen: \"#006400\",\r\n  darkkhaki: \"#bdb76b\",\r\n  darkmagenta: \"#8b008b\",\r\n  darkolivegreen: \"#556b2f\",\r\n  darkorange: \"#ff8c00\",\r\n  darkorchid: \"#9932cc\",\r\n  darkred: \"#8b0000\",\r\n  darksalmon: \"#e9967a\",\r\n  darkseagreen: \"#8fbc8f\",\r\n  darkslateblue: \"#483d8b\",\r\n  darkslategray: \"#2f4f4f\",\r\n  darkturquoise: \"#00ced1\",\r\n  darkviolet: \"#9400d3\",\r\n  deeppink: \"#ff1493\",\r\n  deepskyblue: \"#00bfff\",\r\n  dimgray: \"#696969\",\r\n  dodgerblue: \"#1e90ff\",\r\n  firebrick: \"#b22222\",\r\n  floralwhite: \"#fffaf0\",\r\n  forestgreen: \"#228b22\",\r\n  fuchsia: \"#ff00ff\",\r\n  gainsboro: \"#dcdcdc\",\r\n  ghostwhite: \"#f8f8ff\",\r\n  gold: \"#ffd700\",\r\n  goldenrod: \"#daa520\",\r\n  gray: \"#808080\",\r\n  green: \"#008000\",\r\n  greenyellow: \"#adff2f\",\r\n  honeydew: \"#f0fff0\",\r\n  hotpink: \"#ff69b4\",\r\n  \"indianred \": \"#cd5c5c\",\r\n  indigo: \"#4b0082\",\r\n  ivory: \"#fffff0\",\r\n  khaki: \"#f0e68c\",\r\n  lavender: \"#e6e6fa\",\r\n  lavenderblush: \"#fff0f5\",\r\n  lawngreen: \"#7cfc00\",\r\n  lemonchiffon: \"#fffacd\",\r\n  lightblue: \"#add8e6\",\r\n  lightcoral: \"#f08080\",\r\n  lightcyan: \"#e0ffff\",\r\n  lightgoldenrodyellow: \"#fafad2\",\r\n  lightgrey: \"#d3d3d3\",\r\n  lightgreen: \"#90ee90\",\r\n  lightpink: \"#ffb6c1\",\r\n  lightsalmon: \"#ffa07a\",\r\n  lightseagreen: \"#20b2aa\",\r\n  lightskyblue: \"#87cefa\",\r\n  lightslategray: \"#778899\",\r\n  lightsteelblue: \"#b0c4de\",\r\n  lightyellow: \"#ffffe0\",\r\n  lime: \"#00ff00\",\r\n  limegreen: \"#32cd32\",\r\n  linen: \"#faf0e6\",\r\n  magenta: \"#ff00ff\",\r\n  maroon: \"#800000\",\r\n  mediumaquamarine: \"#66cdaa\",\r\n  mediumblue: \"#0000cd\",\r\n  mediumorchid: \"#ba55d3\",\r\n  mediumpurple: \"#9370d8\",\r\n  mediumseagreen: \"#3cb371\",\r\n  mediumslateblue: \"#7b68ee\",\r\n  mediumspringgreen: \"#00fa9a\",\r\n  mediumturquoise: \"#48d1cc\",\r\n  mediumvioletred: \"#c71585\",\r\n  midnightblue: \"#191970\",\r\n  mintcream: \"#f5fffa\",\r\n  mistyrose: \"#ffe4e1\",\r\n  moccasin: \"#ffe4b5\",\r\n  navajowhite: \"#ffdead\",\r\n  navy: \"#000080\",\r\n  oldlace: \"#fdf5e6\",\r\n  olive: \"#808000\",\r\n  olivedrab: \"#6b8e23\",\r\n  orange: \"#ffa500\",\r\n  orangered: \"#ff4500\",\r\n  orchid: \"#da70d6\",\r\n  palegoldenrod: \"#eee8aa\",\r\n  palegreen: \"#98fb98\",\r\n  paleturquoise: \"#afeeee\",\r\n  palevioletred: \"#d87093\",\r\n  papayawhip: \"#ffefd5\",\r\n  peachpuff: \"#ffdab9\",\r\n  peru: \"#cd853f\",\r\n  pink: \"#ffc0cb\",\r\n  plum: \"#dda0dd\",\r\n  powderblue: \"#b0e0e6\",\r\n  purple: \"#800080\",\r\n  rebeccapurple: \"#663399\",\r\n  red: \"#ff0000\",\r\n  rosybrown: \"#bc8f8f\",\r\n  royalblue: \"#4169e1\",\r\n  saddlebrown: \"#8b4513\",\r\n  salmon: \"#fa8072\",\r\n  sandybrown: \"#f4a460\",\r\n  seagreen: \"#2e8b57\",\r\n  seashell: \"#fff5ee\",\r\n  sienna: \"#a0522d\",\r\n  silver: \"#c0c0c0\",\r\n  skyblue: \"#87ceeb\",\r\n  slateblue: \"#6a5acd\",\r\n  slategray: \"#708090\",\r\n  snow: \"#fffafa\",\r\n  springgreen: \"#00ff7f\",\r\n  steelblue: \"#4682b4\",\r\n  tan: \"#d2b48c\",\r\n  teal: \"#008080\",\r\n  thistle: \"#d8bfd8\",\r\n  tomato: \"#ff6347\",\r\n  turquoise: \"#40e0d0\",\r\n  violet: \"#ee82ee\",\r\n  wheat: \"#f5deb3\",\r\n  white: \"#ffffff\",\r\n  whitesmoke: \"#f5f5f5\",\r\n  yellow: \"#ffff00\",\r\n  yellowgreen: \"#9acd32\",\r\n};\r\n// colors\r\nexport const colorNameToHex = (name: string) => {\r\n  if (!(name in colorNames)) return null;\r\n  return colorNames[\"name\"];\r\n};\r\nexport const colorNameToRGB = (name: string) => {\r\n  if (!(name in colorNames)) return null;\r\n  return hexToRgb(colorNames[\"name\"]);\r\n};\r\n\r\nexport const hexToRgb = (hex: string) => {\r\n  if (!hex) return null;\r\n  // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n  var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n  hex = hex.replace(shorthandRegex, function (m, r, g, b) {\r\n    return r + r + g + g + b + b;\r\n  });\r\n\r\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  return result\r\n    ? {\r\n        r: parseInt(result[1], 16),\r\n        g: parseInt(result[2], 16),\r\n        b: parseInt(result[3], 16),\r\n      }\r\n    : null;\r\n};\r\n","import React from \"react\";\r\nimport { Line } from \"react-konva\";\r\nimport { isIndicatorDataset } from \"../Types/CChartTypes\";\r\nimport { CalculatedChartStateType, isIndicatorGraph } from \"../Types/CChartStateTypes\";\r\nimport { isNullish } from \"../utils\";\r\n\r\nexport type ClineChartType = {\r\n  fullState: CalculatedChartStateType;\r\n  subchartIdx: number;\r\n  yaxisIdx: number;\r\n  graphIdx: number;\r\n  indSeriesIdx?: number;\r\n};\r\nexport const CLineChart = (props: ClineChartType) => {\r\n  const { fullState, subchartIdx, yaxisIdx, graphIdx, indSeriesIdx: indSeriesIdxIn } = props;\r\n  const indSeriesIdx = isNullish(indSeriesIdxIn) ? 0 : indSeriesIdxIn;\r\n  const yaxis = fullState.subCharts[subchartIdx].yaxis[yaxisIdx];\r\n  const graph = fullState.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx];\r\n  const graphVals: (number | null)[] = [];\r\n  if (Array.isArray(graph.curData) && graph.curData.length > 1) {\r\n    graphVals.push(\r\n      ...(graph.curData\r\n        .map((val, idx) => {\r\n          let price;\r\n          if (isIndicatorDataset(val)) price = val.prices[indSeriesIdx];\r\n          else price = val.close;\r\n          if (price === null) return [null, null];\r\n          return [fullState.xaxis.widthPerTick * idx, fullState.methods.yToPix(price, subchartIdx, 0, 0)];\r\n        })\r\n        .flat()\r\n        .filter((val) => val !== null) as number[])\r\n    );\r\n  }\r\n  const graphValsNN = graphVals.filter((val) => val !== null) as number[];\r\n\r\n  return (\r\n    <Line\r\n      key={`sub${subchartIdx}_graph${graphIdx}`}\r\n      x={fullState.xaxis.pixXStart}\r\n      y={fullState.methods.yToPix(0, subchartIdx, 0) - fullState.subCharts[subchartIdx].bottom}\r\n      points={[...graphValsNN]}\r\n      stroke={isIndicatorGraph(graph) ? graph.style.strokeColor[indSeriesIdx] : graph.style.strokeColor[0]}\r\n      strokeWidth={1}\r\n    />\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Shape } from \"react-konva\";\r\nimport { LineChartDataset } from \"../Types/CChartTypes\";\r\nimport { CalculatedChartStateType, isIndicatorGraph } from \"../Types/CChartStateTypes\";\r\n\r\nexport type CBarChartType = {\r\n  fullState: CalculatedChartStateType;\r\n  subchartIdx: number;\r\n  yaxisIdx: number;\r\n  graphIdx: number;\r\n  // stroke: string;\r\n  // strokeWidth: number;\r\n};\r\nexport const CBarChart = (props: CBarChartType) => {\r\n  const { fullState, subchartIdx, yaxisIdx, graphIdx } = props;\r\n  const strokeWidth = 1;\r\n  const graph = fullState.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx];\r\n  return (\r\n    <Shape\r\n      sceneFunc={(context, shape) => {\r\n        context.beginPath();\r\n        (fullState.subCharts[0].yaxis[0].graphs[0].curData as LineChartDataset[]).forEach((dataset, datasetIdx) => {\r\n          if (!dataset.volume) return;\r\n          const xPix = fullState.methods.xToPix(datasetIdx, 0) + fullState.xaxis.pixXStart;\r\n          const yPixVol = Math.round(fullState.methods.yToPix(dataset.volume, subchartIdx, yaxisIdx, 0));\r\n          const yPix0 = Math.round(fullState.methods.yToPix(0, subchartIdx, yaxisIdx, 0));\r\n\r\n          context.moveTo(xPix + 0.5, yPix0 + 0.5);\r\n          context.lineTo(xPix + 0.5, yPixVol + 0.5);\r\n        });\r\n        // (!) Konva specific method, it is very important\r\n        context.closePath();\r\n        context.fillStrokeShape(shape);\r\n      }}\r\n    \r\n      stroke={isIndicatorGraph(graph) ? graph.style.strokeColor[0] : graph.style.strokeColor[0]}\r\n      strokeWidth={strokeWidth}\r\n    />\r\n  );\r\n};\r\n","import { PeriodsConstType } from \"../Types/CChartTimeTypes\";\r\nimport { format, getDate, getHours, getISOWeek, getMinutes, getMonth, getYear } from \"date-fns\";\r\n\r\nexport const getDateString = (date: Date, period: keyof PeriodsConstType): string => {\r\n  switch (period) {\r\n    case \"minutes\":\r\n      return format(date, \"mm\");\r\n    case \"hours\":\r\n      return format(date, \"HH\");\r\n    case \"days\":\r\n      return format(date, \"dd\");\r\n    case \"weeks\":\r\n      return format(date, \"dd\");\r\n    case \"months\":\r\n      return format(date, \"MMM\");\r\n    case \"years\":\r\n      return format(date, \"yyyy\");\r\n    default:\r\n      return \"|\";\r\n  }\r\n}; \r\n\r\nexport const getDateSubValue = (date: Date, period: keyof PeriodsConstType): number => {\r\n  switch (period) {\r\n    case \"minutes\":\r\n      return getMinutes(date);\r\n    case \"hours\":\r\n      return getHours(date);\r\n    case \"days\":\r\n      return getDate(date);\r\n    case \"weeks\":\r\n      return getISOWeek(date);\r\n    case \"months\":\r\n      return getMonth(date);\r\n    case \"years\":\r\n      return getYear(date);\r\n    default:\r\n      return 0;\r\n  }\r\n};\r\nexport const getDateObject = (date: Date) => ({\r\n  minute: getDateSubValue(date, \"minutes\"),\r\n  hour: getDateSubValue(date, \"hours\"),\r\n  day: getDateSubValue(date, \"days\"),\r\n  week: getDateSubValue(date, \"weeks\"),\r\n  month: getDateSubValue(date, \"months\"),\r\n  year: getDateSubValue(date, \"years\"),\r\n});\r\n","import { getDateObject, getDateSubValue } from \"./CChartDateTime\";\r\nimport { ChartPeriodType, DateStatType, PeriodsConstType } from \"../Types/CChartTimeTypes\";\r\nimport { DataSeries } from \"../Types/CChartTypes\";\r\nimport { ChartGraphStateType } from \"../Types/CChartStateTypes\";\r\n\r\nexport const chartPeriods: PeriodsConstType = {\r\n  minutes: { period: 60000, scaleMultiplys: [2, 5, 15, 30], range: [60000, 60000] },\r\n  hours: { period: 3600000, scaleMultiplys: [2, 4, 12], range: [3600000, 3600000] },\r\n  days: { period: 86400000, scaleMultiplys: [2], range: [86400000, 86400000] }, // special threatment!\r\n  weeks: { period: 86400000 * 7, scaleMultiplys: [2], range: [259200000, 950400000] }, // only 1 and 2 wheras 2 means 1/2 month\r\n  months: { period: 86400000 * 31, scaleMultiplys: [2, 3, 6], range: [2419200000, 2678400000] }, // months have 28-31 day :/\r\n  years: { period: 86400000 * 365, scaleMultiplys: [], range: [31536000000, 31622400000] },\r\n};\r\n\r\n/** determines chartPeriod (restrictions apply, otherwise return null) based on dataPeriod (dataPeriod repres. period with most occurances) */\r\nexport const getChartPeriod = (dataPeriod: number): ChartPeriodType | null => {\r\n  const dataPeriodKeys = Object.keys(chartPeriods) as (keyof PeriodsConstType)[];\r\n  for (let i = 0; i < dataPeriodKeys.length; i++) {\r\n    const chartPeriodKey = dataPeriodKeys[i];\r\n    const chartPeriod = chartPeriods[chartPeriodKey].period;\r\n    const chartPeriodRange = chartPeriods[chartPeriodKey].range;\r\n    if (typeof chartPeriod === \"number\")\r\n      if (dataPeriod === chartPeriod || (dataPeriod >= chartPeriodRange[0] && dataPeriod <= chartPeriodRange[1]))\r\n        return { chartPeriodName: chartPeriodKey, periodsConstIdx: i, chartPeriod: chartPeriod, multiply: 1 };\r\n  }\r\n  return null;\r\n};\r\n\r\nexport const getOptimalPeriod = (\r\n  data: DataSeries,\r\n  xStart: number,\r\n  xEnd: number,\r\n  metaData: ChartGraphStateType[\"meta\"],\r\n  noDataPortion: number,\r\n  dateStat: DateStatType\r\n): ChartPeriodType | null => {\r\n  if (!metaData.chartPeriod) return null;\r\n  const { chartPeriod, periodsConstIdx, chartPeriodName } = metaData.chartPeriod;\r\n\r\n  // const dateStat = getDateStat(data, xStart, xEnd);\r\n  const nCurrent = xEnd - xStart + 1;\r\n\r\n  const curDateStat = Object.assign({}, dateStat); //{ ...dateStat };\r\n  const nInDateStat = curDateStat.accAmt[chartPeriodName];\r\n  Object.keys(curDateStat.accAmt).forEach((key, keyIdx) => {\r\n    curDateStat.accAmt[key as keyof DateStatType[\"accAmt\"]] =\r\n      (curDateStat.accAmt[key as keyof DateStatType[\"accAmt\"]] / nInDateStat) * nCurrent;\r\n  });\r\n  const targetIntervals = 10 * (1 - noDataPortion);\r\n  let opt = null;\r\n  let optPeriod = chartPeriodName;\r\n  let optMultiply = 1;\r\n  let optConstIdx = 0;\r\n  for (let i = periodsConstIdx; i < Object.keys(chartPeriods).length; i++) {\r\n    const key = Object.keys(chartPeriods)[i] as keyof PeriodsConstType;\r\n    // higherPeriods += key + \", \";\r\n    if (key in curDateStat.accAmt) {\r\n      for (let multiply of [1, ...chartPeriods[key].scaleMultiplys]) {\r\n        if (opt !== null) {\r\n          if (\r\n            Math.abs(curDateStat.accAmt[key] / multiply - targetIntervals) <\r\n            Math.abs(opt / optMultiply - targetIntervals)\r\n          ) {\r\n            opt = curDateStat.accAmt[key];\r\n            optMultiply = multiply;\r\n            optPeriod = key;\r\n          }\r\n        } else {\r\n          // opt is just once null multiply is in first iteration always 1\r\n          opt = curDateStat.accAmt[key];\r\n          optMultiply = multiply;\r\n          optPeriod = key;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return {\r\n    chartPeriodName: optPeriod,\r\n    multiply: optMultiply,\r\n    chartPeriod: chartPeriods[optPeriod].period,\r\n    periodsConstIdx: optConstIdx,\r\n  };\r\n};\r\n\r\nexport const isNewYear = (date: Date, curYearDateStat: DateStatType[\"years\"], periodMultiply: 1 = 1) => {\r\n  // , periodMultiply?: number to be added as parameter -> multiply currently not supported for years\r\n  if (curYearDateStat.length > 1) return false;\r\n  const { day, week, month, year } = getDateObject(date);\r\n  const thisMonthStat = curYearDateStat[0].months[0];\r\n  if (\r\n    thisMonthStat.weeks[0].days[0].day === day &&\r\n    thisMonthStat.weeks[0].week === week &&\r\n    thisMonthStat.month === month\r\n  )\r\n    return true;\r\n  return false;\r\n};\r\n\r\nconst isNewMonth = (\r\n  date: Date,\r\n  curYearDateStat: DateStatType[\"years\"],\r\n  curMonthIdx: number,\r\n  periodMultiply: 1 | 2 | 3 | 6 = 1\r\n) => {\r\n  if (curYearDateStat.length > 1) return false;\r\n  const { day, week, month, year } = getDateObject(date);\r\n  if ((curMonthIdx + 1) % periodMultiply !== 0) return false;\r\n  if (\r\n    curYearDateStat[0].months[curMonthIdx].weeks[0].days[0].day === day &&\r\n    curYearDateStat[0].months[curMonthIdx].weeks[0].week === week\r\n  )\r\n    return true;\r\n  return false;\r\n};\r\n\r\nconst isNewIsoWeek = (\r\n  date: Date,\r\n  curYearDateStat: DateStatType[\"years\"],\r\n  curMonthIdx: number,\r\n  curWeekIdx: number,\r\n  periodMultiply: 1 | 2 = 1\r\n) => {\r\n  if (curYearDateStat.length > 1) return false;\r\n  const { day, week, month, year } = getDateObject(date);\r\n  if (\r\n    curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days[0].day === day &&\r\n    curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].week === week\r\n  ) {\r\n    if (periodMultiply === 2) {\r\n      let daysInMonth = 0;\r\n      curYearDateStat[0].months[curMonthIdx].weeks.forEach((val) => (daysInMonth += val.days.length));\r\n      let curDays = 0;\r\n      let opt = 0;\r\n      let optWeekIdx = 0;\r\n      const optimalDaysTarget = Math.round(daysInMonth / 2);\r\n      for (let i = 0; i < curYearDateStat[0].months[curMonthIdx].weeks.length; i++) {\r\n        const weekInMonth = curYearDateStat[0].months[curMonthIdx].weeks[i];\r\n        if (Math.abs(curDays + weekInMonth.days.length - optimalDaysTarget) < Math.abs(opt - optimalDaysTarget)) {\r\n          opt = curDays + weekInMonth.days.length;\r\n          optWeekIdx = i + 1;\r\n        }\r\n        curDays += weekInMonth.days.length;\r\n      }\r\n      if (curWeekIdx === optWeekIdx) return true;\r\n      return false;\r\n    } else if (periodMultiply === 1) {\r\n      if (curWeekIdx === 1 && curYearDateStat[0].months[curMonthIdx].weeks[0].days.length < 3) return false;\r\n      if (\r\n        curWeekIdx === curYearDateStat[0].months[curMonthIdx].weeks.length - 1 &&\r\n        curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days.length < 3\r\n      )\r\n        return false;\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\nconst isNewDay = (\r\n  date: Date,\r\n  curYearDateStat: DateStatType[\"years\"],\r\n  curMonthIdx: number,\r\n  curWeekIdx: number,\r\n  curDayIdx: number,\r\n  periodMultiply: 1 | 2 = 1\r\n) => {\r\n  const day = getDateSubValue(date, \"days\");\r\n  if (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days[curDayIdx].day === day && periodMultiply === 1)\r\n    return true;\r\n  if (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days[curDayIdx].day === day && periodMultiply === 2) {\r\n    if (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days.length <= 3) return false; // weeks with up to 3 days are not diveded\r\n    if (\r\n      (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days.length === 4 &&\r\n        (curDayIdx === 0 || curDayIdx === 2)) ||\r\n      (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days.length === 5 &&\r\n        (curDayIdx === 0 || curDayIdx === 2)) ||\r\n      (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days.length === 6 &&\r\n        (curDayIdx === 0 || curDayIdx === 2 || curDayIdx === 4)) ||\r\n      (curYearDateStat[0].months[curMonthIdx].weeks[curWeekIdx].days.length === 7 &&\r\n        (curDayIdx === 0 || curDayIdx === 2 || curDayIdx === 5))\r\n    )\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport const isNewPeriod = (\r\n  //   data: ChartData,\r\n  date: Date,\r\n  dateStat: DateStatType,\r\n  chartPeriod: ChartPeriodType,\r\n  optPeriod: ChartPeriodType\r\n  //   xStart: number,\r\n  //   xEnd: number\r\n) => {\r\n  if (!chartPeriod || !optPeriod || !dateStat) return null;\r\n  const { chartPeriodName: optPeriodName, multiply: optMultiply } = optPeriod;\r\n  const year = getDateSubValue(date, \"years\");\r\n  const month = getDateSubValue(date, \"months\");\r\n  const week = getDateSubValue(date, \"weeks\");\r\n  const day = getDateSubValue(date, \"days\");\r\n\r\n  const curYearStat = dateStat.years.filter((e) => e.year === year);\r\n  // console.log(month, curYearStat, dateStat);\r\n  const curMonthStat = curYearStat[0].months.filter((e) => e.month === month);\r\n  const curMonthStatIdx = curYearStat[0].months.indexOf(curMonthStat[0]);\r\n\r\n  const curWeekStat = curMonthStat[0].weeks.filter((e) => e.week === week);\r\n  const curWeekStatIdx = curYearStat[0].months[curMonthStatIdx].weeks.indexOf(curWeekStat[0]);\r\n  const curDayStat = curWeekStat[0].days.filter((e) => e.day === day);\r\n  const curDayStatIdx = curYearStat[0].months[curMonthStatIdx].weeks[curWeekStatIdx].days.indexOf(curDayStat[0]);\r\n\r\n  if (chartPeriod.chartPeriodName === optPeriodName && optMultiply === 1) return optPeriodName;\r\n  // if (chartPeriod.chartPeriodName === optPeriodName && optMultiply !== 1) return optPeriodName; //// TODO\r\n  if (optPeriodName === \"days\") {\r\n    if (isNewYear(date, curYearStat)) return \"years\";\r\n    if (isNewMonth(date, curYearStat, curMonthStatIdx, 1)) return \"months\";\r\n    if (isNewIsoWeek(date, curYearStat, curMonthStatIdx, curWeekStatIdx, optMultiply as 1 | 2)) return \"weeks\";\r\n    if (isNewDay(date, curYearStat, curMonthStatIdx, curWeekStatIdx, curDayStatIdx, optMultiply as 1 | 2))\r\n      return \"days\";\r\n    return null;\r\n  }\r\n  if (optPeriodName === \"weeks\") {\r\n    if (isNewYear(date, curYearStat)) return \"years\";\r\n    if (isNewMonth(date, curYearStat, curMonthStatIdx, 1)) return \"months\";\r\n    if (isNewIsoWeek(date, curYearStat, curMonthStatIdx, curWeekStatIdx, optMultiply as 1 | 2)) return optPeriodName;\r\n    return null;\r\n  }\r\n  if (optPeriodName === \"months\") {\r\n    if (curMonthStat[0].weeks[0].days[0].day === day) return optPeriodName;\r\n    else return null;\r\n  }\r\n  if (optPeriodName === \"years\") {\r\n    if (curYearStat[0].months[0].weeks[0].days[0].day === day) return optPeriodName;\r\n    return null;\r\n  }\r\n  return null;\r\n};\r\n","import { getISOWeek } from \"date-fns\";\r\nimport { getDateStat } from \"./Time/CChartDateStat\";\r\nimport { getDateSubValue } from \"./Time/CChartDateTime\";\r\nimport { getChartPeriod } from \"./Time/CChartPeriod\";\r\nimport {\r\n  DataSeries,\r\n  ChartDataset,\r\n  IndicatorDataset,\r\n  isCandleChartDataset,\r\n  IndicatorDataSeries,\r\n} from \"./Types/CChartTypes\";\r\nimport {\r\n  isIndicatorGraph,\r\n  SubchartStateType,\r\n  YaxisStateType,\r\n  AdditionalIndicatorGraphStateType,\r\n  IndicatorGraphStateType,\r\n  ChartGraphStateType,\r\n  GraphStateType,\r\n} from \"./Types/CChartStateTypes\";\r\nimport { getDecimals } from \"./utils\";\r\n// import { getDataDateStat } from \"./CChartDate\";\r\n// import { CandleChartDataset, CChartViewerInternalState, ChartDataset, GraphProps } from \"./CChartViewer\";\r\n\r\nexport const getGraphMetaData = (\r\n  dataSeries: ChartDataset[]\r\n): ChartGraphStateType[\"meta\"] & { decimals: number; isDescending: boolean } => {\r\n  // get nData\r\n  const nData = dataSeries.length;\r\n\r\n  // local function, ts seems not to accept Date types as number\r\n  const getDeltaT = (dataPoint1: ChartDataset, dataPoint0: ChartDataset) =>\r\n    (dataPoint1.date as unknown as number) - (dataPoint0.date as unknown as number);\r\n\r\n  // loop data -> guess period, tradingDaysPerWeek (and confidence level=occurences in percent) and get decimals\r\n  const dT1 = getDeltaT(dataSeries[1], dataSeries[0]);\r\n  let deltaPeriods = [{ dT: dT1, amt: 1 }];\r\n  let decimals = 0;\r\n  let curWeek = getDateSubValue(dataSeries[0].date, \"weeks\"); //  getISOWeek(dataSeries[0].date);\r\n  let curYear = getDateSubValue(dataSeries[0].date, \"years\"); //dataSeries[0].date.getFullYear();\r\n  let curWeekDays = 0;\r\n  let weekDays: { amtDays: number; occ: number }[] = [];\r\n  for (let i = 0; i < nData; i++) {\r\n    // heuristic guess of period using simple stat of delta Periods (N=n-1)\r\n    if (i >= 2) {\r\n      // start with 2, iteration i=1 is done outside for loop\r\n      const deltaPeriod = getDeltaT(dataSeries[i], dataSeries[i - 1]);\r\n      // loop thru deltaPeriods already determined in prev iterations\r\n      for (let j = 0; j < deltaPeriods.length; j++) {\r\n        const savedDeltaPeriod = deltaPeriods[j];\r\n        if (savedDeltaPeriod.dT === deltaPeriod) {\r\n          deltaPeriods[j].amt++;\r\n          break;\r\n        } else if (j === deltaPeriods.length - 1) deltaPeriods.push({ dT: deltaPeriod, amt: 1 });\r\n      }\r\n    }\r\n    // heuristic guess of tradingDaysPerWeek\r\n    const iDataWeek = getISOWeek(dataSeries[i].date);\r\n    const iyear = getDateSubValue(dataSeries[i].date, \"years\"); //.getFullYear(); ;\r\n    if (iDataWeek > curWeek || iyear > curYear || i === nData - 1) {\r\n      // eslint-disable-next-line no-loop-func\r\n      const weekDaysFiltered = weekDays.filter((e) => e.amtDays === curWeekDays);\r\n      if (weekDaysFiltered.length > 0) {\r\n        if (weekDaysFiltered.length > 1) console.log(\"warning - internal error determing GraphMetaData\");\r\n        const weekDayIdx = weekDays.indexOf(weekDaysFiltered[0]);\r\n        weekDays[weekDayIdx].occ++;\r\n      } else if (weekDaysFiltered.length === 0) {\r\n        weekDays.push({ amtDays: curWeekDays, occ: 1 });\r\n      }\r\n      curWeek = iDataWeek;\r\n      curWeekDays = 1;\r\n      curYear = iyear;\r\n    } else {\r\n      curWeekDays++;\r\n    }\r\n\r\n    if (!dataSeries[i].close) console.log(\"hier ist was falsch\", i);\r\n\r\n    // determine max amount of decimals found in data\r\n    const datasetDecimals = [getDecimals(dataSeries[i].close)];\r\n    const curDataset = dataSeries[i]; //ts seems not to cast\r\n    if (isCandleChartDataset(curDataset)) {\r\n      datasetDecimals.push(getDecimals(curDataset.open));\r\n      datasetDecimals.push(getDecimals(curDataset.high));\r\n      datasetDecimals.push(getDecimals(curDataset.low));\r\n    }\r\n    const maxDecimals = Math.max(...datasetDecimals);\r\n    if (maxDecimals > decimals) decimals = maxDecimals;\r\n  }\r\n\r\n  // extract desired period data from deltaPeriod stat\r\n  let deltaTs = deltaPeriods.map((item) => item.dT);\r\n  let amts = deltaPeriods.map((item) => item.amt);\r\n  let maxIdx = amts.reduce((maxIdx, val, i, arr) => (val > arr[maxIdx] ? i : maxIdx), 0); //\r\n  // extract desired tradingDaysPerWeek data from weekDays stat\r\n  const maxDaysPerWeekOccurences = weekDays.map((val) => val.occ);\r\n  let totalOcc = 0;\r\n  weekDays.forEach((val) => (totalOcc += val.occ));\r\n  const maxDaysPerWeekOccIdx = maxDaysPerWeekOccurences.reduce(\r\n    (maxIdx, val, i, arr) => (val > arr[maxIdx] ? i : maxIdx),\r\n    0\r\n  );\r\n  const maxDaysPerWeek = weekDays[maxDaysPerWeekOccIdx].amtDays;\r\n  const maxDaysPerWeekGuessConfidence = weekDays[maxDaysPerWeekOccIdx].occ / totalOcc;\r\n  const isDesc = deltaTs[maxIdx] < 0;\r\n\r\n  // get chartperiod\r\n  console.log(deltaTs[maxIdx]);\r\n  const dataPeriod = Math.abs(deltaTs[maxIdx]);\r\n  const chartPeriod = getChartPeriod(dataPeriod);\r\n  return {\r\n    nData: nData,\r\n    dataPeriod: dataPeriod,\r\n    chartPeriod: chartPeriod,\r\n    periodGuessConfidence: amts[maxIdx] / nData,\r\n    tradingDaysPerWeek: maxDaysPerWeek,\r\n    tradingDaysPerWeekGuessConfidence: maxDaysPerWeekGuessConfidence,\r\n    type: \"candlechart\",\r\n    decimals: decimals,\r\n    isDescending: isDesc,\r\n  };\r\n};\r\n\r\nexport const createSubChartModel = (\r\n  top: number,\r\n  bottom: number,\r\n  chartData: ChartDataset[],\r\n  chartName: string,\r\n  style?: ChartGraphStateType[\"style\"] | IndicatorGraphStateType[\"style\"],\r\n  indicator?: AdditionalIndicatorGraphStateType[\"indicator\"]\r\n): SubchartStateType => {\r\n  return {\r\n    yaxis: [createYaxisModel(chartData, chartName, style, indicator)],\r\n    top: top,\r\n    bottom: bottom,\r\n  };\r\n};\r\n\r\nexport const createYaxisModel = (\r\n  chartData: ChartDataset[],\r\n  chartName: string,\r\n  style?: ChartGraphStateType[\"style\"] | IndicatorGraphStateType[\"style\"],\r\n  indicator?: AdditionalIndicatorGraphStateType[\"indicator\"]\r\n): YaxisStateType => {\r\n  const newGraph = !!indicator\r\n    ? createIndicatorGraphModel(chartData, chartName, indicator, style as IndicatorGraphStateType[\"style\"])\r\n    : createChartGraphModel(chartData, chartName, style as ChartGraphStateType[\"style\"]);\r\n  return {\r\n    graphs: [{ ...(newGraph as any) }],\r\n    decimals: newGraph.decimals,\r\n    tools: [],\r\n    translatedY: 0,\r\n    optIntervalY: 0,\r\n    heightPerPt: 0,\r\n    drawTicks: [],\r\n  };\r\n};\r\n\r\nexport const createChartGraphModel = (\r\n  chartData: ChartDataset[],\r\n  chartName: string,\r\n  style?: GraphStateType[\"style\"]\r\n): ChartGraphStateType => {\r\n  const { decimals, isDescending, ...graphProps } = getGraphMetaData(chartData);\r\n  if (isDescending) chartData.reverse();\r\n  const dateStat = getDateStat(chartData, 0, chartData.length - 1);\r\n  return {\r\n    data: chartData,\r\n    meta: graphProps,\r\n    // dateStat: dateStat,\r\n    style: {\r\n      strokeColor: [\"#000\"],\r\n      candleStrokeColor: \"#666\",\r\n      candleDownColor: \"rgb(199, 0, 57)\",\r\n      candleUpColor: \"#009688\",\r\n      ...style,\r\n    },\r\n    yMax: 0,\r\n    yMaxExact: 0,\r\n    yMin: 0,\r\n    yMinExact: 0,\r\n    // drawPixXy: [],\r\n    datasets: { first: null, last: null },\r\n    dateStat: dateStat,\r\n    type: \"chart\",\r\n    name: chartName,\r\n    decimals: decimals,\r\n  };\r\n};\r\nexport const createIndicatorGraphModel = (\r\n  chartData: ChartDataset[],\r\n  chartName: string,\r\n  indicator: AdditionalIndicatorGraphStateType[\"indicator\"],\r\n  style?: IndicatorGraphStateType[\"style\"]\r\n): IndicatorGraphStateType => {\r\n  const indicatorData: IndicatorDataSeries = indicator.indicatorFn?.(\r\n    chartData,\r\n    chartName,\r\n    ...indicator.params.map((val) => val.val)\r\n  );\r\n  const { decimals: decimalsData, ...graphProps } = getGraphMetaData(chartData); //only decimals necessary!\r\n  const decimals = !!indicator.default.decimals ? indicator.default.decimals : decimalsData;\r\n  // const dateStat = getDateStat(chartData, 0, chartData.length - 1);\r\n  return {\r\n    data: indicatorData,\r\n    type: \"indicator\",\r\n    name: indicator.name, //chartName,\r\n    decimals: decimals,\r\n    style: {\r\n      ...style,\r\n      strokeColor: style?.strokeColor || [\"#00ffff\"],\r\n    },\r\n    yMax: 0,\r\n    yMaxExact: 0,\r\n    yMin: 0,\r\n    yMinExact: 0,\r\n    // drawPixXy: [],\r\n    datasets: { first: null, last: null },\r\n    indicator,\r\n  };\r\n};\r\n","import { getDateSubValue } from \"./CChartDateTime\";\r\nimport {\r\n  DateStatType,\r\n  PeriodsConstType,\r\n  DateStatYearType,\r\n  DateStatMonthType,\r\n  DateStatWeekType,\r\n  DateStatDayType,\r\n} from \"../Types/CChartTimeTypes\";\r\nimport { DataSeries } from \"../Types/CChartTypes\";\r\n\r\nexport const getDateStat = (data: DataSeries, xStart: number, xEnd: number) => {\r\n  let stat: DateStatType = { years: [], accAmt: { years: 0, months: 0, weeks: 0, days: 0, hours: 0, minutes: 0 } };\r\n\r\n  const makeSingleDayStat = (day: number): DateStatDayType => ({ day: day, hours: [] });\r\n  const makeSingleWeekStat = (week: number, day: number): DateStatWeekType => ({\r\n    week: week,\r\n    days: [makeSingleDayStat(day)],\r\n  });\r\n  const makeSingleMonthStat = (month: number, week: number, day: number): DateStatMonthType => ({\r\n    month: month,\r\n    weeks: [makeSingleWeekStat(week, day)],\r\n  });\r\n  const makeSingleYearStat = (year: number, month: number, week: number, day: number): DateStatYearType => ({\r\n    year: year,\r\n    months: [makeSingleMonthStat(month, week, day)],\r\n  });\r\n  const incrementPeriodAccAmt = (period: keyof PeriodsConstType) => {\r\n    if (period === \"years\") stat.accAmt.years++;\r\n    if ([\"years\", \"months\"].includes(period)) stat.accAmt.months++;\r\n    if ([\"years\", \"months\", \"weeks\"].includes(period)) stat.accAmt.weeks++;\r\n    if ([\"years\", \"months\", \"weeks\", \"days\"].includes(period)) stat.accAmt.days++;\r\n  };\r\n\r\n  for (let i = xStart; i <= xEnd; i++) {\r\n    const year = getDateSubValue(data[i].date, \"years\");\r\n    const month = getDateSubValue(data[i].date, \"months\");\r\n    const week = getDateSubValue(data[i].date, \"weeks\");\r\n    const day = getDateSubValue(data[i].date, \"days\");\r\n\r\n    const addPeriod = (period: keyof PeriodsConstType, curStatIdx: number[]) => {\r\n      if (period === \"years\") stat.years.push(makeSingleYearStat(year, month, week, day));\r\n      if (period === \"months\") stat.years[curStatIdx[0]].months.push(makeSingleMonthStat(month, week, day));\r\n      if (period === \"weeks\") stat.years[curStatIdx[0]].months[curStatIdx[1]].weeks.push(makeSingleWeekStat(week, day));\r\n      if (period === \"days\")\r\n        stat.years[curStatIdx[0]].months[curStatIdx[1]].weeks[curStatIdx[2]].days.push(makeSingleDayStat(day));\r\n    };\r\n\r\n    const addOrIncrementPeriod = (\r\n      period: keyof PeriodsConstType,\r\n      periodStat: DateStatType,\r\n      curStatIdx: number[] = []\r\n    ): null | true => {\r\n      // search current Data's date in stat (resp it's sub-period-value)\r\n      let periodStatFilter: DateStatYearType[] | DateStatDayType[] | DateStatWeekType[] | DateStatMonthType[] | null =\r\n        null;\r\n      let filteredStatIdx = -1;\r\n      if (period === \"years\") {\r\n        periodStatFilter = (periodStat.years as DateStatYearType[]).filter((e) => e.year === year);\r\n        if (0 in periodStatFilter) filteredStatIdx = stat.years.indexOf(periodStatFilter[0]);\r\n      } else if (period === \"months\") {\r\n        if (curStatIdx.length < 1) return null;\r\n        const monthsStat = periodStat.years[curStatIdx[0]].months as DateStatMonthType[];\r\n        periodStatFilter = monthsStat.filter((e) => e.month === month);\r\n        if (0 in periodStatFilter) filteredStatIdx = stat.years[curStatIdx[0]].months.indexOf(periodStatFilter[0]);\r\n      } else if (period === \"weeks\") {\r\n        if (curStatIdx.length < 2) return null;\r\n        const weeksStat = periodStat.years[curStatIdx[0]].months[curStatIdx[1]].weeks as DateStatWeekType[];\r\n        periodStatFilter = weeksStat.filter((e) => e.week === week);\r\n        if (0 in periodStatFilter)\r\n          filteredStatIdx = stat.years[curStatIdx[0]].months[curStatIdx[1]].weeks.indexOf(periodStatFilter[0]);\r\n      } else if (period === \"days\") {\r\n        if (curStatIdx.length < 3) return null;\r\n        const daysStat = periodStat.years[curStatIdx[0]].months[curStatIdx[1]].weeks[curStatIdx[2]]\r\n          .days as DateStatDayType[];\r\n        periodStatFilter = daysStat.filter((e) => e.day === day);\r\n        if (0 in periodStatFilter)\r\n          filteredStatIdx = stat.years[curStatIdx[0]].months[curStatIdx[1]].weeks[curStatIdx[2]].days.indexOf(\r\n            periodStatFilter[0]\r\n          );\r\n      }\r\n      if (!periodStatFilter) return null; // will not occure if period is provided acc. to it's type\r\n\r\n      // period doesn't exist yet in stat\r\n      if (periodStatFilter.length === 0) {\r\n        incrementPeriodAccAmt(period);\r\n        const newPeriodStat =\r\n          period === \"years\"\r\n            ? makeSingleYearStat(year, month, week, day)\r\n            : period === \"months\"\r\n            ? makeSingleMonthStat(month, week, day)\r\n            : period === \"weeks\"\r\n            ? makeSingleWeekStat(week, day)\r\n            : period === \"days\"\r\n            ? makeSingleDayStat(day)\r\n            : null;\r\n        if (!newPeriodStat) return null; // will not occure if period is provided acc. to it's type\r\n        addPeriod(period, curStatIdx);\r\n        return true;\r\n      } else {\r\n        // period already exists in stat -> check next lower subperiod\r\n        const nextLowerPeriod =\r\n          period === \"years\" ? \"months\" : period === \"months\" ? \"weeks\" : period === \"weeks\" ? \"days\" : null;\r\n        if (!nextLowerPeriod) return null;\r\n        if (filteredStatIdx === -1) return null;\r\n        return addOrIncrementPeriod(nextLowerPeriod, periodStat, [...curStatIdx, filteredStatIdx]);\r\n      }\r\n    };\r\n    addOrIncrementPeriod(\"years\", stat);\r\n  }\r\n  return stat;\r\n};\r\n","import { createChartGraphModel, createIndicatorGraphModel, createSubChartModel } from \"../CChartModel\";\r\n// import { getGraphColors, graphColorsLight } from \"../Archiv/CChartVals\";\r\nimport { ChartDataSeries, ChartDataset, DataSeries } from \"../Types/CChartTypes\";\r\n\r\nimport {\r\n  AdditionalChartGraphStateType,\r\n  AdditionalIndicatorGraphStateType,\r\n  ChartGraphStateType,\r\n  ChartStateType,\r\n  GraphStateType,\r\n  IndicatorGraphStateType,\r\n  isChartGraph,\r\n  isIndicatorGraph,\r\n} from \"../Types/CChartStateTypes\";\r\nexport type AtLeastOne<T, U = { [K in keyof T]: Pick<T, K> }> = Partial<T> & U[keyof U];\r\nexport type ExcludeEmpty<T> = T extends AtLeastOne<T> ? T : never;\r\n\r\nexport const graphColorsLight: string[] = [\"#666\", \"#0693E3\", \"#f50057\", \"#00D084\", \"#FF6900\", \"#bd10e0\", \"#bbb\"];\r\nexport const getGraphColors = (colorArr: string[], idx: number) => colorArr[idx % colorArr.length];\r\nexport const getLightGraphColors = (idx: number) => getGraphColors(graphColorsLight, idx);\r\n\r\nexport type ReducerActionTaskType =\r\n  | \"addSubchart\"\r\n  | \"addGraph\"\r\n  | \"clearChart\"\r\n  // | \"draw\"\r\n  | \"setBackgroundColor\"\r\n  | \"setAxisFillColor\"\r\n  | \"setAxisStrokeColor\"\r\n  | \"setAxisTextColor\"\r\n  | \"toggleXaxisGrid\"\r\n  | \"toggleYaxisGrid\"\r\n  | \"setGridStrokeColor\"\r\n  | \"setLineChartStrokeColor\"\r\n  | \"setCandleChartUpColor\"\r\n  | \"setCandleChartDownColor\"\r\n  | \"setCandleChartStrokeColor\"\r\n  | \"setIndicatorParam\"\r\n  | \"updateInteractionState\"\r\n  | \"setToolStrokeColor\"\r\n  | \"setToolchorColor\"\r\n  | \"setHlineYlevel\"\r\n  | \"toggleFullscreen\"\r\n  | \"removeSubchart\"\r\n  | \"removeGraph\"\r\n  | {};\r\n\r\nexport type ReducerActionType<T extends ReducerActionTaskType = {}> = {\r\n  task: T;\r\n  params: T extends \"addSubchart\"\r\n    ? {\r\n        chartSeries: DataSeries;\r\n        chartName: string;\r\n        indicator?: AdditionalIndicatorGraphStateType[\"indicator\"];\r\n        containerHeight: number; // should not be\r\n        reset?: boolean;\r\n      }\r\n    : T extends \"removeSubchart\"\r\n    ? {\r\n        subchartIdx: number;\r\n      }\r\n    : T extends \"removeGraph\"\r\n    ? {\r\n        subchartIdx: number;\r\n        yaxisIdx: number;\r\n        graphIdx: number;\r\n      }\r\n    : T extends \"addGraph\"\r\n    ? {\r\n        chartSeries: DataSeries;\r\n        chartName: string;\r\n        subchartIdx: number;\r\n        indicator?: AdditionalIndicatorGraphStateType[\"indicator\"];\r\n      }\r\n    : T extends \"draw\"\r\n    ? {\r\n        type?: ChartStateType[\"draw\"][\"type\"];\r\n        xy?: [number, number];\r\n        subchartIdx: number;\r\n      }\r\n    : T extends\r\n        | \"setBackgroundColor\"\r\n        | \"setAxisFillColor\"\r\n        | \"setAxisStrokeColor\"\r\n        | \"setAxisTextColor\"\r\n        | \"setGridStrokeColor\"\r\n    ? { color: string }\r\n    : T extends \"toggleXaxisGrid\" | \"toggleYaxisGrid\" | \"toggleFullscreen\"\r\n    ? {}\r\n    : T extends\r\n        | \"setLineChartStrokeColor\"\r\n        | \"setCandleChartUpColor\"\r\n        | \"setCandleChartDownColor\"\r\n        | \"setCandleChartStrokeColor\"\r\n    ? { color: string; subchartIdx: number; yaxisIdx: number; graphIdx: number }\r\n    : T extends \"setToolStrokeColor\" | \"setToolAnchorColor\"\r\n    ? { color: string; subchartIdx: number; yaxisIdx: number; toolIdx: number }\r\n    : T extends \"setIndicatorParam\"\r\n    ? {\r\n        subchartIdx: number;\r\n        yaxisIdx: number;\r\n        graphIdx: number;\r\n        paramIdx: number;\r\n        val: any;\r\n      }\r\n    : T extends \"setHlineYlevel\"\r\n    ? { subchartIdx: number; yaxisIdx: number; toolIdx: number; val: number }\r\n    : T extends \"updateInteractionState\"\r\n    ? {\r\n        newState: ChartStateType;\r\n      }\r\n    : T extends \"clearChart\"\r\n    ? {\r\n        mode: \"all\" | \"indicators\" | \"tools\";\r\n      }\r\n    : {};\r\n};\r\n\r\nexport const isAddSubchartAction = (action: ReducerActionType): action is ReducerActionType<\"addSubchart\"> =>\r\n  action.task === \"addSubchart\";\r\nexport const isAddGraphAction = (action: ReducerActionType): action is ReducerActionType<\"addGraph\"> =>\r\n  action.task === \"addGraph\";\r\n// export const isDrawAction = (action: ReducerActionType): action is ReducerActionType<\"draw\"> => action.task === \"draw\";\r\nexport const isSetBackgroundColorAction = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setBackgroundColor\"> => action.task === \"setBackgroundColor\";\r\nexport const isSetAxisFillColorAction = (action: ReducerActionType): action is ReducerActionType<\"setAxisFillColor\"> =>\r\n  action.task === \"setAxisFillColor\";\r\nexport const isSetAxisStrokeColorAction = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setAxisStrokeColor\"> => action.task === \"setAxisStrokeColor\";\r\nexport const isSetAxisTextColorAction = (action: ReducerActionType): action is ReducerActionType<\"setAxisTextColor\"> =>\r\n  action.task === \"setAxisTextColor\";\r\nexport const isToggleXaxisGridAction = (action: ReducerActionType): action is ReducerActionType<\"toggleXaxisGrid\"> =>\r\n  action.task === \"toggleXaxisGrid\";\r\nexport const isToggleYaxisGridAction = (action: ReducerActionType): action is ReducerActionType<\"toggleYaxisGrid\"> =>\r\n  action.task === \"toggleYaxisGrid\";\r\nexport const isSetLineChartStrokeColor = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setLineChartStrokeColor\"> => action.task === \"setLineChartStrokeColor\";\r\nexport const isSetCandleChartUpColor = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setCandleChartUpColor\"> => action.task === \"setCandleChartUpColor\";\r\nexport const isSetCandleChartDownColor = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setCandleChartDownColor\"> => action.task === \"setCandleChartDownColor\";\r\nexport const isSetCandleChartStrokeColor = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setCandleChartStrokeColor\"> => action.task === \"setCandleChartStrokeColor\";\r\nexport const isSetIndicatorParam = (action: ReducerActionType): action is ReducerActionType<\"setIndicatorParam\"> =>\r\n  action.task === \"setIndicatorParam\";\r\nexport const isUpdateInteractionState = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"updateInteractionState\"> => action.task === \"updateInteractionState\";\r\nexport const isSetToolStrokeColorAction = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setToolStrokeColor\"> => action.task === \"setToolStrokeColor\";\r\nexport const isSetToolAnchorColor = (action: ReducerActionType): action is ReducerActionType<\"setToolAnchorColor\"> =>\r\n  action.task === \"setToolAnchorColor\";\r\nexport const isSetHlineYlevelAction = (action: ReducerActionType): action is ReducerActionType<\"setHlineYlevel\"> =>\r\n  action.task === \"setHlineYlevel\";\r\nexport const isDrawAction = (action: ReducerActionType): action is ReducerActionType<\"draw\"> => action.task === \"draw\";\r\nexport const isToggleFullscreenAction = (action: ReducerActionType): action is ReducerActionType<\"toggleFullscreen\"> =>\r\n  action.task === \"toggleFullscreen\";\r\nexport const isRemoveSubchartAction = (action: ReducerActionType): action is ReducerActionType<\"removeSubchart\"> =>\r\n  action.task === \"removeSubchart\";\r\nexport const isRemoveGraphAction = (action: ReducerActionType): action is ReducerActionType<\"removeGraph\"> =>\r\n  action.task === \"removeGraph\";\r\nexport const isSetGridStrokeColorAction = (\r\n  action: ReducerActionType\r\n): action is ReducerActionType<\"setGridStrokeColor\"> => action.task === \"setGridStrokeColor\";\r\nexport const isClearChartAction = (action: ReducerActionType): action is ReducerActionType<\"clearChart\"> =>\r\n  action.task === \"clearChart\";\r\n\r\nexport const chartStateReducer = <T>(current: ChartStateType, action: ReducerActionType<T>): ChartStateType => {\r\n  // addSubchart\r\n  if (isAddSubchartAction(action)) {\r\n    // currently all new subcharts are indicators!\r\n    const chartSeries = action.params.chartSeries;\r\n    const chartName = action.params.chartName;\r\n    const indicator = action.params.indicator;\r\n    const reset = action.params.reset;\r\n    const containerHeight = action.params.containerHeight;\r\n    const bottom = containerHeight - current.xaxis.heightXAxis;\r\n    const minMainHeight = 250;\r\n    const heightNewSubchart = Math.min(150, (bottom - minMainHeight) / (current.subCharts.length - 1 + 1));\r\n    const top = current.subCharts.length === 0 || reset ? 0 : bottom - Math.round(heightNewSubchart);\r\n    const style = !!indicator\r\n      ? { strokeColor: [getGraphColors(graphColorsLight, 0)] }\r\n      : { strokeColor: getGraphColors(graphColorsLight, 0) };\r\n\r\n    if (current.subCharts.length === 0 || !!reset) {\r\n      console.log(chartSeries.length);\r\n      return {\r\n        ...current,\r\n        xaxis: {\r\n          ...current.xaxis,\r\n          totalTranslatedX:\r\n            -(chartSeries.length +5  - (current.containerSize.width - 1) / current.xaxis.scaledWidthPerTick) *\r\n            current.xaxis.scaledWidthPerTick,\r\n        },\r\n        subCharts: [\r\n          createSubChartModel(\r\n            top,\r\n            bottom,\r\n            chartSeries as ChartDataset[],\r\n            chartName,\r\n            style as ChartGraphStateType[\"style\"] | IndicatorGraphStateType[\"style\"]\r\n          ),\r\n        ],\r\n      };\r\n    } else {\r\n      const mainHeight = current.subCharts[0].bottom - current.subCharts[0].top;\r\n      const maxHeight =\r\n        mainHeight - heightNewSubchart < minMainHeight\r\n          ? (bottom - minMainHeight - heightNewSubchart) / (current.subCharts.length - 1)\r\n          : null;\r\n\r\n      const subchart = createSubChartModel(\r\n        top,\r\n        bottom,\r\n        chartSeries as ChartDataset[],\r\n        chartName,\r\n        style as ChartGraphStateType[\"style\"] | IndicatorGraphStateType[\"style\"],\r\n        indicator\r\n      );\r\n      const newGraph = subchart.yaxis[0].graphs[0];\r\n\r\n      if (isIndicatorGraph(newGraph) && newGraph.data[newGraph.data.length - 1].prices.length > 1)\r\n        (newGraph as unknown as IndicatorGraphStateType).style.strokeColor = newGraph.data[\r\n          newGraph.data.length - 1\r\n        ].prices.map((x, idx) => getGraphColors(graphColorsLight, idx));\r\n\r\n      return {\r\n        ...current,\r\n        subCharts: [\r\n          ...current.subCharts.map((subChart, subChartIdx) => {\r\n            if (subChartIdx === 0) {\r\n              subChart.bottom = Math.max(subChart.bottom - heightNewSubchart, minMainHeight);\r\n              subChart.top = 0;\r\n            } else if (subChartIdx === current.subCharts.length - 1) {\r\n              subChart.top = current.subCharts[subChartIdx - 1].bottom;\r\n              subChart.bottom = top;\r\n            } else {\r\n              subChart.top = current.subCharts[subChartIdx - 1].bottom;\r\n              subChart.bottom = !!maxHeight\r\n                ? Math.round(subChart.top + maxHeight)\r\n                : subChart.bottom - heightNewSubchart;\r\n            }\r\n            return subChart;\r\n          }),\r\n          subchart,\r\n        ],\r\n      };\r\n    }\r\n  } else if (isRemoveSubchartAction(action)) {\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const dHeight = current.subCharts[subchartIdx].bottom - current.subCharts[subchartIdx].top;\r\n    const dHeightEach = Math.floor(dHeight / (current.subCharts.length - 1));\r\n    const dHeightRest = dHeight % (current.subCharts.length - 1);\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.slice(0, subchartIdx).map((subchartSliced, subchartSlicedIdx) => ({\r\n          ...subchartSliced,\r\n          top: subchartSliced.top === 0 ? 0 : subchartSliced.top + dHeightRest + (subchartIdx - 2) * dHeightEach,\r\n          bottom:\r\n            subchartSlicedIdx === 0\r\n              ? subchartSliced.bottom + dHeightEach + dHeightRest\r\n              : subchartSliced.bottom + dHeightEach + dHeightRest + (subchartIdx - 1) * dHeightEach,\r\n        })),\r\n        ...current.subCharts.slice(subchartIdx + 1).map((subchartSliced, subchartSlicedIdx) => ({\r\n          ...subchartSliced,\r\n          top: subchartSliced.top - (subchartSlicedIdx + 1) * dHeightEach,\r\n          bottom:\r\n            subchartSlicedIdx === current.subCharts.slice(subchartIdx + 1).length - 1\r\n              ? subchartSliced.bottom\r\n              : subchartSliced.bottom - (subchartSlicedIdx + 1) * dHeightEach,\r\n        })),\r\n      ],\r\n    };\r\n  } else if (isRemoveGraphAction(action)) {\r\n    const { subchartIdx, yaxisIdx, graphIdx } = action.params;\r\n    if (graphIdx === 0 && current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.length === 1) {\r\n      // do same like removeSubchart\r\n      const dHeight = current.subCharts[subchartIdx].bottom - current.subCharts[subchartIdx].top;\r\n      const dHeightEach = Math.floor(dHeight / (current.subCharts.length - 1));\r\n      const dHeightRest = dHeight % (current.subCharts.length - 1);\r\n      return {\r\n        ...current,\r\n        subCharts: [\r\n          ...current.subCharts.slice(0, subchartIdx).map((subchartSliced, subchartSlicedIdx) => ({\r\n            ...subchartSliced,\r\n            top: subchartSliced.top === 0 ? 0 : subchartSliced.top + dHeightRest + (subchartIdx - 2) * dHeightEach,\r\n            bottom:\r\n              subchartSlicedIdx === 0\r\n                ? subchartSliced.bottom + dHeightEach + dHeightRest\r\n                : subchartSliced.bottom + dHeightEach + dHeightRest + (subchartIdx - 1) * dHeightEach,\r\n          })),\r\n          ...current.subCharts.slice(subchartIdx + 1).map((subchartSliced, subchartSlicedIdx) => ({\r\n            ...subchartSliced,\r\n            top: subchartSliced.top - (subchartSlicedIdx + 1) * dHeightEach,\r\n            bottom:\r\n              subchartSlicedIdx === current.subCharts.slice(subchartIdx + 1).length - 1\r\n                ? subchartSliced.bottom\r\n                : subchartSliced.bottom - (subchartSlicedIdx + 1) * dHeightEach,\r\n          })),\r\n        ],\r\n      };\r\n    } else {\r\n      return {\r\n        ...current,\r\n        subCharts: [\r\n          ...current.subCharts.slice(0, subchartIdx),\r\n          {\r\n            ...current.subCharts[subchartIdx],\r\n            yaxis: [\r\n              ...current.subCharts[subchartIdx].yaxis.slice(0, yaxisIdx),\r\n              {\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n                graphs: [\r\n                  ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(0, graphIdx),\r\n                  // { ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx] },\r\n                  ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(graphIdx + 1),\r\n                ],\r\n              },\r\n              ...current.subCharts[subchartIdx].yaxis.slice(yaxisIdx + 1),\r\n            ],\r\n          },\r\n          ...current.subCharts.slice(subchartIdx + 1),\r\n        ],\r\n      };\r\n    }\r\n  } else if (isClearChartAction(action)) {\r\n    const mode = action.params.mode;\r\n    if (mode === \"all\") {\r\n      return {\r\n        ...current,\r\n        subCharts: [\r\n          {\r\n            ...current.subCharts[0],\r\n            yaxis: [{ ...current.subCharts[0].yaxis[0], graphs: [current.subCharts[0].yaxis[0].graphs[0]], tools: [] }],\r\n          },\r\n        ],\r\n      };\r\n    } else if (mode === \"indicators\") {\r\n      return {\r\n        ...current,\r\n        subCharts: [\r\n          {\r\n            ...current.subCharts[0],\r\n            yaxis: [{ ...current.subCharts[0].yaxis[0], graphs: [current.subCharts[0].yaxis[0].graphs[0]] }],\r\n            top: 0,\r\n            bottom: current.containerSize.height - 1 - current.xaxis.heightXAxis,\r\n          },\r\n        ],\r\n      };\r\n    } else if (mode === \"tools\") {\r\n      return {\r\n        ...current,\r\n        subCharts: current.subCharts.map((subchart, subchartIdx) => ({\r\n          ...subchart,\r\n          yaxis: subchart.yaxis.map((yaxis, yaxisIdx) => ({ ...yaxis, tools: [] })),\r\n        })),\r\n      };\r\n    }\r\n  } else if (isAddGraphAction(action)) {\r\n    const chartSeries = action.params.chartSeries;\r\n    const chartName = action.params.chartName;\r\n    const indicator = !!action.params.indicator ? action.params.indicator : null;\r\n    const subchartIdx = action.params.subchartIdx;\r\n    // const style = {\r\n    //   strokeColor: getGraphColors(graphColorsLight, current.subCharts[subchartIdx].yaxis[0].graphs.length),\r\n    // };\r\n    const style = !!indicator\r\n      ? { strokeColor: [getGraphColors(graphColorsLight, current.subCharts[subchartIdx].yaxis[0].graphs.length)] }\r\n      : { strokeColor: getGraphColors(graphColorsLight, current.subCharts[subchartIdx].yaxis[0].graphs.length) };\r\n\r\n    const newGraph = !!indicator\r\n      ? createIndicatorGraphModel(\r\n          chartSeries as ChartDataSeries,\r\n          chartName,\r\n          indicator,\r\n          style as unknown as IndicatorGraphStateType[\"style\"]\r\n        )\r\n      : createChartGraphModel(chartSeries as ChartDataSeries, chartName, style as ChartGraphStateType[\"style\"]);\r\n    const graph = newGraph as GraphStateType;\r\n    if (isIndicatorGraph(graph) && graph.data[newGraph.data.length - 1].prices.length > 1)\r\n      (graph as unknown as IndicatorGraphStateType).style.strokeColor = graph.data[newGraph.data.length - 1].prices.map(\r\n        (x, idx) => getGraphColors(graphColorsLight, idx)\r\n      );\r\n\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.map((subChart, subChartIdx) => {\r\n          if (subChartIdx === subchartIdx)\r\n            return {\r\n              ...subChart,\r\n              yaxis: [{ ...subChart.yaxis[0], graphs: [...subChart.yaxis[0].graphs, { ...(newGraph as any) }] }],\r\n            };\r\n          else return subChart;\r\n        }),\r\n      ],\r\n    };\r\n  } else if (isDrawAction(action)) {\r\n    const xy = action.params.xy;\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const defaultDrawState: ChartStateType[\"draw\"] = { isDrawing: false, pixXy: [] };\r\n    const nPoints = !action.params.type\r\n      ? 0\r\n      : [\"hline\", \"vline\"].includes(action.params.type)\r\n      ? 1\r\n      : [\"trendline\"].includes(action.params.type)\r\n      ? 2\r\n      : 0;\r\n    // console.log(\"HI\", xy, subchartIdx, nPoints, action);\r\n\r\n    if (!nPoints || !action.params.type) {\r\n      return { ...current, draw: defaultDrawState };\r\n    }\r\n    // init draw command -> switch to draw mode\r\n    else if (!xy && !!action.params.type) {\r\n      return { ...current, draw: { isDrawing: true, pixXy: [], type: action.params.type } };\r\n    }\r\n    return current;\r\n  } else if (isSetBackgroundColorAction(action)) {\r\n    const color = action.params.color;\r\n    return { ...current, backgroundColor: color };\r\n  } else if (isSetGridStrokeColorAction(action)) {\r\n    const color = action.params.color;\r\n    return {\r\n      ...current,\r\n      grid: { ...current.grid, style: { ...current.grid.style, strokeColor: color } },\r\n    };\r\n  } else if (isSetAxisFillColorAction(action)) {\r\n    const color = action.params.color;\r\n    return {\r\n      ...current,\r\n      xaxis: {\r\n        ...current.xaxis,\r\n        style: { ...current.xaxis.style, fillColor: color },\r\n      },\r\n      yaxis: { ...current.yaxis, style: { ...current.yaxis.style, fillColor: color } },\r\n    };\r\n  } else if (isSetAxisStrokeColorAction(action)) {\r\n    const color = action.params.color;\r\n    return {\r\n      ...current,\r\n      xaxis: {\r\n        ...current.xaxis,\r\n        style: { ...current.xaxis.style, strokeColor: color },\r\n      },\r\n      yaxis: { ...current.yaxis, style: { ...current.yaxis.style, strokeColor: color } },\r\n    };\r\n  } else if (isSetAxisTextColorAction(action)) {\r\n    const color = action.params.color;\r\n    return {\r\n      ...current,\r\n      xaxis: {\r\n        ...current.xaxis,\r\n        style: { ...current.xaxis.style, fontColor: color },\r\n      },\r\n      yaxis: { ...current.yaxis, style: { ...current.yaxis.style, fontColor: color } },\r\n    };\r\n  } else if (isToggleXaxisGridAction(action)) {\r\n    return {\r\n      ...current,\r\n      grid: { ...current.grid, useGridX: !current.grid.useGridX },\r\n    };\r\n  } else if (isToggleYaxisGridAction(action)) {\r\n    return {\r\n      ...current,\r\n      grid: { ...current.grid, useGridY: !current.grid.useGridY },\r\n    };\r\n  } else if (isToggleFullscreenAction(action)) {\r\n    return { ...current, fullscreen: !current.fullscreen };\r\n  } else if (isSetLineChartStrokeColor(action)) {\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const yaxisIdx = action.params.yaxisIdx;\r\n    const graphIdx = action.params.graphIdx;\r\n    const color = action.params.color;\r\n    const graph = current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx];\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.slice(0, subchartIdx),\r\n        {\r\n          ...current.subCharts[subchartIdx],\r\n          yaxis: [\r\n            {\r\n              ...current.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n              graphs: [\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(0, graphIdx),\r\n                {\r\n                  ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx],\r\n                  style: {\r\n                    ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx].style,\r\n                    strokeColor: [color],\r\n                  },\r\n                },\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(graphIdx + 1),\r\n              ],\r\n            },\r\n          ],\r\n        },\r\n        ...current.subCharts.slice(subchartIdx + 1),\r\n      ],\r\n    };\r\n  } else if (\r\n    isSetCandleChartUpColor(action) ||\r\n    isSetCandleChartDownColor(action) ||\r\n    isSetCandleChartStrokeColor(action)\r\n  ) {\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const yaxisIdx = action.params.yaxisIdx;\r\n    const graphIdx = action.params.graphIdx;\r\n    const color = action.params.color;\r\n    const prop = isSetCandleChartUpColor(action)\r\n      ? \"candleUpColor\"\r\n      : isSetCandleChartDownColor(action)\r\n      ? \"candleDownColor\"\r\n      : isSetCandleChartStrokeColor(action)\r\n      ? \"candleStrokeColor\"\r\n      : null;\r\n    if (!prop) return current;\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.slice(0, subchartIdx),\r\n        {\r\n          ...current.subCharts[subchartIdx],\r\n          yaxis: [\r\n            {\r\n              ...current.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n              graphs: [\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(0, graphIdx),\r\n                {\r\n                  ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx],\r\n                  style: {\r\n                    ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx].style,\r\n                    [prop]: color,\r\n                  },\r\n                },\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(graphIdx + 1),\r\n              ],\r\n            },\r\n          ],\r\n        },\r\n        ...current.subCharts.slice(subchartIdx + 1),\r\n      ],\r\n    };\r\n  } else if (isSetToolStrokeColorAction(action) || isSetToolAnchorColor(action)) {\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const yaxisIdx = action.params.yaxisIdx;\r\n    const graphIdx = action.params.toolIdx;\r\n    const color = action.params.color;\r\n    const prop = isSetToolStrokeColorAction(action)\r\n      ? \"strokeColor\"\r\n      : isSetToolAnchorColor(action)\r\n      ? \"anchorColor\"\r\n      : null;\r\n    if (!prop) return current;\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.slice(0, subchartIdx),\r\n        {\r\n          ...current.subCharts[subchartIdx],\r\n          yaxis: [\r\n            {\r\n              ...current.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n              tools: [\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools.slice(0, graphIdx),\r\n                {\r\n                  ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools[graphIdx],\r\n                  style: {\r\n                    ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools[graphIdx].style,\r\n                    [prop]: color,\r\n                  },\r\n                },\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools.slice(graphIdx + 1),\r\n              ],\r\n            },\r\n          ],\r\n        },\r\n        ...current.subCharts.slice(subchartIdx + 1),\r\n      ],\r\n    };\r\n  } else if (isSetIndicatorParam(action)) {\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const yaxisIdx = action.params.yaxisIdx;\r\n    const graphIdx = action.params.graphIdx;\r\n    const paramIdx = action.params.paramIdx;\r\n    const val = action.params.val;\r\n\r\n    const indicatorGraph = current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx];\r\n\r\n    if (!isIndicatorGraph(indicatorGraph)) return current;\r\n    const fn = indicatorGraph.indicator.indicatorFn;\r\n    const srcData = current.subCharts[0].yaxis[0].graphs[0].data as ChartDataSeries;\r\n    let params = indicatorGraph.indicator.params.map((val) => val.val);\r\n    params[paramIdx] = val;\r\n    const indicatorData = fn(srcData, indicatorGraph.name, ...params);\r\n    // console.log(\r\n    //   \"HI!! HII!\",\r\n    //   val,\r\n    //   subchartIdx,\r\n    //   yaxisIdx,\r\n    //   graphIdx,\r\n    //   paramIdx,\r\n    //   isIndicatorGraph(indicatorGraph),\r\n    //   params,\r\n    //   indicatorData,\r\n    //   {\r\n    //     ...indicatorGraph.indicator,\r\n    //     params: [\r\n    //       ...indicatorGraph.indicator.params.slice(0, paramIdx),\r\n    //       {\r\n    //         ...indicatorGraph.indicator.params[paramIdx],\r\n    //         val: val,\r\n    //       },\r\n    //       ...indicatorGraph.indicator.params.slice(paramIdx + 1),\r\n    //     ],\r\n    //   }\r\n    // );\r\n    // const newIndicatorGraph = { ...indicatorGraph };\r\n    // newIndicatorGraph.data = indicatorData;\r\n    // newIndicatorGraph.indicator.params[paramIdx].val = val;\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.slice(0, subchartIdx),\r\n        {\r\n          ...current.subCharts[subchartIdx],\r\n          yaxis: [\r\n            {\r\n              ...current.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n              graphs: [\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(0, graphIdx),\r\n                {\r\n                  ...indicatorGraph,\r\n                  data: indicatorData,\r\n                  indicator: {\r\n                    ...indicatorGraph.indicator,\r\n                    params: [\r\n                      ...indicatorGraph.indicator.params.slice(0, paramIdx),\r\n                      {\r\n                        ...indicatorGraph.indicator.params[paramIdx],\r\n                        val: val,\r\n                      },\r\n                      ...indicatorGraph.indicator.params.slice(paramIdx + 1),\r\n                    ],\r\n                  },\r\n                } as any,\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].graphs.slice(graphIdx + 1),\r\n              ],\r\n            },\r\n          ],\r\n        },\r\n        ...current.subCharts.slice(subchartIdx + 1),\r\n      ],\r\n    };\r\n  } else if (isSetHlineYlevelAction(action)) {\r\n    const subchartIdx = action.params.subchartIdx;\r\n    const yaxisIdx = action.params.yaxisIdx;\r\n    const toolIdx = action.params.toolIdx;\r\n    const val = action.params.val as number;\r\n    const anchorX = current.subCharts[subchartIdx].yaxis[yaxisIdx].tools[toolIdx].xy[0][0];\r\n    const newAnchor: [number, number] = [anchorX, val];\r\n    return {\r\n      ...current,\r\n      subCharts: [\r\n        ...current.subCharts.slice(0, subchartIdx),\r\n        {\r\n          ...current.subCharts[subchartIdx],\r\n          yaxis: [\r\n            {\r\n              ...current.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n              tools: [\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools.slice(0, toolIdx),\r\n                { ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools[toolIdx], xy: [newAnchor] },\r\n                ...current.subCharts[subchartIdx].yaxis[yaxisIdx].tools.slice(toolIdx + 1),\r\n              ],\r\n            },\r\n          ],\r\n        },\r\n        ...current.subCharts.slice(subchartIdx + 1),\r\n      ],\r\n    };\r\n  } else if (isUpdateInteractionState(action)) {\r\n    // const nSubcharts = current.subCharts.length;\r\n    return {\r\n      ...current,\r\n      pointer: action.params.newState.pointer,\r\n      containerSize: action.params.newState.containerSize,\r\n      // xaxis: { ...current.xaxis, ...action.params.newState.xaxis },\r\n      subCharts: action.params.newState.subCharts,\r\n      draw: { ...current.draw, ...action.params.newState.draw },\r\n      xaxis: { ...current.xaxis, ...action.params.newState.xaxis },\r\n    };\r\n  }\r\n\r\n  return current;\r\n};\r\n","import { ReducerActionTaskType, ReducerActionType } from \"./CChartStateReducer\";\r\nimport { ChartDataSeries, DataSeries } from \"../Types/CChartTypes\";\r\n\r\nimport {\r\n  AdditionalIndicatorGraphStateType,\r\n  ChartStateType,\r\n  CalculatedChartStateType,\r\n  TypedDispatcher,\r\n} from \"../Types/CChartStateTypes\";\r\nconst addSubchart = (\r\n  chartSeries: DataSeries,\r\n  chartName: string,\r\n  containerHeight: number,\r\n  Dispatch: TypedDispatcher<\"addSubchart\">,\r\n  indicator?: AdditionalIndicatorGraphStateType[\"indicator\"],\r\n  reset?: boolean\r\n) => {\r\n  const action: ReducerActionType<\"addSubchart\"> = {\r\n    task: \"addSubchart\",\r\n    params: { chartSeries, chartName, indicator, containerHeight, reset },\r\n  };\r\n  Dispatch(action);\r\n};\r\n\r\nconst addGraph = (\r\n  chartSeries: DataSeries,\r\n  chartName: string,\r\n  subchartIdx: number,\r\n  Dispatch: TypedDispatcher<\"addGraph\">,\r\n  indicator?: AdditionalIndicatorGraphStateType[\"indicator\"]\r\n) => {\r\n  const action: ReducerActionType<\"addGraph\"> = {\r\n    task: \"addGraph\",\r\n    params: { subchartIdx, chartSeries, indicator, chartName },\r\n  };\r\n  (Dispatch as React.Dispatch<ReducerActionType<\"addGraph\">>)(action);\r\n};\r\n\r\nexport const pixToX = (pixX: number, translated: number, widthPerTick: number) => {\r\n  return (pixX - translated) / widthPerTick;\r\n};\r\n\r\nexport const getChartMethods = (\r\n  ChartState: ChartStateType,\r\n  containerHeight: number,\r\n  Dispatch: TypedDispatcher<ReducerActionTaskType>\r\n): CalculatedChartStateType[\"methods\"] => ({\r\n  addGraph: (\r\n    chartSeries: ChartDataSeries,\r\n    chartName: string,\r\n    subchartIdx: number,\r\n    indicator?: AdditionalIndicatorGraphStateType[\"indicator\"]\r\n  ) => addGraph(chartSeries, chartName, subchartIdx, Dispatch, indicator),\r\n  addSubchart: (\r\n    chartSeries: DataSeries,\r\n    chartName: string,\r\n    indicator?: AdditionalIndicatorGraphStateType[\"indicator\"],\r\n    reset?: boolean\r\n  ) => addSubchart(chartSeries, chartName, containerHeight, Dispatch, indicator, reset),\r\n  getSubchart: (subchartIdx: number) => ChartState.subCharts[subchartIdx],\r\n  getYaxis: (subchartIdx: number, yaxisIdx: number) => ChartState.subCharts[subchartIdx].yaxis[yaxisIdx],\r\n  getGraph: (subchartIdx: number, yaxisIdx: number, graphIdx: number) =>\r\n    ChartState.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx],\r\n  xToPix: (x: number, translatedX?: number) => {\r\n    const { widthPerTick, totalTranslatedX } = ChartState.xaxis;\r\n    const translatedXint = translatedX !== undefined ? translatedX : totalTranslatedX;\r\n    return x * widthPerTick + translatedXint;\r\n  },\r\n  pixToX: (pixX: number, translatedX?: number) => {\r\n    const { widthPerTick, totalTranslatedX } = ChartState.xaxis;\r\n    const translatedXint = translatedX !== undefined ? translatedX : totalTranslatedX;\r\n    return (pixX - translatedXint) / widthPerTick;\r\n  },\r\n  yToPix: (y: number, subchartIdx: number, yaxisIdx: number, translatedY?: number) => {\r\n    const { heightPerPt, decimals, translatedY: stateTranslatedY } = ChartState.subCharts[subchartIdx].yaxis[yaxisIdx];\r\n    const translatedYint = translatedY !== undefined ? translatedY : stateTranslatedY;\r\n    return ChartState.subCharts[subchartIdx].bottom - y * Math.pow(10, decimals) * heightPerPt + translatedYint;\r\n  },\r\n  pixToY: (pixY: number, subchartIdx: number, yaxisIdx: number, translatedY?: number) => {\r\n    const { heightPerPt, decimals, translatedY: stateTranslatedY } = ChartState.subCharts[subchartIdx].yaxis[yaxisIdx];\r\n    const translatedYint = translatedY !== undefined ? translatedY : stateTranslatedY;\r\n    return ((ChartState.subCharts[subchartIdx].bottom + translatedYint - pixY) / heightPerPt) * Math.pow(10, -decimals);\r\n  },\r\n});\r\n","// import { pixToX } from \"../CChart\";\r\nimport { getDateString } from \"../Time/CChartDateTime\";\r\nimport { getOptimalPeriod, isNewPeriod } from \"../Time/CChartPeriod\";\r\nimport { InteractiveXaxisType, ChartGraphStateType, ChartStateType } from \"../Types/CChartStateTypes\";\r\nimport { ChartPeriodType } from \"../Types/CChartTimeTypes\";\r\n\r\nexport const pureXToPix = (x: number, translated: number, widthPerTick: number) => {\r\n  return x * widthPerTick + translated;\r\n};\r\nexport const purePixToX = (pixX: number, translated: number, widthPerTick: number) => {\r\n  return (pixX - translated) / widthPerTick;\r\n};\r\n\r\nexport const getInteractiveXaxisState = (\r\n  currentXaxis: InteractiveXaxisType & { scaleInitWidthPerTick: number | null; scaleInitTranslatedX: number },\r\n  onDrag: ChartStateType[\"pointer\"][\"drag\"],\r\n  wheel: ChartStateType[\"pointer\"][\"wheel\"],\r\n  onMove: ChartStateType[\"pointer\"][\"move\"],\r\n  initWidthTickX: number,\r\n  shallUpdateDrag: boolean,\r\n  clickedChart: boolean,\r\n  clickedXaxis: boolean,\r\n  canvasWidth: number,\r\n  nDatasets: number,\r\n): InteractiveXaxisType & { scaleInitWidthPerTick: number | null; scaleInitTranslatedX: number } => {\r\n  const isWheeling = !!wheel?.isWheeling;\r\n  const wheeldY = wheel?.delta[1];\r\n  const initWheelMousePos = onMove?.xy;\r\n\r\n  const scaleFn = (pixX: number) => {\r\n    const delta =\r\n      Math.round(\r\n        Math.min(\r\n          (Math.max(pixX + 640, 0) * (initWidthTickX - 0.5)) / 640 - (initWidthTickX - 0.5),\r\n          -initWidthTickX + canvasWidth / 3\r\n        ) / 0.5\r\n      ) * 0.5;\r\n    return delta;\r\n  };\r\n\r\n  // console.log(currentXaxis.xEnd - currentXaxis.xStart, currentXaxis.xStart, currentXaxis.xEnd);\r\n  if (!!shallUpdateDrag) {\r\n    const init = onDrag?.initial;\r\n    if (!init) return currentXaxis;\r\n    if (clickedChart && !wheeldY) {\r\n      const totalTranslatedX = !!onDrag?.delta\r\n        ? Math.max(\r\n            Math.min(\r\n              onDrag.delta[0] + currentXaxis.totalTranslatedX,\r\n              canvasWidth - 2 * currentXaxis.scaledWidthPerTick\r\n            ),\r\n            -( (nDatasets - 3) * currentXaxis.scaledWidthPerTick)\r\n          )\r\n        : currentXaxis.totalTranslatedX;\r\n      return { ...currentXaxis, totalTranslatedX };\r\n    } else if (clickedXaxis && !wheeldY) {\r\n      let scaleInitWidthPerTick: number | null = !currentXaxis.scaleInitWidthPerTick\r\n        ? currentXaxis.scaledWidthPerTick\r\n        : currentXaxis.scaleInitWidthPerTick;\r\n      const scaleInitTranslatedX = !currentXaxis.scaleInitTranslatedX\r\n        ? currentXaxis.totalTranslatedX\r\n        : currentXaxis.scaleInitTranslatedX;\r\n      // shall not scale lower than tickWidth of 0.5\r\n      let totalScaleX = !!onDrag?.delta ? currentXaxis.totalScaleX + onDrag?.delta[0] : currentXaxis.totalScaleX;\r\n      totalScaleX = Math.min(\r\n        Math.max(totalScaleX, -640),\r\n        ((-initWidthTickX + canvasWidth / 3 + initWidthTickX - 0.5) * 640) / (initWidthTickX - 0.5) - 640\r\n      );\r\n      const scaledWidthPerTick = initWidthTickX + scaleFn(totalScaleX);\r\n      const translatedXonStart = scaleInitTranslatedX;\r\n      const initPixX = init[0];\r\n      const initXexact = (init[0] - translatedXonStart) / (scaleInitWidthPerTick as number);\r\n      const newPos = initXexact * scaledWidthPerTick + translatedXonStart;\r\n\r\n      const totalTranslatedX = scaleInitTranslatedX - newPos + initPixX;\r\n      if (!onDrag?.isDragging) {\r\n        scaleInitWidthPerTick = null;\r\n      }\r\n      return {\r\n        ...currentXaxis,\r\n        scaleInitWidthPerTick,\r\n        scaleInitTranslatedX,\r\n        totalScaleX,\r\n        scaledWidthPerTick,\r\n        totalTranslatedX,\r\n      };\r\n    }\r\n  } else if (!!isWheeling && !!wheeldY) {\r\n    let scaleInitWidthPerTick: number | null = currentXaxis.scaledWidthPerTick;\r\n    const scaleInitTranslatedX = currentXaxis.totalTranslatedX;\r\n\r\n    // shall not scale lower than tickWidth of 0.5\r\n    let totalScaleX = currentXaxis.totalScaleX + wheeldY / 10;\r\n    totalScaleX = Math.min(\r\n      Math.max(totalScaleX, -640),\r\n      ((-initWidthTickX + canvasWidth / 3 + initWidthTickX - 0.5) * 640) / (initWidthTickX - 0.5) - 640\r\n    );\r\n    const scaledWidthPerTick = initWidthTickX + scaleFn(totalScaleX);\r\n    const translatedXonStart = scaleInitTranslatedX;\r\n    const initPixX = !!initWheelMousePos ? initWheelMousePos[0] : 0;\r\n    const initXexact =\r\n      ((!!initWheelMousePos ? initWheelMousePos[0] : 0) - translatedXonStart) / (scaleInitWidthPerTick as number);\r\n    const newPos = Math.round(initXexact) * scaledWidthPerTick + currentXaxis.totalTranslatedX; //translatedXonStart;\r\n\r\n    const totalTranslatedX = (scaleInitTranslatedX as number) - newPos + initPixX;\r\n    if (!isWheeling) {\r\n      scaleInitWidthPerTick = null;\r\n    }\r\n    return {\r\n      ...currentXaxis,\r\n      scaleInitWidthPerTick,\r\n      scaleInitTranslatedX,\r\n      totalScaleX,\r\n      scaledWidthPerTick,\r\n      totalTranslatedX,\r\n    };\r\n  }\r\n  return currentXaxis;\r\n};\r\n\r\nexport const calculateCurrentXaxis = (\r\n  widthPerTick: number,\r\n  translatedPixX: number,\r\n  containerWidth: number,\r\n  widthYAxis: number,\r\n  mainGraph: ChartGraphStateType | null\r\n): Omit<\r\n  ChartStateType[\"xaxis\"],\r\n  | \"style\"\r\n  | \"heightXAxis\"\r\n  | \"heightTickMarkLines\"\r\n  | \"totalTranslatedX\"\r\n  | \"totalScaleX\"\r\n  | \"scaledWidthPerTick\"\r\n  | \"scaleInitWidthPerTick\"\r\n  | \"scaleInitTranslatedX\"\r\n> => {\r\n  const xAxisTicks: { x: number; dateString: string }[] = [];\r\n\r\n  const xStart = Math.max(Math.ceil(-translatedPixX / widthPerTick), 0);\r\n  const nMainData = mainGraph?.data.length;\r\n  const pixXStart = Math.max(Math.ceil(-translatedPixX / widthPerTick), 0) * widthPerTick + translatedPixX;\r\n  let pixXend = 0,\r\n    xEnd = 0;\r\n  const startNoDataPeriod = Math.abs(Math.min(Math.ceil(-translatedPixX / widthPerTick), 0));\r\n  let endNoDataPeriod = 0;\r\n  let noDataPeriodPortion = 0;\r\n  let optPeriodRes = null;\r\n  if (!!containerWidth && !!widthYAxis && !!nMainData) {\r\n    // pixXend = Math.min(containerWidth - widthYAxis, nMainData * widthPerTick + translatedPixX);\r\n    // xEnd = Math.min(Math.floor((pixXend - translatedPixX) / widthPerTick), nMainData - 1);\r\n    // endNoDataPeriod = Math.max(\r\n    //   Math.floor((containerWidth - widthYAxis - translatedPixX) / widthPerTick) - nMainData,\r\n    //   0\r\n    // );\r\n    pixXend = Math.min(containerWidth, nMainData * widthPerTick + translatedPixX);\r\n    xEnd = Math.min(Math.floor((pixXend - translatedPixX) / widthPerTick), nMainData - 1);\r\n    endNoDataPeriod = Math.max(Math.floor((containerWidth - translatedPixX) / widthPerTick) - nMainData, 0);\r\n\r\n    noDataPeriodPortion = (startNoDataPeriod + endNoDataPeriod) / (xEnd - xStart + startNoDataPeriod + endNoDataPeriod);\r\n    \r\n    if (!!mainGraph) {\r\n      optPeriodRes = getOptimalPeriod(\r\n        mainGraph.data,\r\n        xStart,\r\n        xEnd,\r\n        mainGraph.meta,\r\n        noDataPeriodPortion,\r\n        Object.assign({}, mainGraph.dateStat)\r\n      );\r\n// console.log(mainGraph, optPeriodRes, mainGraph?.meta.chartPeriod);\r\n      if (!!optPeriodRes && !!mainGraph.meta.chartPeriod) {\r\n        let pixXi = pixXStart;\r\n        let xi = xStart;\r\n        while (pixXi < pixXend) {\r\n          const periodToDraw = isNewPeriod(mainGraph.data[xi].date, mainGraph.dateStat, mainGraph.meta.chartPeriod, {\r\n            ...(optPeriodRes as ChartPeriodType),\r\n          });\r\n          if (!periodToDraw) {\r\n            pixXi += widthPerTick;\r\n            xi++;\r\n            continue;\r\n          }\r\n          const dateString = getDateString(mainGraph.data[xi].date, periodToDraw);\r\n          xAxisTicks.push({ x: pixXi, dateString: dateString.toString() });\r\n          pixXi += widthPerTick;\r\n          xi++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    xStart: xStart,\r\n    pixXStart: pixXStart,\r\n    xEnd: xEnd,\r\n    pixXEnd: pixXend,\r\n    widthPerTick,\r\n    startNoDataPeriod,\r\n    endNoDataPeriod,\r\n    noDataPeriodPortion,\r\n    xAxisTicks,\r\n    optPeriodRes,\r\n  };\r\n};\r\n","import { CalculatedChartStateType, ChartStateType, isIndicatorGraph } from \"../Types/CChartStateTypes\";\r\nimport { DataSeries, Dataset, isCandleChartDataset, isIndicatorDataset } from \"../Types/CChartTypes\";\r\nimport { getDecimals, isNullish } from \"../utils\";\r\n\r\nexport const pureYToPix = (y: number, pixYBottom: number, decimals: number, translatedY: number, pixPerPt: number) => {\r\n  return pixYBottom - y * Math.pow(10, decimals) * pixPerPt + translatedY;\r\n};\r\nexport const purePixToY = (\r\n  pixY: number,\r\n  pixYBottom: number,\r\n  decimals: number,\r\n  translatedY: number,\r\n  pixPerPt: number\r\n) => {\r\n  return ((pixYBottom + translatedY - pixY) / pixPerPt) * Math.pow(10, -decimals);\r\n};\r\n\r\nexport const snapPixYToPrices = (\r\n  pixY: number,\r\n  dataset: Dataset,\r\n  subcharts: ChartStateType[\"subCharts\"] | null,\r\n  subchartIdx: number,\r\n  yaxisIdx: number,\r\n  snapTolerance?: number\r\n) => {\r\n  const snapTol = !!snapTolerance ? snapTolerance : 10;\r\n  if (isNullish(pixY) || isNullish(subcharts) || isNullish(subchartIdx) || isNullish(yaxisIdx) || isNullish(dataset))\r\n    return null;\r\n  const prices = [];\r\n  if (isIndicatorDataset(dataset)) {\r\n    if (!!dataset.prices[0]) prices.push(dataset.prices[0]);\r\n  } else {\r\n    if (isCandleChartDataset(dataset)) prices.push(dataset.open, dataset.high, dataset.low, dataset.close);\r\n    else prices.push(dataset.close);\r\n  }\r\n  if (prices.length === 0) return null;\r\n\r\n  let snapRes: { y: string; pixY: number }[] = [];\r\n  prices.forEach((price, priceIdx) => {\r\n    const yPixPrice = pureYToPix(\r\n      price,\r\n      subcharts[subchartIdx].bottom,\r\n      subcharts[subchartIdx].yaxis[yaxisIdx].decimals,\r\n      subcharts[subchartIdx].yaxis[yaxisIdx].translatedY,\r\n      subcharts[subchartIdx].yaxis[yaxisIdx].heightPerPt\r\n    );\r\n    if (yPixPrice >= pixY - snapTol && yPixPrice <= pixY + snapTol) {\r\n      snapRes.push({ y: price.toFixed(getDecimals(price)), pixY: yPixPrice });\r\n    }\r\n  });\r\n\r\n  if (!!snapRes)\r\n    return snapRes.sort((a, b) => {\r\n      if (Math.abs(a.pixY - pixY) < Math.abs(b.pixY - pixY)) return -1;\r\n      else if (Math.abs(a.pixY - pixY) > Math.abs(b.pixY - pixY)) return 1;\r\n      return 0;\r\n    });\r\n  return null;\r\n  // for (let i = 0; i < prices.length; i++) {\r\n  //   const price = prices[i];\r\n  //   const yPixPrice = pureYToPix(\r\n  //     price,\r\n  //     subcharts[subchartIdx].bottom,\r\n  //     subcharts[subchartIdx].yaxis[yaxisIdx].decimals,\r\n  //     subcharts[subchartIdx].yaxis[yaxisIdx].translatedY,\r\n  //     subcharts[subchartIdx].yaxis[yaxisIdx].heightPerPt\r\n  //   );\r\n  //   if (yPixPrice >= pixY - snapTol && yPixPrice <= pixY + snapTol) {\r\n  //     snapRes.push({ y: price.toFixed(getDecimals(price)), pixY: yPixPrice });\r\n  //   }\r\n  // }\r\n  // if (snapRes.length > 0) {\r\n  // }\r\n};\r\n\r\nexport function GetYOptInterval(max: number, min: number, dec: number, targetSteps: number) {\r\n  let initIntervalStep = 1 / Math.pow(10, dec);\r\n  let curIntervalStep = initIntervalStep;\r\n  let optIntervalStep = curIntervalStep;\r\n  const optimizationFunction = (steps: number) => Math.abs((max - min) / steps - targetSteps);\r\n  let optimizer = optimizationFunction(curIntervalStep); // - targetSteps);\r\n\r\n  let i = 0;\r\n  while (curIntervalStep < max - min) {\r\n    for (let j = 0; j <= 2; j++) {\r\n      const factor = j === 0 ? 1 : j === 1 ? 2.5 : 5.0;\r\n      let curOptimizerRes = optimizationFunction(curIntervalStep * factor);\r\n      if (curOptimizerRes < optimizer) {\r\n        optimizer = curOptimizerRes;\r\n        optIntervalStep = curIntervalStep * factor;\r\n      }\r\n    }\r\n    i++;\r\n    curIntervalStep = initIntervalStep * Math.pow(10, i);\r\n  }\r\n  return parseFloat(optIntervalStep.toFixed(dec));\r\n}\r\n\r\nexport const calculateCurrentGraphs = (\r\n  subcharts: ChartStateType[\"subCharts\"] | undefined,\r\n  widthPerTick: number,\r\n  xStart: number,\r\n  xEnd: number,\r\n  pixXstart: number,\r\n  pixXend: number\r\n): CalculatedChartStateType[\"subCharts\"] | null => {\r\n  if (!subcharts) return null;\r\n  if (subcharts.length === 0) return null;\r\n\r\n  const calculatedSubcharts = subcharts;\r\n\r\n  calculatedSubcharts.forEach((subchart, subchartIdx) => {\r\n    const mainYaxis: { pixY: number; label: string }[] = [];\r\n    subchart.yaxis.forEach((yaxis, yaxisIdx) => {\r\n      let yMinExactAllGraphs: number | null = null;\r\n      let yMaxExactAllGraphs: number | null = null;\r\n      let maxDecimals: number = 0;\r\n      yaxis.graphs.forEach((graphM, graphIdx) => {\r\n        const graph = calculatedSubcharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx];\r\n        const data = graph.data;\r\n        graph.datasets.last = {\r\n          data: data[xEnd],\r\n          x: xEnd,\r\n          pixX: pixXend,\r\n          dateString: \"\",\r\n        };\r\n        graph.datasets.first = {\r\n          data: data[xStart],\r\n          x: xStart,\r\n          pixX: pixXstart,\r\n          dateString: \"\",\r\n        };\r\n        const curData = graph.data.filter((val, idx) => idx >= xStart && idx <= xEnd) as DataSeries;\r\n        graph.curData = curData;\r\n        graph.yMaxExact =\r\n          isIndicatorGraph(graph) && !!graph?.indicator?.default?.fixedYScale\r\n            ? graph?.indicator?.default?.fixedYScale[1]\r\n            : Math.max(\r\n                ...curData.map((dataset) => {\r\n                  if (isIndicatorDataset(dataset)) {\r\n                    const max = Math.max(...(dataset.prices.filter((price) => price !== null) as number[]));\r\n                    if (!max && max !== 0) return 0;\r\n                    return max;\r\n                  }\r\n                  if (isCandleChartDataset(dataset)) return dataset.high;\r\n                  return dataset.close;\r\n                })\r\n              );\r\n        graph.yMinExact =\r\n          isIndicatorGraph(graph) && !!graph?.indicator?.default?.fixedYScale\r\n            ? graph?.indicator?.default?.fixedYScale[0]\r\n            : Math.min(\r\n                ...curData.map((dataset) => {\r\n                  if (isIndicatorDataset(dataset)) {\r\n                    const min = Math.min(...(dataset.prices.filter((price) => price !== null) as number[]));\r\n                    if (!min && min !== 0) return 0;\r\n                    return min;\r\n                  }\r\n                  if (isCandleChartDataset(dataset)) return dataset.low;\r\n                  return dataset.close;\r\n                })\r\n              );\r\n        if (yMinExactAllGraphs === null || graph.yMinExact < yMinExactAllGraphs) yMinExactAllGraphs = graph.yMinExact;\r\n        if (yMaxExactAllGraphs === null || graph.yMaxExact > yMaxExactAllGraphs) yMaxExactAllGraphs = graph.yMaxExact;\r\n        if (graph.decimals > maxDecimals) maxDecimals = graph.decimals;\r\n      });\r\n\r\n      // target scale interval should be 75px\r\n      const intervalsTarget = Math.max(Math.round((subchart.bottom - subchart.top) / 75), 3);\r\n      yMaxExactAllGraphs = yMaxExactAllGraphs || 0;\r\n      yMinExactAllGraphs = yMinExactAllGraphs || 0;\r\n      const decimals = maxDecimals;\r\n\r\n      const optIntervalY = GetYOptInterval(yMaxExactAllGraphs, yMinExactAllGraphs, decimals, intervalsTarget);\r\n      yaxis.optIntervalY = optIntervalY;\r\n\r\n      let yMaxAllGraphs: null | number = null;\r\n      let yMinAllGraphs: null | number = null;\r\n      yaxis.graphs.forEach((graph, graphIdx) => {\r\n        graph.yMax = Math.ceil(graph.yMaxExact / optIntervalY) * optIntervalY;\r\n        graph.yMin = Math.floor(graph.yMinExact / optIntervalY) * optIntervalY;\r\n        if (yMaxAllGraphs === null || graph.yMax > yMaxAllGraphs) yMaxAllGraphs = graph.yMax;\r\n        if (yMinAllGraphs === null || graph.yMin < yMinAllGraphs) yMinAllGraphs = graph.yMin;\r\n      });\r\n\r\n      const heightPerPt =\r\n        (subchart.bottom - subchart.top) / ((yMaxAllGraphs || 0) - (yMinAllGraphs || 0)) / Math.pow(10, decimals);\r\n      yaxis.heightPerPt = heightPerPt;\r\n      yaxis.translatedY = -pureYToPix(yMinAllGraphs || 0, subchart.bottom, decimals, 0, heightPerPt) + subchart.bottom;\r\n      let y_bottom = purePixToY(subchart.bottom, subchart.bottom, decimals, yaxis.translatedY, yaxis.heightPerPt);\r\n      let i = pureYToPix(\r\n        Math.ceil(y_bottom / optIntervalY) * optIntervalY,\r\n        subchart.bottom,\r\n        decimals,\r\n        yaxis.translatedY,\r\n        heightPerPt \r\n      );\r\n      const iStart = i; \r\n      while (i >= subchart.top) {\r\n        let yi = purePixToY(i, subchart.bottom, yaxis.decimals, yaxis.translatedY, yaxis.heightPerPt);\r\n        let yvalstr = (Math.round(yi * Math.pow(10, decimals)) / Math.pow(10, decimals)).toString();\r\n        if (i>subchart.top+10 && i <subchart.bottom-10)\r\n        mainYaxis.push({ pixY: i, label: yvalstr });\r\n        i -= (heightPerPt * optIntervalY) / Math.pow(10, -decimals);\r\n      }\r\n      yaxis.drawTicks = mainYaxis;\r\n    });\r\n  });\r\n  return calculatedSubcharts;\r\n};\r\n","import { Vector2 } from \"react-use-gesture/dist/types\";\r\nimport { getDateString } from \"../Time/CChartDateTime\";\r\nimport { getOptimalPeriod, isNewPeriod } from \"../Time/CChartPeriod\";\r\nimport {\r\n  CalculatedChartStateType,\r\n  ChartGraphStateType,\r\n  ChartStateType,\r\n  DrawingTool,\r\n  InteractivePointerType,\r\n  InteractiveXaxisType,\r\n  isChartGraph,\r\n  SubchartStateType,\r\n} from \"../Types/CChartStateTypes\";\r\nimport { ChartPeriodType } from \"../Types/CChartTimeTypes\";\r\nimport { purePixToX, pureXToPix } from \"./CChartStateXaxis\";\r\nimport { purePixToY, pureYToPix, snapPixYToPrices } from \"./CChartStateYaxis\";\r\n\r\nexport const getSubchartIdxByVector = (\r\n  pixXy: [number, number] | undefined,\r\n  subcharts: CalculatedChartStateType[\"subCharts\"]\r\n): number | null => {\r\n  if (!pixXy || !subcharts) return null;\r\n  for (let i = 0; i < subcharts.length; i++) {\r\n    const subchart = subcharts[i];\r\n    if (pixXy[1] >= subchart.top && pixXy[1] < subchart.bottom) return i;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport const getSubchartIdxByBottom = (\r\n  pixXy: [number, number] | undefined,\r\n  subcharts: CalculatedChartStateType[\"subCharts\"]\r\n): number | null => {\r\n  if (!pixXy) return null;\r\n  for (let i = 0; i < subcharts.length; i++) {\r\n    const subchart = subcharts[i];\r\n    if (pixXy[1] >= subchart.bottom - 10 && pixXy[1] < subchart.bottom + 10) return i;\r\n  }\r\n  return null;\r\n};\r\n\r\nconst getToolsByXy = (\r\n  pixXy: [number, number] | undefined,\r\n  subcharts: ChartStateType[\"subCharts\"],\r\n  xaxis: InteractiveXaxisType\r\n): [number, number, number, number][] => {\r\n  if (!pixXy || !subcharts || !xaxis) return [];\r\n  const subchartIdx = getSubchartIdxByVector(pixXy, subcharts);\r\n  if (subchartIdx === null) return [];\r\n\r\n  let toolsIdx: [number, number, number, number][] = [];\r\n  const translatedX = xaxis.totalTranslatedX;\r\n  const widthPerTick = xaxis.scaledWidthPerTick;\r\n  subcharts[subchartIdx].yaxis.forEach((singleYaxis, singleYaxisIdx) => {\r\n    const translatedY = singleYaxis.translatedY;\r\n    const heightPerPt = singleYaxis.heightPerPt;\r\n    singleYaxis.tools.forEach((tool, toolIdx) => {\r\n      tool.xy.forEach((anchorXy, anchorIdx) => {\r\n        if (\r\n          pixXy[0] >= pureXToPix(anchorXy[0], translatedX, widthPerTick) - 10 &&\r\n          pixXy[0] <= pureXToPix(anchorXy[0], translatedX, widthPerTick) + 10 &&\r\n          pixXy[1] >=\r\n            pureYToPix(\r\n              anchorXy[1],\r\n              subcharts[subchartIdx].bottom,\r\n              subcharts[subchartIdx].yaxis[singleYaxisIdx].decimals,\r\n              translatedY,\r\n              heightPerPt\r\n            ) -\r\n              10 &&\r\n          pixXy[1] <=\r\n            pureYToPix(\r\n              anchorXy[1],\r\n              subcharts[subchartIdx].bottom,\r\n              subcharts[subchartIdx].yaxis[singleYaxisIdx].decimals,\r\n              translatedY,\r\n              heightPerPt\r\n            ) +\r\n              10\r\n        ) {\r\n          toolsIdx.push([subchartIdx, singleYaxisIdx, toolIdx, anchorIdx]);\r\n        }\r\n      });\r\n    });\r\n  });\r\n  return toolsIdx;\r\n};\r\n\r\nexport const getDragActionType = (\r\n  dragInitXy: [number, number] | undefined,\r\n  subcharts: SubchartStateType[],\r\n  xaxis: InteractiveXaxisType,\r\n  isEditing: boolean,\r\n  isDrawing: boolean,\r\n  canvasWidth: number,\r\n  canvasHeight: number\r\n):\r\n  | null\r\n  | { type: \"translate\" | \"scale\" }\r\n  | { type: \"resizeSubchart\"; res: number; initBottom: number }\r\n  | { type: \"drawTool\"; init: [number, number] }\r\n  | { type: \"editTool\"; res: [number, number, number, number][]; init: [number, number] } => {\r\n  if (!dragInitXy) return null;\r\n  if (isEditing) return null;\r\n\r\n  if (isDrawing) {\r\n    // const editToolPath = getToolsByXy(dragInitXy, subcharts, xaxis); //only initially -> tool xy is changed by editing but dragInitXy isnt adjusted!\r\n    return {\r\n      type: \"drawTool\",\r\n      // res: editToolPath,\r\n      init: dragInitXy,\r\n    };\r\n  }\r\n\r\n  const editToolPath = getToolsByXy(dragInitXy, subcharts, xaxis); //only initially -> tool xy is changed by editing but dragInitXy isnt adjusted!\r\n  if (editToolPath.length > 0)\r\n    return {\r\n      type: \"editTool\",\r\n      res: editToolPath,\r\n      init: subcharts[editToolPath[0][0]].yaxis[editToolPath[0][1]].tools[editToolPath[0][2]].xy[editToolPath[0][3]],\r\n    };\r\n  const resizeSubchartIdx = getSubchartIdxByBottom(dragInitXy, subcharts); // same as above - only initially\r\n  if (resizeSubchartIdx !== null && resizeSubchartIdx !== subcharts.length-1)\r\n    return { type: \"resizeSubchart\", res: resizeSubchartIdx, initBottom: subcharts[resizeSubchartIdx].bottom };\r\n\r\n  const clickedChart =\r\n    dragInitXy[0] >= 0 && dragInitXy[0] < 0 + canvasWidth && dragInitXy[1] >= 0 && dragInitXy[1] < 0 + canvasHeight;\r\n  if (clickedChart) return { type: \"translate\" };\r\n  const clickedXaxis = dragInitXy[0] >= 0 && dragInitXy[0] < 0 + canvasWidth && dragInitXy[1] >= 0 + canvasHeight;\r\n  if (clickedXaxis) return { type: \"scale\" };\r\n  return null;\r\n};\r\n\r\nexport const editToolPosition = (\r\n  dragActionType: { type: \"editTool\"; res: [number, number, number, number][]; init: [number, number] },\r\n  subcharts: ChartStateType[\"subCharts\"],\r\n  xaxis: InteractiveXaxisType,\r\n  pointer: ChartStateType[\"pointer\"]\r\n): ChartStateType[\"subCharts\"] => {\r\n  if (dragActionType.type !== \"editTool\" || dragActionType.res.length === 0 || !dragActionType.init) return subcharts;\r\n  // if (drag.isDragging) {\r\n  const curPixX = !!pointer.chartPointer.move.pixXSnap ? pointer.chartPointer.move.pixXSnap : pointer.drag.xy[0];\r\n  const curPixY =\r\n    pointer.chartPointer.move.snapDatasets.length > 0 && !!pointer.chartPointer.move.snapDatasets[0].pixYSnap\r\n      ? pointer.chartPointer.move.snapDatasets[0].pixYSnap\r\n      : pointer.drag.xy[1];\r\n  const initX = pureXToPix(\r\n    Math.round(purePixToX(pointer.drag.initial[0], xaxis.totalTranslatedX, xaxis.scaledWidthPerTick)),\r\n    xaxis.totalTranslatedX,\r\n    xaxis.scaledWidthPerTick\r\n  );\r\n  const subIdx = dragActionType.res[0][0];\r\n  const yaxisIdx = dragActionType.res[0][1];\r\n\r\n  let datasets: {\r\n    y: number;\r\n    pixY: number;\r\n  }[] = [];\r\n  let yAdjusted = { y: dragActionType.init[1], pixY: pointer.drag.initial[1] };\r\n  subcharts[subIdx].yaxis[yaxisIdx].graphs.forEach((graph, graphIdx) => {\r\n    const localInitY = snapPixYToPrices(pointer.drag.initial[1], graph.data[initX], subcharts, subIdx, yaxisIdx);\r\n    if (!!localInitY && localInitY.length > 0) datasets.push({ ...localInitY[0], y: parseFloat(localInitY[0].y) });\r\n  });\r\n  if (datasets.length > 0) {\r\n    yAdjusted = { y: datasets[0].y, pixY: datasets[0].pixY };\r\n  }\r\n\r\n  const newPixX =\r\n    pureXToPix(dragActionType.init[0], xaxis.totalTranslatedX, xaxis.scaledWidthPerTick) + curPixX - initX;\r\n  const newPixY =\r\n    pureYToPix(\r\n      dragActionType.init[1],\r\n      subcharts[subIdx].bottom,\r\n      subcharts[subIdx].yaxis[yaxisIdx].decimals,\r\n      subcharts[subIdx].yaxis[yaxisIdx].translatedY,\r\n      subcharts[subIdx].yaxis[yaxisIdx].heightPerPt\r\n    ) +\r\n    curPixY -\r\n    yAdjusted.pixY;\r\n  const newX = purePixToX(newPixX, xaxis.totalTranslatedX, xaxis.scaledWidthPerTick);\r\n  const newY = purePixToY(\r\n    newPixY,\r\n    subcharts[subIdx].bottom,\r\n    subcharts[subIdx].yaxis[yaxisIdx].decimals,\r\n    subcharts[subIdx].yaxis[yaxisIdx].translatedY,\r\n    subcharts[subIdx].yaxis[yaxisIdx].heightPerPt\r\n  );\r\n  // console.log(curPixX, curPixY, newPixX, newPixY, newX, newY);\r\n  // console.log(\r\n  //   \"2nd:\",\r\n  //   pureXToPix(\r\n  //     Math.round(purePixToX(pointer.drag.initial[0], xaxis.totalTranslatedX, xaxis.scaledWidthPerTick)),\r\n  //     xaxis.totalTranslatedX,\r\n  //     xaxis.scaledWidthPerTick\r\n  //   ),\r\n  //   purePixToX(pointer.drag.initial[0], 0, 0),\r\n  //   pointer.drag.initial[0]\r\n  // );\r\n  const [toolsSubIdx, toolsYaxisIdx, toolIdx, anchorIdx] = dragActionType.res[0];\r\n  const editedSubcharts: ChartStateType[\"subCharts\"] = [\r\n    ...subcharts.slice(0, toolsSubIdx),\r\n    {\r\n      ...subcharts[toolsSubIdx],\r\n      yaxis: [\r\n        ...subcharts[toolsSubIdx].yaxis.slice(0, toolsYaxisIdx),\r\n        {\r\n          ...subcharts[toolsSubIdx].yaxis[toolsYaxisIdx],\r\n          tools: [\r\n            ...subcharts[toolsSubIdx].yaxis[toolsYaxisIdx].tools.slice(0, toolIdx),\r\n            {\r\n              ...subcharts[toolsSubIdx].yaxis[toolsYaxisIdx].tools[toolIdx],\r\n              xy: [\r\n                ...subcharts[toolsSubIdx].yaxis[toolsYaxisIdx].tools[toolIdx].xy.slice(0, anchorIdx),\r\n                [newX, newY],\r\n                ...subcharts[toolsSubIdx].yaxis[toolsYaxisIdx].tools[toolIdx].xy.slice(anchorIdx + 1),\r\n              ],\r\n            },\r\n            ...subcharts[toolsSubIdx].yaxis[toolsYaxisIdx].tools.slice(toolIdx + 1),\r\n          ],\r\n        },\r\n        ...subcharts[toolsSubIdx].yaxis.slice(toolsYaxisIdx + 1),\r\n      ],\r\n    },\r\n    ...subcharts.slice(toolsSubIdx + 1),\r\n  ];\r\n  return editedSubcharts;\r\n  // }\r\n  // return subcharts;\r\n};\r\n\r\nexport const resizeSubchart = (\r\n  dragActionType: { type: \"resizeSubchart\"; res: number; initBottom: number },\r\n  subcharts: ChartStateType[\"subCharts\"],\r\n  drag: ChartStateType[\"pointer\"][\"drag\"]\r\n): ChartStateType[\"subCharts\"] => {\r\n  if (dragActionType.type !== \"resizeSubchart\" || dragActionType === null) return subcharts;\r\n  // if (drag.isDragging) {\r\n  const subchartIdx = dragActionType.res;\r\n  const newBottom = Math.min(\r\n    Math.max(dragActionType.initBottom + drag.xy[1] - drag.initial[1], subcharts[subchartIdx].top + 10),\r\n    subcharts[subchartIdx + 1].bottom - 10\r\n  );\r\n  // console.log(newBottom);\r\n  return [\r\n    ...subcharts.slice(0, subchartIdx),\r\n    { ...subcharts[subchartIdx], bottom: newBottom },\r\n    { ...subcharts[subchartIdx + 1], top: newBottom },\r\n    ...subcharts.slice(subchartIdx + 2),\r\n  ];\r\n  // }\r\n  // return subcharts;\r\n};\r\n\r\nexport const addToolAnchor = (\r\n  // dragActionType: { type: \"drawTool\"},\r\n  drawToolType: \"hline\" | \"vline\" | \"trendline\" | undefined,\r\n  // subcharts: ChartStateType[\"subCharts\"],\r\n  draw: ChartStateType[\"draw\"],\r\n  pointer: ChartStateType[\"pointer\"]\r\n): ChartStateType[\"draw\"] => {\r\n  const defaultDrawState: ChartStateType[\"draw\"] = { isDrawing: false, pixXy: [] };\r\n\r\n  const curPixX = !!pointer.chartPointer.move.pixXSnap ? pointer.chartPointer.move.pixXSnap : pointer.drag.xy[0];\r\n  const curPixY =\r\n    pointer.chartPointer.move.snapDatasets.length > 0 && !!pointer.chartPointer.move.snapDatasets[0].pixYSnap\r\n      ? pointer.chartPointer.move.snapDatasets[0].pixYSnap\r\n      : pointer.drag.xy[1];\r\n  const dragpixXy: [number, number] = [curPixX, curPixY];\r\n  if (!drawToolType || !draw || !dragpixXy) return defaultDrawState;\r\n  // add temporary anchor point\r\n  return { ...draw, pixXy: [...draw.pixXy, dragpixXy] };\r\n};\r\n\r\nexport const addTool = (\r\n  subcharts: ChartStateType[\"subCharts\"],\r\n  xaxis: InteractiveXaxisType,\r\n  draw: ChartStateType[\"draw\"],\r\n  drag: ChartStateType[\"pointer\"][\"drag\"]\r\n): ChartStateType[\"subCharts\"] => {\r\n  const subchartIdx = getSubchartIdxByVector(drag.initial, subcharts);\r\n  // console.log(subchartIdx, xaxis, draw, draw.type);\r\n  if (subchartIdx === null || !xaxis || !draw || !drag || !draw.type) return subcharts;\r\n  const pixXyArr = draw.pixXy;\r\n  const xyArr = pixXyArr.map((pixXy, pixXyIdx) => [\r\n    purePixToX(pixXy[0], xaxis.totalTranslatedX, xaxis.scaledWidthPerTick),\r\n    purePixToY(\r\n      pixXy[1],\r\n      subcharts[subchartIdx].bottom,\r\n      subcharts[subchartIdx].yaxis[0].decimals,\r\n      subcharts[subchartIdx].yaxis[0].translatedY,\r\n      subcharts[subchartIdx].yaxis[0].heightPerPt\r\n    ),\r\n  ]);\r\n\r\n  return [\r\n    ...subcharts.slice(0, subchartIdx),\r\n    {\r\n      ...subcharts[subchartIdx],\r\n      yaxis: [\r\n        {\r\n          ...subcharts[subchartIdx].yaxis[0],\r\n          tools: [\r\n            ...subcharts[subchartIdx].yaxis[0].tools,\r\n            { xy: xyArr, type: draw.type, style: { strokeColor: \"blue\", anchorColor: \"#333\" } } as DrawingTool,\r\n          ],\r\n        },\r\n        ...subcharts[subchartIdx].yaxis.slice(1),\r\n      ],\r\n    },\r\n    ...subcharts.slice(subchartIdx + 1),\r\n  ];\r\n};\r\n\r\nexport const calculateXPointer = (\r\n  widthPerTick: number,\r\n  translatedPixX: number,\r\n  xaxis: InteractiveXaxisType,\r\n  mainGraph: ChartGraphStateType,\r\n  onMove?: ChartStateType[\"pointer\"][\"move\"]\r\n) => {\r\n  const defaultXpointer = null;\r\n\r\n  if (!mainGraph || !onMove) return defaultXpointer;\r\n  const xIdx = Math.round(purePixToX(onMove?.xy[0] as any, translatedPixX, widthPerTick));\r\n  if (xIdx < 0 || xIdx > mainGraph.data.length - 1) return { xPointerUnlimited: xIdx };\r\n  const xPointer = Math.abs(Math.round(xIdx));\r\n  let xPointerDateStr = \"\";\r\n  const optPeriodRes = getOptimalPeriod(\r\n    mainGraph.data,\r\n    xaxis.xStart,\r\n    xaxis.xEnd,\r\n    mainGraph.meta,\r\n    xaxis.noDataPeriodPortion,\r\n    Object.assign({}, mainGraph.dateStat)\r\n  );\r\n  // console.log(mainGraph, onMove, optPeriodRes, mainGraph.meta.chartPeriod);\r\n  if (!optPeriodRes || !mainGraph.meta.chartPeriod) return defaultXpointer;\r\n\r\n  const periodToDraw = isNewPeriod(mainGraph.data[xPointer].date, mainGraph.dateStat, mainGraph.meta.chartPeriod, {\r\n    ...(optPeriodRes as ChartPeriodType),\r\n  });\r\n  xPointerDateStr = getDateString(\r\n    mainGraph.data[xPointer].date,\r\n    !!periodToDraw ? periodToDraw : mainGraph.meta.chartPeriod.chartPeriodName\r\n  );\r\n  const pixXPointer = pureXToPix(xPointer, translatedPixX, widthPerTick);\r\n  return { xPointer, xPointerDateStr, pixXPointer, xPointerUnlimited: xIdx };\r\n};\r\n\r\nexport const calculateCurrentPointerDataset = (\r\n  subcharts: CalculatedChartStateType[\"subCharts\"] | null,\r\n  xpointer: number | null,\r\n  xpointerUnlimited: number,\r\n  xPointerDateString: string,\r\n  pixXPointer: number,\r\n  onMove: CalculatedChartStateType[\"pointer\"][\"move\"],\r\n  onDragEnd: CalculatedChartStateType[\"pointer\"][\"dragPointerUp\"]\r\n): InteractivePointerType[\"chartPointer\"] | undefined => {\r\n  const xy = onMove?.xy;\r\n  if (!onMove || !subcharts || !xy) return;\r\n\r\n  const getSubchartIdx = (xy: Vector2) => {\r\n    let subchartIdx: number = -1;\r\n    for (let i = 0; i < subcharts.length; i++) {\r\n      const subchart = subcharts[i];\r\n      if (xy[1] >= subchart.top && xy[1] < subchart.bottom) subchartIdx = i;\r\n    }\r\n    return subchartIdx;\r\n  };\r\n  const subchartIdx = getSubchartIdx(xy);\r\n  if (subchartIdx === -1) return;\r\n  const clickedSubchartIdx = !!onDragEnd && !!onDragEnd.xy ? getSubchartIdx(onDragEnd.xy) : null;\r\n\r\n  const snapDatasets: InteractivePointerType[\"chartPointer\"][\"move\"][\"snapDatasets\"] = [];\r\n\r\n  if (xpointer !== null)\r\n    subcharts[subchartIdx].yaxis.forEach((singleYaxis, singleYaxisIdx) => {\r\n      singleYaxis.graphs.forEach((graph, graphIdx) => {\r\n        let ySnap: string | null = null;\r\n        let pixYSnap: number | null = null;\r\n\r\n        const snapPriceRes = snapPixYToPrices(\r\n          onMove?.xy[1],\r\n          graph.data[xpointer],\r\n          subcharts,\r\n          subchartIdx,\r\n          singleYaxisIdx\r\n        );\r\n        if (!!snapPriceRes && snapPriceRes.length > 0) {\r\n          pixYSnap = snapPriceRes[0].pixY;\r\n          ySnap = snapPriceRes[0].y;\r\n        }\r\n\r\n        snapDatasets.push({\r\n          yaxisIdx: singleYaxisIdx,\r\n          graphIdx: graphIdx,\r\n          data: graph.data[xpointer],\r\n          y: purePixToY(\r\n            onMove?.xy[1],\r\n            subcharts[subchartIdx].bottom,\r\n            singleYaxis.decimals,\r\n            singleYaxis.translatedY,\r\n            singleYaxis.heightPerPt\r\n          ),\r\n          ySnap: ySnap,\r\n          pixYSnap: pixYSnap,\r\n          dateString: xPointerDateString,\r\n        });\r\n      });\r\n    });\r\n\r\n  const calcPointerDataset = {\r\n    move: {\r\n      pixX: onMove?.xy[0],\r\n      pixXSnap: pixXPointer,\r\n      pixY: onMove?.xy[1],\r\n      x: xpointer,\r\n      xUnlimited: xpointerUnlimited,\r\n      subchartIdx, //onMove\r\n      snapDatasets: snapDatasets,\r\n      xDateString: xPointerDateString,\r\n    },\r\n    click: {\r\n      clickedSubchartIdx: clickedSubchartIdx, //onDragEnd\r\n    },\r\n  };\r\n  return calcPointerDataset;\r\n};\r\n","import React, { DOMElement } from \"react\";\r\nimport { useGesture } from \"react-use-gesture\";\r\nimport { chartStateReducer, ReducerActionTaskType, ReducerActionType } from \"./CChartStateReducer\";\r\n\r\nimport { getChartMethods } from \"./CChartStateMethods\";\r\nimport { calculateCurrentXaxis, getInteractiveXaxisState } from \"./CChartStateXaxis\";\r\nimport { calculateCurrentGraphs, purePixToY, pureYToPix } from \"./CChartStateYaxis\";\r\nimport { calculateXPointer, calculateCurrentPointerDataset } from \"./CChartStateInteractions\";\r\nimport { purePixToX, pureXToPix } from \"./CChartStateXaxis\";\r\nimport {\r\n  CalculatedChartStateType,\r\n  ChartPreStateRefType,\r\n  ChartStateType,\r\n  InteractiveXaxisType,\r\n  isChartGraph,\r\n  InteractivePointerType,\r\n  userInteractsSubchartStateType,\r\n  UseGestureStateType,\r\n  isIndicatorGraph,\r\n} from \"../Types/CChartStateTypes\";\r\nimport { addTool, addToolAnchor, editToolPosition, getDragActionType, resizeSubchart } from \"./CChartStateInteractions\";\r\nimport { includesOne } from \"../utils\";\r\nimport { ChartDataSeries } from \"../Types/CChartTypes\";\r\nvar dequal = require(\"fast-deep-equal\");\r\n\r\nexport const defaultState: ChartStateType = {\r\n  xaxis: {\r\n    heightXAxis: 50,\r\n    heightTickMarkLines: 20,\r\n    totalScaleX: 0,\r\n    totalTranslatedX: 0,\r\n    scaledWidthPerTick: 20,\r\n    xStart: 0,\r\n    xEnd: 0,\r\n    pixXStart: 0,\r\n    pixXEnd: 0,\r\n    startNoDataPeriod: 0,\r\n    endNoDataPeriod: 0,\r\n    noDataPeriodPortion: 0,\r\n    optPeriodRes: null,\r\n    widthPerTick: 20,\r\n    xAxisTicks: [],\r\n    style: {\r\n      fillColor: \"#fff\",\r\n      strokeColor: \"#000\",\r\n      fontColor: \"#000\",\r\n      fontSize: 16,\r\n      fontName: \"Arial\",\r\n    },\r\n  },\r\n  grid: { useGridX: true, useGridY: true, style: { strokeColor: \"rgba(51,51,51, 0.33)\", strokeStyle: \"\" } },\r\n  yaxis: {\r\n    widthYAxis: 80,\r\n    widthTickmarkLines: 20,\r\n    style: {\r\n      fillColor: \"#fff\",\r\n      strokeColor: \"#000\",\r\n      fontColor: \"#000\",\r\n      fontSize: 16,\r\n      fontName: \"Arial\",\r\n    },\r\n  },\r\n  backgroundColor: \"#fff\",\r\n  fullscreen: false,\r\n  subCharts: [],\r\n  draw: {\r\n    isDrawing: false,\r\n    pixXy: [],\r\n  },\r\n  containerSize: { top: 0, left: 0, width: 300, height: 300, init: false },\r\n  pointer: {\r\n    isHovering: false,\r\n    move: { isMoving: false, xy: [0, 0] },\r\n    wheel: { isWheeling: false, delta: [0, 0] },\r\n    dragPointerUp: {\r\n      isDragPointerUp: false,\r\n      xy: [0, 0],\r\n      first: false,\r\n      last: false,\r\n      initial: [0, 0],\r\n      movementInitial: [0, 0],\r\n    },\r\n    drag: {\r\n      isDragging: false,\r\n      xy: [0, 0],\r\n      first: false,\r\n      last: false,\r\n      initial: [0, 0],\r\n      movementInitial: [0, 0],\r\n      delta: [0, 0],\r\n    },\r\n    chartPointer: {\r\n      move: {\r\n        x: 0,\r\n        pixX: 0,\r\n        pixY: 0,\r\n        snapDatasets: [],\r\n        subchartIdx: 0,\r\n        xDateString: \"\",\r\n        pixXSnap: 0,\r\n        xUnlimited: 0,\r\n      },\r\n      click: { clickedSubchartIdx: null },\r\n    },\r\n  },\r\n};\r\n\r\nexport const useChartState = (\r\n  HtmlElementRef: React.RefObject<HTMLElement>,\r\n  settings: {\r\n    maxUpdatesPerSec?: number;\r\n    initWidthPerTick?: number;\r\n    width?: number;\r\n    height?: number;\r\n    viewMode?: \"static\" | \"responsive\" | \"fullscreen\";\r\n  }\r\n): [CalculatedChartStateType, React.Dispatch<ReducerActionType<ReducerActionTaskType>>] => {\r\n  const maxUpdatesPerSec = !!settings.maxUpdatesPerSec ? settings.maxUpdatesPerSec : 15;\r\n  const initWidthPerTick = !!settings.initWidthPerTick ? settings.initWidthPerTick : 20;\r\n  const viewModeInternal =\r\n    settings.viewMode === \"static\" && (!settings.height || !settings.width)\r\n      ? \"responsive\"\r\n      : !!settings.viewMode\r\n      ? settings.viewMode\r\n      : \"responsive\";\r\n  // const isResponsive = settings.width === undefined && settings.height === undefined ? true : false;\r\n  const [ChartState, Dispatch] = React.useReducer<\r\n    (prevState: ChartStateType, action: ReducerActionType<ReducerActionTaskType>) => ChartStateType\r\n  >(chartStateReducer, defaultState);\r\n\r\n  const PreStateRef = React.useRef<ChartPreStateRefType>({\r\n    containerSize: defaultState.containerSize,\r\n    pointer: defaultState.pointer,\r\n    xaxis: {\r\n      totalScaleX: 0,\r\n      totalTranslatedX: 0,\r\n      scaledWidthPerTick: 20,\r\n      xStart: 0,\r\n      xEnd: 0,\r\n      pixXStart: 0,\r\n      pixXEnd: 0,\r\n      startNoDataPeriod: 0,\r\n      endNoDataPeriod: 0,\r\n      noDataPeriodPortion: 0,\r\n      optPeriodRes: null,\r\n      widthPerTick: 20,\r\n      xAxisTicks: [],\r\n    },\r\n    tmp: {\r\n      scaleInitWidthPerTick: null,\r\n      scaleInitTranslatedX: 0,\r\n      dragActionType: null,\r\n      amtLastSubcharts: 0,\r\n      lastMainChartData: [],\r\n    },\r\n    lastUpdate: new Date(),\r\n    shallUpdate: [],\r\n    userInteractedChartState: null,\r\n  });\r\n\r\n  const containerHeight = ChartState.containerSize.height - 1;\r\n\r\n  /** Pointer Event Handler defined using react-use-gesture -> pointer state is stored in PreStateRef */\r\n  useGesture(\r\n    {\r\n      onDrag: (dragState: UseGestureStateType[\"drag\"]) => {\r\n        const deltaX =\r\n          !!PreStateRef.current.pointer.drag?.delta && !!PreStateRef.current.shallUpdate.includes(\"drag\")\r\n            ? PreStateRef.current.pointer.drag?.delta[0] + dragState.delta[0]\r\n            : dragState.delta[0];\r\n        const deltaY =\r\n          !!PreStateRef.current.pointer.drag?.delta && !!PreStateRef.current.shallUpdate.includes(\"drag\")\r\n            ? PreStateRef.current.pointer.drag?.delta[1] + dragState.delta[1]\r\n            : dragState.delta[1];\r\n\r\n        const { xy, initial, movement: movementInitial, first, last, active: isDragging } = dragState;\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          pointer: {\r\n            ...PreStateRef.current.pointer,\r\n            drag: { isDragging, xy, initial, movementInitial, last, first, delta: [deltaX, deltaY] },\r\n          },\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"drag\"],\r\n          lastUpdate: PreStateRef.current.lastUpdate,\r\n        };\r\n      },\r\n      onMove: (moveState: UseGestureStateType[\"move\"]) => {\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          pointer: {\r\n            ...PreStateRef.current.pointer,\r\n            move: { isMoving: moveState.active, xy: moveState.xy },\r\n          },\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"pointerMove\"],\r\n        };\r\n      },\r\n      onHover: (hoverState: UseGestureStateType[\"hover\"]) => {\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          pointer: {\r\n            ...PreStateRef.current.pointer,\r\n            isHovering: hoverState.active,\r\n          },\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"pointerMove\"],\r\n        };\r\n      },\r\n      onWheel: (wheelState: UseGestureStateType[\"wheel\"]) => {\r\n        const deltaX =\r\n          !!PreStateRef.current.pointer.wheel?.delta && !!PreStateRef.current.shallUpdate.includes(\"wheel\")\r\n            ? PreStateRef.current.pointer.wheel?.delta[0] + wheelState.delta[0]\r\n            : wheelState.delta[0];\r\n        const deltaY =\r\n          !!PreStateRef.current.pointer.wheel?.delta && !!PreStateRef.current.shallUpdate.includes(\"wheel\")\r\n            ? PreStateRef.current.pointer.wheel?.delta[1] + wheelState.delta[1]\r\n            : wheelState.delta[1];\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          pointer: {\r\n            ...PreStateRef.current.pointer,\r\n            wheel: { delta: [deltaX, deltaY], isWheeling: wheelState.active },\r\n          },\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"wheel\"],\r\n        };\r\n      },\r\n      onDragEnd: (dragState: UseGestureStateType[\"dragEnd\"]) => {\r\n        const { xy, initial, first, last, movement: movementInitial } = dragState;\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          pointer: {\r\n            ...PreStateRef.current.pointer,\r\n            dragPointerUp: { isDragPointerUp: true, xy, initial, movementInitial, last, first },\r\n          },\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"dragEnd\"],\r\n        };\r\n      },\r\n    },\r\n    {\r\n      domTarget: HtmlElementRef,\r\n      transform: ([x, y]) => [x - ChartState.containerSize.top, y - ChartState.containerSize.left],\r\n      // eventOptions: { capture: true,  },\r\n      drag: { useTouch: true, experimental_preventWindowScrollY: true },\r\n      move: {},\r\n    }\r\n  );\r\n\r\n  /** window resize event handler  */\r\n  React.useEffect(() => {\r\n    // console.log(\"HI!\");\r\n    if (!HtmlElementRef || !HtmlElementRef.current) return;\r\n    // console.log(\"noch da!\");\r\n    if (ChartState.fullscreen || viewModeInternal === \"fullscreen\") {\r\n      // console.log(\"immrt noch!\");\r\n      HtmlElementRef.current.style.position = \"fixed\";\r\n      HtmlElementRef.current.style.width = \"100%\";\r\n      HtmlElementRef.current.style.height = \"100%\";\r\n      HtmlElementRef.current.style.top = \"0px\";\r\n      const { clientWidth: width, clientHeight: height } = HtmlElementRef.current;\r\n      PreStateRef.current = {\r\n        ...PreStateRef.current,\r\n        shallUpdate: [...PreStateRef.current.shallUpdate, \"containerResize\"],\r\n        containerSize: { top: 0, left: 0, width, height, init: true },\r\n      };\r\n      // return;\r\n    } else {\r\n      const { top, left } = HtmlElementRef.current.getBoundingClientRect();\r\n      const { clientWidth: width, clientHeight: height } = HtmlElementRef.current;\r\n      HtmlElementRef.current.style.position = \"relative\";\r\n      HtmlElementRef.current.style.width =\r\n        !!settings.width && viewModeInternal === \"static\" ? settings.width + \"px\" : \"100%\";\r\n      HtmlElementRef.current.style.height =\r\n        !!settings.height && viewModeInternal === \"static\" ? settings.height + \"px\" : \"100%\";\r\n      HtmlElementRef.current.style.top = \"0px\";\r\n      PreStateRef.current = {\r\n        ...PreStateRef.current,\r\n        shallUpdate: [...PreStateRef.current.shallUpdate, \"containerResize\"],\r\n        containerSize: { top, left, width, height, init: true },\r\n      };\r\n    }\r\n    // listen only when container shall be responsive -> neither width or height are set by CChart\r\n    if (!!settings.height && !!settings.width && viewModeInternal === \"static\") return;\r\n    const handleWindowResize = (e: Event) => {\r\n      if (!HtmlElementRef || !HtmlElementRef.current) return;\r\n      if (ChartState.fullscreen || viewModeInternal === \"fullscreen\") {\r\n        const { clientWidth: width, clientHeight: height } = HtmlElementRef.current;\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"containerResize\"],\r\n          containerSize: { top: 0, left: 0, width, height, init: true },\r\n        };\r\n        // return;\r\n      } else {\r\n        const { top, left } = HtmlElementRef.current.getBoundingClientRect();\r\n        const { clientWidth: width, clientHeight: height } = HtmlElementRef.current;\r\n        // HtmlElementRef.current.style.position = \"relative\";\r\n        // HtmlElementRef.current.style.width = width + \"px\";\r\n        // HtmlElementRef.current.style.height = height + \"px\";\r\n        // HtmlElementRef.current.style.top = \"0px\";\r\n        PreStateRef.current = {\r\n          ...PreStateRef.current,\r\n          shallUpdate: [...PreStateRef.current.shallUpdate, \"containerResize\"],\r\n          containerSize: { top, left, width, height, init: true },\r\n        };\r\n      }\r\n    };\r\n    // console.log(\"updated! onResize E handler\");\r\n    if (!!HtmlElementRef.current.parentElement)\r\n      HtmlElementRef.current.parentElement.addEventListener(\"resize\", () => {\r\n        \"HI!!!!!\";\r\n      });\r\n    window.addEventListener(\"resize\", handleWindowResize);\r\n    window.addEventListener(\"orientationchange\", handleWindowResize);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"resize\", handleWindowResize);\r\n      window.removeEventListener(\"orientationchange\", handleWindowResize);\r\n    };\r\n  }, [\r\n    HtmlElementRef,\r\n    settings.width,\r\n    settings.height,\r\n    ChartState.fullscreen,\r\n    viewModeInternal,\r\n    HtmlElementRef?.current?.clientWidth,\r\n    HtmlElementRef?.current?.clientHeight,\r\n  ]);\r\n\r\n  const userInteractedSubcharts: userInteractsSubchartStateType = ChartState.subCharts.map((subchart) => ({\r\n    // top: subchart.top,\r\n    // bottom: subchart.bottom,\r\n    yaxis: subchart.yaxis.map((singleYaxis) => ({\r\n      decimals: singleYaxis.decimals,\r\n      graphs: singleYaxis.graphs.map((graph) => {\r\n        const addIndicatorDeps = isIndicatorGraph(graph) ? { ...graph.indicator } : {};\r\n\r\n        return {\r\n          // data: graph.data,\r\n          decimals: graph.decimals,\r\n          name: graph.name,\r\n          style: graph.style,\r\n          type: graph.type,\r\n          ...addIndicatorDeps,\r\n        };\r\n      }),\r\n      tools: singleYaxis.tools.map((tool) => ({ type: tool.type, params: tool.params, style: tool.style })),\r\n    })),\r\n  }));\r\n  const userInteractedXaxis = {\r\n    heightXAxis: ChartState.xaxis.heightXAxis,\r\n    heightTickMarkLines: ChartState.xaxis.heightTickMarkLines,\r\n    style: ChartState.xaxis.style,\r\n  };\r\n  const userInteractedChartState = {\r\n    xaxis: userInteractedXaxis,\r\n    subcharts: userInteractedSubcharts,\r\n  };\r\n\r\n  if (!dequal(PreStateRef.current.userInteractedChartState, userInteractedChartState)) {\r\n    PreStateRef.current.userInteractedChartState = userInteractedChartState;\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    const onTimer = () => {\r\n      const PreState = PreStateRef.current;\r\n      const DragEndState = PreState.pointer.dragPointerUp;\r\n      const DragState = PreState.pointer.drag;\r\n      if (PreState.shallUpdate.length > 0) {\r\n        const widthYaxis = ChartState.yaxis.widthYAxis;\r\n        const widthChart = PreState.containerSize.width - 1;\r\n        const heightChart = PreState.containerSize.height - 1;\r\n        const heightXaxis = ChartState.xaxis.heightXAxis;\r\n        let calcSubcharts = ChartState.subCharts;\r\n        let calcXaxis: InteractiveXaxisType = PreState.xaxis;\r\n        let currentPointer: InteractivePointerType[\"chartPointer\"] | undefined;\r\n        let calcDraw = ChartState.draw;\r\n        let dragActionType;\r\n        if (!PreState.shallUpdate.includes(\"dragEnd\")) PreState.pointer.dragPointerUp.isDragPointerUp = false;\r\n        if (includesOne(PreState.shallUpdate, \"containerResize\") && ChartState.subCharts.length > 0) {\r\n          const dHeight =\r\n            PreState.containerSize.height -\r\n            1 -\r\n            ChartState.xaxis.heightXAxis -\r\n            ChartState.subCharts[ChartState.subCharts.length - 1].bottom;\r\n          const minMainHeight = 250;\r\n          const dHproportionalTmp = Math.floor(dHeight / ChartState.subCharts.length);\r\n          const newMainSizeTmp = ChartState.subCharts[0].bottom - ChartState.subCharts[0].top + dHproportionalTmp;\r\n          const restMainLimit = newMainSizeTmp < minMainHeight ? minMainHeight - newMainSizeTmp : 0;\r\n          const dHeightMain = dHproportionalTmp + restMainLimit;\r\n          const dHeightSingleSubchart =\r\n            ChartState.subCharts.length > 1\r\n              ? Math.floor((dHeight - dHeightMain) / (ChartState.subCharts.length - 1))\r\n              : 0;\r\n          const rest =\r\n            ChartState.subCharts.length > 1 ? (dHeight - dHeightMain) % (ChartState.subCharts.length - 1) : 0;\r\n          let currentRest = rest;\r\n          let lastBottom: number = 0;\r\n          let correctRest = 0;\r\n          calcSubcharts = calcSubcharts.map((subchart, subchartIdx) => {\r\n            if (subchartIdx === 0) {\r\n              lastBottom = subchart.bottom + 1 * dHeightMain;\r\n              return { ...subchart, bottom: subchart.bottom + 1 * dHeightMain };\r\n            } else {\r\n              const tempRest =\r\n                Math.sign(currentRest) > 0 && currentRest > 0 && currentRest !== 0\r\n                  ? -1\r\n                  : Math.sign(currentRest) < 0 && currentRest < 0 && currentRest !== 0\r\n                  ? +1\r\n                  : 0;\r\n              currentRest += tempRest;\r\n              correctRest += tempRest;\r\n              const newTop = lastBottom;\r\n              // why math.abs -> rest of Math.floor(x/n)\r\n              lastBottom = subchart.bottom + subchartIdx * dHeightSingleSubchart + dHeightMain + Math.abs(correctRest);\r\n\r\n              return {\r\n                ...subchart,\r\n                top: newTop,\r\n                bottom: subchart.bottom + subchartIdx * dHeightSingleSubchart + dHeightMain + Math.abs(correctRest),\r\n              };\r\n            }\r\n          });\r\n\r\n          // console.log(dHeight, dHeightMain, dHeightSingleSubchart, rest, PreState.containerSize.height);\r\n          PreStateRef.current.userInteractedChartState = null;\r\n        }\r\n        if (\r\n          includesOne(PreState.shallUpdate, \"drag\", \"wheel\", \"containerResize\", \"deps\") ||\r\n          !!PreState.tmp.dragActionType\r\n        ) {\r\n          // drag actions\r\n\r\n          const dragInit = DragState?.initial;\r\n          // if (!PreState.shallUpdate.includes(\"drag\")) {\r\n          dragActionType = getDragActionType(\r\n            dragInit,\r\n            calcSubcharts,\r\n            calcXaxis,\r\n            !!PreState.tmp.dragActionType,\r\n            ChartState.draw.isDrawing,\r\n            widthChart - widthYaxis,\r\n            heightChart - heightXaxis\r\n          );\r\n          if (\r\n            !PreState.tmp.dragActionType &&\r\n            !!dragActionType &&\r\n            [\"resizeSubchart\"].includes(dragActionType.type) // \"editTool\", \"drawTool\"\r\n          ) {\r\n            PreState.tmp.dragActionType = dragActionType;\r\n          }\r\n          if (!!PreState.tmp.dragActionType) {\r\n            if (!!PreState.pointer.drag.isDragging) {\r\n              if (PreState.tmp.dragActionType?.type === \"resizeSubchart\") {\r\n                calcSubcharts = resizeSubchart(PreState.tmp.dragActionType, calcSubcharts, PreState.pointer.drag);\r\n              }\r\n            }\r\n\r\n            if (!PreState.pointer.drag.isDragging) {\r\n              if (![\"drawTool\", \"editTool\"].includes(PreState.tmp.dragActionType?.type)) {\r\n                if (PreState.tmp.dragActionType?.type === \"resizeSubchart\") {\r\n                  // resize with ChartState.subcharts[i].bottom (when resizing began!) for the last time\r\n\r\n                  calcSubcharts = resizeSubchart(PreState.tmp.dragActionType, calcSubcharts, PreState.pointer.drag);\r\n                  // and trigger update of ChartState.subCharts for the effect hook\r\n                  PreState.userInteractedChartState = null;\r\n                  PreState.tmp.dragActionType = null;\r\n                }\r\n              }\r\n            }\r\n            // }\r\n          }\r\n\r\n          if (\r\n            (!!dragActionType && [\"scale\", \"translate\"].includes(dragActionType.type)) ||\r\n            includesOne(PreState.shallUpdate, \"containerResize\", \"deps\")\r\n          ) {\r\n\r\n            // if (PreState.shallUpdate.includes(\"deps\"))\r\n            //   console.log(\r\n            //     \"MAINDATA: \",\r\n            //     PreState.tmp.lastMainChartData ===\r\n            //       (ChartState.subCharts?.[0]?.yaxis?.[0]?.graphs?.[0]?.data as ChartDataSeries) ?? null\r\n            //   );\r\n\r\n            // if new chart is added or replacing current chart or chart is reset/cleared -> initial translatedX to end of chart is calculated in reducer \r\n            if (\r\n              ((PreState.tmp.amtLastSubcharts !== ChartState.subCharts.length && ChartState.subCharts.length === 1) ||\r\n                PreState.tmp.lastMainChartData !==\r\n                  (ChartState.subCharts?.[0]?.yaxis?.[0]?.graphs?.[0]?.data as ChartDataSeries)) ??\r\n              null\r\n            ) {\r\n              // console.log(\"DIFFERENZ: \", PreState.tmp.amtLastSubcharts, ChartState.subCharts.length);\r\n\r\n              PreState.xaxis.totalTranslatedX = ChartState.xaxis.totalTranslatedX;\r\n            }\r\n            const { scaleInitTranslatedX, scaleInitWidthPerTick } = PreState.tmp;\r\n            let mainGraph = !!calcSubcharts?.[0]?.yaxis?.[0]?.graphs?.[0]\r\n              ? calcSubcharts?.[0].yaxis[0].graphs[0]\r\n              : null;\r\n            if (!!mainGraph) if (!isChartGraph(mainGraph)) mainGraph = null;\r\n\r\n            PreState.xaxis = getInteractiveXaxisState(\r\n              { ...PreState.xaxis, scaleInitTranslatedX, scaleInitWidthPerTick }, // + temp vars in ref! therefore ref not state\r\n              PreState.pointer.drag,\r\n              PreState.pointer.wheel,\r\n              PreState.pointer.move,\r\n              initWidthPerTick,\r\n              PreState.shallUpdate.includes(\"drag\"),\r\n              dragActionType?.type === \"translate\",\r\n              dragActionType?.type === \"scale\",\r\n              widthChart, //- widthYaxis\r\n              mainGraph?.data.length || 0\r\n            );\r\n            // const { scaleInitTranslatedX, scaleInitWidthPerTick, ...xaxisInteractiveState } = PreState.xaxis;\r\n\r\n            calcXaxis = {\r\n              ...calcXaxis,\r\n              ...PreState.xaxis,\r\n              ...calculateCurrentXaxis(\r\n                PreState.xaxis.scaledWidthPerTick,\r\n                PreState.xaxis.totalTranslatedX,\r\n                PreState.containerSize.width,\r\n                ChartState.yaxis.widthYAxis,\r\n                mainGraph\r\n              ),\r\n            };\r\n          }\r\n          if (\r\n            (!!dragActionType && [\"scale\", \"translate\", \"resizeSubchart\"].includes(dragActionType.type)) ||\r\n            !!PreState.tmp.dragActionType ||\r\n            includesOne(PreState.shallUpdate, \"containerResize\", \"deps\")\r\n          ) {\r\n            // graphs (and yaxis) - depends on drag actions (translate, scale, resizeSubchart)\r\n            const calcCurrentSubchart = calculateCurrentGraphs(\r\n              calcSubcharts,\r\n              PreState.xaxis.scaledWidthPerTick,\r\n              calcXaxis.xStart,\r\n              calcXaxis.xEnd,\r\n              calcXaxis.pixXStart,\r\n              calcXaxis.pixXEnd\r\n            );\r\n            if (!!calcCurrentSubchart) calcSubcharts = calcCurrentSubchart;\r\n          }\r\n        }\r\n        if (PreState.shallUpdate.includes(\"pointerMove\")) {\r\n          const xpointerRes = calculateXPointer(\r\n            calcXaxis.scaledWidthPerTick,\r\n            calcXaxis.totalTranslatedX,\r\n            calcXaxis,\r\n            calcSubcharts?.[0]?.yaxis?.[0]?.graphs?.[0] as any,\r\n            PreState.pointer.move\r\n          );\r\n\r\n          // if (!!xpointerRes) {\r\n          // console.log(xpointerRes);\r\n          const xpointer = xpointerRes?.xPointer !== undefined ? xpointerRes?.xPointer : null;\r\n          const xPointerUnl = xpointerRes?.xPointerUnlimited !== undefined ? xpointerRes.xPointerUnlimited : -1;\r\n          const xPointerDateString = xpointerRes?.xPointerDateStr || \"\";\r\n          const pixXPointer = xpointerRes?.pixXPointer || 0;\r\n          currentPointer = calculateCurrentPointerDataset(\r\n            calcSubcharts,\r\n            xpointer,\r\n            xPointerUnl,\r\n            xPointerDateString,\r\n            pixXPointer,\r\n            PreState.pointer.move,\r\n            PreState.pointer.dragPointerUp\r\n          );\r\n          // }\r\n          // ensure xUnlimited is added to chartstate\r\n\r\n          // currentPointer = {move: {xUnlimited: Math.round(\r\n          //   purePixToX(\r\n          //     PreState.pointer.move?.xy[0] as any,\r\n          //     PreState.xaxis.totalTranslatedX,\r\n          //     PreState.xaxis.widthPerTick\r\n          //   )\r\n          // );}}\r\n        }\r\n        if (\r\n          PreState.shallUpdate.includes(\"drag\") ||\r\n          (!!PreState.tmp?.dragActionType && [\"editTool\", \"drawTool\"].includes(PreState.tmp.dragActionType.type))\r\n        ) {\r\n          if (\r\n            !PreState.tmp.dragActionType &&\r\n            !!dragActionType &&\r\n            [\"editTool\", \"drawTool\"].includes(dragActionType.type)\r\n          ) {\r\n            PreState.tmp.dragActionType = dragActionType;\r\n          }\r\n          if (!!PreState.tmp.dragActionType) {\r\n            if (!!PreState.pointer.drag.isDragging) {\r\n              if (PreState.tmp.dragActionType?.type === \"editTool\") {\r\n                calcSubcharts = editToolPosition(\r\n                  PreState.tmp.dragActionType,\r\n                  calcSubcharts,\r\n                  calcXaxis,\r\n                  PreState.pointer\r\n                );\r\n              }\r\n            }\r\n            if (!PreState.pointer.drag.isDragging) {\r\n              if (PreState.tmp.dragActionType?.type === \"editTool\") {\r\n                //   console.log(PreState.tmp.dragActionType, PreState.pointer.drag);\r\n                calcSubcharts = editToolPosition(\r\n                  PreState.tmp.dragActionType,\r\n                  calcSubcharts,\r\n                  calcXaxis,\r\n                  PreState.pointer\r\n                );\r\n                // and trigger update of ChartState.subCharts for the effect hook\r\n                PreState.userInteractedChartState = null;\r\n                PreState.tmp.dragActionType = null;\r\n              } else if (DragEndState.isDragPointerUp && PreState.tmp.dragActionType?.type === \"drawTool\") {\r\n                const nPoints = !ChartState.draw.type\r\n                  ? 0\r\n                  : [\"hline\", \"vline\"].includes(ChartState.draw.type)\r\n                  ? 1\r\n                  : [\"trendline\"].includes(ChartState.draw.type)\r\n                  ? 2\r\n                  : 0;\r\n                // console.log(nPoints, ChartState.draw, ChartState.draw.isDrawing);\r\n                if (!nPoints) calcDraw = { isDrawing: false, pixXy: [] };\r\n                else {\r\n                  if (calcDraw.pixXy.length < nPoints - 1) {\r\n                    calcDraw = addToolAnchor(calcDraw.type, calcDraw, PreState.pointer);\r\n                    // console.log(\"drawing 0\", ChartState.draw, DragEndState);\r\n                  } else {\r\n                    calcDraw = addToolAnchor(calcDraw.type, calcDraw, PreState.pointer);\r\n                    calcSubcharts = addTool(calcSubcharts, calcXaxis, calcDraw, PreState.pointer.drag);\r\n                    calcDraw = { isDrawing: false, pixXy: [] };\r\n                    PreState.tmp.dragActionType = null;\r\n                    // console.log(\"drawing 1\", DragEndState);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        const { lastUpdate, shallUpdate, userInteractedChartState, xaxis, tmp, ...state } = PreState;\r\n        PreState.xaxis = { ...PreState.xaxis, ...calcXaxis };\r\n        if (!!currentPointer) PreState.pointer.chartPointer = currentPointer;\r\n        // PreState.subcharts = calcSubcharts;\r\n\r\n        Dispatch({\r\n          task: \"updateInteractionState\",\r\n          params: {\r\n            newState: {\r\n              ...state,\r\n              xaxis: calcXaxis as any,\r\n              subCharts: calcSubcharts,\r\n              draw: calcDraw,\r\n            },\r\n            // resizeSubchartObj,\r\n          },\r\n        } as ReducerActionType<\"updateInteractionState\">);\r\n\r\n        PreStateRef.current = {\r\n          ...PreState,\r\n          lastUpdate: new Date(),\r\n          shallUpdate: [],\r\n        };\r\n      }\r\n      PreState.tmp.amtLastSubcharts = ChartState.subCharts.length;\r\n      PreState.tmp.lastMainChartData =\r\n        (ChartState.subCharts?.[0]?.yaxis?.[0]?.graphs?.[0]?.data as ChartDataSeries) ?? null;\r\n    };\r\n    // onTimer(); // exec immmediately\r\n    console.log(\"updated Timer\");\r\n    PreStateRef.current.shallUpdate.push(\"deps\");\r\n    onTimer();\r\n    const handleTimer = window.setInterval(onTimer, 1000 / maxUpdatesPerSec);\r\n    return () => {\r\n      window.clearInterval(handleTimer);\r\n    };\r\n  }, [\r\n    maxUpdatesPerSec,\r\n    initWidthPerTick,\r\n    ChartState.draw.isDrawing,\r\n    ChartState.draw.pixXy,\r\n    ChartState.yaxis.widthYAxis,\r\n    ChartState.xaxis.heightXAxis,\r\n    PreStateRef.current.userInteractedChartState,\r\n    ChartState.fullscreen,\r\n  ]);\r\n\r\n  return [\r\n    {\r\n      ...ChartState,\r\n      methods: getChartMethods(ChartState, containerHeight, Dispatch),\r\n    },\r\n    Dispatch,\r\n  ];\r\n};\r\n","import React from \"react\";\r\nimport { Circle, Line } from \"react-konva\";\r\nimport { DrawingTool } from \"../Types/CChartStateTypes\";\r\n\r\nexport type CTrendlineProps = {\r\n  style?: DrawingTool[\"style\"];\r\n  pixXy: [[number, number], [number, number]];\r\n  mode: \"line\" | \"trendline\" | \"infiniteLine\";\r\n  subchartTop: number;\r\n  subchartBottom: number;\r\n};\r\n\r\nexport const CTrendline = (props: CTrendlineProps) => {\r\n  const { style, pixXy, mode, subchartTop, subchartBottom } = props;\r\n  if (pixXy.length !== 2) return null;\r\n  const strokeColor = !!style?.strokeColor ? style.strokeColor : \"red\";\r\n  const anchorColor = !!style?.anchorColor ? style.anchorColor : \"#333\";\r\n  const modeInt = [\"line\", \"trendline\", \"infiniteLine\"].includes(mode) ? mode : \"trendline\";\r\n  const pixXyAdjusted: [number, number][] = [];\r\n\r\n  if (pixXy[0][0] > pixXy[1][0]) {\r\n    pixXyAdjusted.push([...pixXy[1]], [...pixXy[0]]);\r\n  } else pixXyAdjusted.push([...pixXy[0]], [...pixXy[1]]);\r\n\r\n  if (modeInt === \"trendline\" || mode === \"infiniteLine\") {\r\n    const dx = pixXyAdjusted[1][0] - pixXyAdjusted[0][0];\r\n    const dy = pixXyAdjusted[1][1] - pixXyAdjusted[0][1];\r\n    const slope = dy / dx;\r\n    const pixYTarget = dy < 0 ? subchartTop : subchartBottom;\r\n    const b = pixXyAdjusted[0][1] - slope * pixXyAdjusted[0][0];\r\n    const pixXTarget = (pixYTarget - b) / slope;\r\n    pixXyAdjusted[1][0] = pixXTarget;\r\n    pixXyAdjusted[1][1] = pixYTarget;\r\n    if (mode === \"infiniteLine\") {\r\n      const pixYSrc = dy < 0 ? subchartBottom : subchartTop;\r\n      const pixXSrc = (pixYSrc - b) / slope;\r\n      pixXyAdjusted[0][0] = pixXSrc;\r\n      pixXyAdjusted[0][1] = pixYSrc;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Line\r\n        x={0}\r\n        y={0}\r\n        points={[pixXyAdjusted[0][0], pixXyAdjusted[0][1], pixXyAdjusted[1][0], pixXyAdjusted[1][1]]}\r\n        stroke={strokeColor}\r\n        strokeWidth={1}\r\n      />\r\n      <Circle x={pixXy[0][0]} y={pixXy[0][1]} radius={5} fill={anchorColor} />\r\n      <Circle x={pixXy[1][0]} y={pixXy[1][1]} radius={5} fill={anchorColor} />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Circle, Line } from \"react-konva\";\r\nimport { DrawingTool } from \"../Types/CChartStateTypes\";\r\n\r\nexport type CVlineProps = {\r\n  style?: DrawingTool[\"style\"];\r\n  pixXy: [[number, number]];\r\n  mode: \"extendUp\" | \"extendDown\" | \"extendUpDown\" | \"*extendToSecondPoint\";\r\n  subchartTop: number;\r\n  subchartBottom: number;\r\n};\r\n\r\nexport const CVline = (props: CVlineProps) => {\r\n  const { style, pixXy, subchartTop, subchartBottom } = props;\r\n  if (pixXy.length !== 1) return null;\r\n  const strokeColor = !!style?.strokeColor ? style.strokeColor : \"red\";\r\n  const anchorColor = !!style?.anchorColor ? style.anchorColor : \"#333\";\r\n  //  TODO\r\n  // const modeInt = [\"extendUp\", \"extendDown\", \"extendUpDown\", \"*extendToSecondPoint\"].includes(mode)\r\n  //   ? mode\r\n  //   : \"extendUpDown\";\r\n  const pixXyAdjusted: [number, number][] = [];\r\n  pixXyAdjusted.push([pixXy[0][0], subchartTop], [pixXy[0][0], subchartBottom]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Line\r\n        x={0}\r\n        y={0}\r\n        points={[pixXyAdjusted[0][0], pixXyAdjusted[0][1], pixXyAdjusted[1][0], pixXyAdjusted[1][1]]}\r\n        stroke={strokeColor}\r\n        strokeWidth={1}\r\n      />\r\n      <Circle x={pixXy[0][0]} y={pixXy[0][1]} radius={5} fill={anchorColor} />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Line, Circle } from \"react-konva\";\r\nimport { DrawingTool } from \"../Types/CChartStateTypes\";\r\n\r\nexport type CHlineProps = {\r\n  style?: DrawingTool[\"style\"];\r\n  pixXy: [[number, number]];\r\n  mode: \"extendRight\" | \"extendLeft\" | \"extendLeftRight\" | \"*extendToSecondPoint\";\r\n  pixXstart: number;\r\n  pixXend: number;\r\n};\r\n\r\nexport const CHline = (props: CHlineProps) => {\r\n  const { style, pixXy, pixXstart, pixXend } = props;\r\n  if (pixXy.length !== 1) return null;\r\n  const strokeColor = !!style?.strokeColor ? style.strokeColor : \"red\";\r\n  const anchorColor = !!style?.anchorColor ? style.anchorColor : \"#333\";\r\n  // TODO\r\n  // const modeInt = [\"extendRight\", \"extendLeft\", \"extendLeftRight\", \"*extendToSecondPoint\"].includes(mode)\r\n  //   ? mode\r\n  //   : \"extendLeftRight\";\r\n  const pixXyAdjusted: [number, number][] = [];\r\n  pixXyAdjusted.push([pixXstart, pixXy[0][1]], [pixXend, pixXy[0][1]]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Line\r\n        x={0}\r\n        y={0}\r\n        points={[pixXyAdjusted[0][0], pixXyAdjusted[0][1], pixXyAdjusted[1][0], pixXyAdjusted[1][1]]}\r\n        stroke={strokeColor}\r\n        strokeWidth={1}\r\n      />\r\n      <Circle x={pixXy[0][0]} y={pixXy[0][1]} radius={5} fill={anchorColor} />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { createMuiTheme, responsiveFontSizes } from \"@material-ui/core/styles\";\r\nexport const muiTheme = (() => {\r\n  let localTheme = createMuiTheme({\r\n    palette: {\r\n      primary: {\r\n        main: \"#009688\",\r\n      },\r\n      secondary: {\r\n        main: \"#f50057\",\r\n      },\r\n      type: \"light\",\r\n    },\r\n  });\r\n\r\n  localTheme.typography.h1 = {\r\n    fontFamily: \"'Open Sans', sans-serif, Arial\",\r\n    fontWeight: 600,\r\n    fontSize: \"3rem\",\r\n    lineHeight: 1.167,\r\n  };\r\n  localTheme.typography.h2 = {\r\n    fontFamily: \"'Open Sans', sans-serif, Arial\",\r\n    fontWeight: 600,\r\n    fontSize: \"2.5rem\",\r\n    lineHeight: 1.167,\r\n  };\r\n  localTheme.typography.h3 = {\r\n    fontFamily: \"'Open Sans', sans-serif, Arial\",\r\n    fontWeight: 600,\r\n    fontSize: \"2rem\",\r\n    lineHeight: 1.167,\r\n  };\r\n  localTheme.typography.h4 = {\r\n    fontFamily: \"'Open Sans', sans-serif, Arial\",\r\n    fontWeight: 600,\r\n    fontSize: \"1.88rem\",\r\n    lineHeight: 1.167,\r\n  };\r\n  localTheme.typography.h5 = {\r\n    fontFamily: \"'Open Sans', sans-serif, Arial\",\r\n    fontWeight: 600,\r\n    fontSize: \"1.44rem\",\r\n    lineHeight: 1.167,\r\n  };\r\n  localTheme.typography.h6 = {\r\n    fontFamily: \"'Open Sans', sans-serif, Arial\",\r\n    fontWeight: 600,\r\n    fontSize: \"1.25rem\",\r\n    lineHeight: 1.167,\r\n  };\r\n  localTheme.typography.fontFamily = \"'Quattrocento Sans', sans-serif\";\r\n  localTheme = responsiveFontSizes(localTheme);\r\n  return localTheme;\r\n})();\r\n","import {\r\n  Button,\r\n  Grid,\r\n  ListItem,\r\n  List,\r\n  Paper,\r\n  Typography,\r\n  useMediaQuery,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  useTheme,\r\n} from \"@material-ui/core\";\r\nimport { mdiChartLine, mdiChartBellCurve, mdiPencilRuler, mdiTune, mdiStarShooting } from \"@mdi/js\";\r\nimport Icon from \"@mdi/react\";\r\nimport React from \"react\";\r\nimport { Stage, Layer, Rect, Line, Shape } from \"react-konva\";\r\nimport { CCandleChart } from \"../Charts/CCandleChart\";\r\nimport { CalculatedChartStateType } from \"../Types/CChartStateTypes\";\r\nimport { CChartMenuOpenType } from \"./ChartMenu\";\r\n\r\nexport const ChartMenuHome = (props: {\r\n  ChartState: CalculatedChartStateType;\r\n  onNavigate: (target: CChartMenuOpenType) => void;\r\n}) => {\r\n  const { ChartState, onNavigate } = props;\r\n\r\n  const isMinSm = useMediaQuery(\"(min-width:600px)\");\r\n  const previewSize = !isMinSm ? 248 : 320;\r\n  const { widthYAxis, widthTickmarkLines } = ChartState.yaxis;\r\n  const { heightXAxis, heightTickMarkLines } = ChartState.xaxis;\r\n  const containerWidth = ChartState.containerSize.width - 1;\r\n  const containerHeight = ChartState.containerSize.height - 1;\r\n  const xAxis = ChartState.xaxis.xAxisTicks;\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {/* <Grid container>\r\n        <Grid item> */}\r\n      <List>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            onNavigate?.(\"chart\");\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiChartLine} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText primary=\"Chart\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n        </ListItem>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            onNavigate?.(\"indicators\");\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiChartBellCurve} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText primary=\"Indicators\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n        </ListItem>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            onNavigate?.(\"tools\");\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiPencilRuler} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText primary=\"Tools\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n        </ListItem>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            onNavigate?.(\"settings\");\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiTune} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText primary=\"Settings\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n        </ListItem>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            onNavigate?.(\"quickys\");\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiStarShooting} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText\r\n            primary=\"Quick Tasks\"\r\n            primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }}\r\n          />\r\n        </ListItem>\r\n      </List>\r\n      {/* </Grid>\r\n      </Grid> */}\r\n    </React.Fragment>\r\n    // <Grid container alignItems=\"center\">\r\n    //   <Grid\r\n    //     container\r\n    //     item\r\n    //     spacing={2}\r\n    //     alignItems=\"center\"\r\n    //     justify=\"center\"\r\n    //     //   style={{justifyContent: \"flex-end\"}}\r\n    //     //   style={{ maxWidth: !isMinSm ? 400 : \"auto\" }}\r\n    //     //   wrap=\"nowrap\"\r\n    //     xs={12}\r\n    //     sm={4}\r\n    //     style={{ paddingBottom: 24 }}\r\n    //   >\r\n    //     <Grid item sm={12} xs={6}>\r\n    //       <div style={{ margin: !isMinSm ? \"0px 0px 0px auto\" : 0, width: 128 }}>\r\n    //         <Button\r\n    //           color=\"secondary\"\r\n    //           variant=\"contained\"\r\n    //           style={{ width: 96, height: 96, textTransform: \"none\", borderRadius: 5 }}\r\n    //         >\r\n    //           <div style={{ position: \"relative\", top: 0 }}>\r\n    //             <div>\r\n    //               <Icon path={mdiChartLine} size=\"75px\" />\r\n    //             </div>\r\n    //             <Typography\r\n    //               style={{ width: \"100%\", marginTop: -12, display: \"block\", color: \"#fff\", fontWeight: 600 }}\r\n    //               // color=\"secondary\"\r\n    //               variant=\"body1\"\r\n    //               component=\"div\"\r\n    //             >\r\n    //               <div style={{ margin: \"0px auto\", width: \"max-content\" }}>Chart</div>\r\n    //             </Typography>\r\n    //           </div>\r\n    //         </Button>\r\n    //       </div>\r\n    //     </Grid>\r\n    //     <Grid item sm={12} xs={6}>\r\n    //       <div style={{ width: \"max-content\" }}>\r\n    //         <Button\r\n    //           color=\"secondary\"\r\n    //           variant=\"contained\"\r\n    //           style={{ width: 96, height: 96, textTransform: \"none\", borderRadius: 5 }}\r\n    //           onClick={() => {\r\n    //             onNavigate?.(\"indicators\");\r\n    //           }}\r\n    //         >\r\n    //           <div style={{ position: \"relative\", top: 0 }}>\r\n    //             <div>\r\n    //               <Icon path={mdiChartBellCurve} size=\"72px\" />\r\n    //             </div>\r\n    //             <Typography\r\n    //               style={{ width: \"100%\", marginTop: -12, display: \"block\", color: \"#fff\", fontWeight: 600 }}\r\n    //               // color=\"secondary\"\r\n    //               variant=\"body1\"\r\n    //               component=\"div\"\r\n    //             >\r\n    //               <div style={{ margin: \"0px auto\", width: \"max-content\" }}>Indicators</div>\r\n    //             </Typography>\r\n    //           </div>\r\n    //         </Button>\r\n    //       </div>\r\n    //     </Grid>\r\n    //     <Grid item sm={12} xs={6}>\r\n    //       <div style={{ margin: !isMinSm ? \"0px 0px 0px auto\" : 0, width: 128 }}>\r\n    //         <Button\r\n    //           color=\"secondary\"\r\n    //           variant=\"contained\"\r\n    //           style={{ width: 96, height: 96, textTransform: \"none\", borderRadius: 5 }}\r\n    //           onClick={() => onNavigate?.(\"tools\")}\r\n    //         >\r\n    //           <div style={{ position: \"relative\", top: 0 }}>\r\n    //             <div>\r\n    //               <Icon path={mdiPencilRuler} size=\"72px\" />\r\n    //             </div>\r\n    //             <Typography\r\n    //               style={{ width: \"100%\", marginTop: -12, display: \"block\", color: \"#fff\", fontWeight: 600 }}\r\n    //               // color=\"secondary\"\r\n    //               variant=\"body1\"\r\n    //               component=\"div\"\r\n    //             >\r\n    //               <div style={{ margin: \"0px auto\", width: \"max-content\" }}>Tools</div>\r\n    //             </Typography>\r\n    //           </div>\r\n    //         </Button>\r\n    //       </div>\r\n    //     </Grid>\r\n    //     <Grid item sm={12} xs={6}>\r\n    //       {/* <div style={{ margin: \"0px auto\", width: \"max-content\" }}> */}\r\n    //       <Button\r\n    //         color=\"secondary\"\r\n    //         variant=\"contained\"\r\n    //         style={{ width: 96, height: 96, textTransform: \"none\", borderRadius: 5 }}\r\n    //         onClick={() => onNavigate?.(\"settings\")}\r\n    //       >\r\n    //         <div style={{ position: \"relative\", top: 0 }}>\r\n    //           <div>\r\n    //             <Icon path={mdiTune} size=\"72px\" />\r\n    //           </div>\r\n    //           <Typography\r\n    //             style={{ width: \"100%\", marginTop: -12, display: \"block\", color: \"#fff\", fontWeight: 600 }}\r\n    //             // color=\"secondary\"\r\n    //             variant=\"body1\"\r\n    //             component=\"div\"\r\n    //           >\r\n    //             <div style={{ margin: \"0px auto\", width: \"max-content\" }}>Settings</div>\r\n    //           </Typography>\r\n    //         </div>\r\n    //       </Button>\r\n    //       {/* </div> */}\r\n    //     </Grid>\r\n    //     <Grid item sm={12} xs={6}>\r\n    //       {/* <div style={{ margin: \"0px auto\", width: \"max-content\" }}> */}\r\n    //       <Button\r\n    //         color=\"secondary\"\r\n    //         variant=\"contained\"\r\n    //         style={{ width: 96, height: 96, textTransform: \"none\", borderRadius: 5 }}\r\n    //         onClick={() => onNavigate?.(\"settings\")}\r\n    //       >\r\n    //         <div style={{ position: \"relative\", top: 0 }}>\r\n    //           <div>\r\n    //             <Icon path={mdiStarShooting} size=\"72px\" />\r\n    //           </div>\r\n    //           <Typography\r\n    //             style={{ width: \"100%\", marginTop: -12, display: \"block\", color: \"#fff\", fontWeight: 600 }}\r\n    //             // color=\"secondary\"\r\n    //             variant=\"body1\"\r\n    //             component=\"div\"\r\n    //           >\r\n    //             <div style={{ margin: \"0px auto\", width: \"max-content\" }}>Shortcuts</div>\r\n    //           </Typography>\r\n    //         </div>\r\n    //       </Button>\r\n    //       {/* </div> */}\r\n    //     </Grid>\r\n    //   </Grid>\r\n    //   {!!null ? (\r\n    //     <Grid item xs={12} sm={6}>\r\n    //       <Paper style={{ width: previewSize, height: previewSize, margin: \"0 auto\", border: \"1px solid #666\" }}>\r\n    //         <Stage //konva container\r\n    //           width={previewSize}\r\n    //           height={previewSize}\r\n    //           listening={false}\r\n\r\n    //           // style={{ boxSizing: \"border-box\" }}\r\n    //         >\r\n    //           {/*  Canvas Layer 3 - chart and example */}\r\n\r\n    //           <Layer\r\n    //             scale={{\r\n    //               x: previewSize / ChartState.containerSize.width,\r\n    //               y: previewSize / ChartState.containerSize.height,\r\n    //             }}\r\n    //           >\r\n    //             {/* <Rect\r\n    //           x={20 + ChartState.pointer.totalTranslatedX}\r\n    //           y={50 + ChartState.pointer.totalTranslatedY}\r\n    //           width={100}\r\n    //           height={100}\r\n    //           fill=\"red\"\r\n    //           shadowBlur={10}\r\n    //         /> */}\r\n    //             {0 in ChartState.subCharts ? <CCandleChart fullState={ChartState} /> : null}\r\n    //           </Layer>\r\n    //           {/*  Canvas Layer 5 (before 0) - axis bg rects + future chartbgcolor? */}\r\n    //           <Layer\r\n    //             scale={{\r\n    //               x: previewSize / ChartState.containerSize.width,\r\n    //               y: previewSize / ChartState.containerSize.height,\r\n    //             }}\r\n    //           >\r\n    //             <Rect\r\n    //               x={0 + 0.5}\r\n    //               y={containerHeight - heightXAxis + 0.5}\r\n    //               width={containerWidth}\r\n    //               height={heightXAxis}\r\n    //               fill={ChartState.xaxis.style.fillColor}\r\n    //               stroke={ChartState.xaxis.style.strokeColor}\r\n    //               strokeWidth={1}\r\n    //             />\r\n    //             {ChartState.subCharts.map((subchart, subchartIdx) => (\r\n    //               <React.Fragment key={subchartIdx}>\r\n    //                 <Rect\r\n    //                   // key={`subchartPrimaryYaxis-${subchartIdx}`}\r\n    //                   x={containerWidth - widthYAxis + 0.5}\r\n    //                   y={subchart.top + 0.5}\r\n    //                   width={widthYAxis}\r\n    //                   height={subchart.bottom - subchart.top}\r\n    //                   // fill={ChartState.xaxis.style.fillColor}\r\n    //                   stroke={ChartState.xaxis.style.strokeColor}\r\n    //                   strokeWidth={1}\r\n    //                 />\r\n    //                 <Rect\r\n    //                   // key={`subchartBorder-${subchartIdx}`}\r\n    //                   x={0 + 0.5}\r\n    //                   y={subchart.top + 0.5}\r\n    //                   width={containerWidth - widthYAxis}\r\n    //                   height={subchart.bottom - subchart.top}\r\n    //                   stroke={ChartState.xaxis.style.strokeColor}\r\n    //                   strokeWidth={1}\r\n    //                 />\r\n    //               </React.Fragment>\r\n    //             ))}\r\n    //           </Layer>\r\n    //           {/*  Canvas Layer 6 before 1 - x axis */}\r\n    //           <Layer\r\n    //             scale={{\r\n    //               x: previewSize / ChartState.containerSize.width,\r\n    //               y: previewSize / ChartState.containerSize.height,\r\n    //             }}\r\n    //           >\r\n    //             {xAxis.map((xaxisTick, xaxisTickIdx) => {\r\n    //               return (\r\n    //                 <React.Fragment key={xaxisTickIdx}>\r\n    //                   <Line\r\n    //                     x={xaxisTick.x}\r\n    //                     y={ChartState.containerSize.height - 1 - heightXAxis + 0.5}\r\n    //                     points={[0, 0, 0, heightTickMarkLines]}\r\n    //                     stroke={ChartState.xaxis.style.strokeColor}\r\n    //                     strokeWidth={1}\r\n    //                   />\r\n    //                   {!!ChartState.grid.useGridX ? (\r\n    //                     <Line\r\n    //                       x={xaxisTick.x}\r\n    //                       y={0 + 0.5}\r\n    //                       points={[0, 0, 0, ChartState.containerSize.height - 1 - heightXAxis + 0.5]}\r\n    //                       stroke={ChartState.grid.style.strokeColor}\r\n    //                       strokeWidth={1}\r\n    //                     />\r\n    //                   ) : null}\r\n    //                   <Shape\r\n    //                     sceneFunc={(context, shape) => {\r\n    //                       // context.fillS\r\n    //                       const ctx = context._context;\r\n    //                       ctx.font = ChartState.xaxis.style.fontSize + \"px \" + ChartState.xaxis.style.fontName;\r\n    //                       ctx.fillStyle = ChartState.xaxis.style.fontColor;\r\n    //                       ctx.textAlign = \"center\";\r\n    //                       ctx.textBaseline = \"top\";\r\n    //                       ctx.fillText(\r\n    //                         xaxisTick.dateString,\r\n    //                         xaxisTick.x,\r\n    //                         ChartState.containerSize.height - 1 - heightXAxis + 0.5 + 20 + 5 // additional 5px distance to end of tickmark\r\n    //                       );\r\n    //                       // (!) Konva specific method, it is very important\r\n    //                       context.fillStrokeShape(shape);\r\n    //                     }}\r\n    //                     // fill=\"#333\"\r\n    //                     // stroke={ChartState.options.xAxis.style.fontColor}\r\n    //                     // strokeWidth={1}\r\n    //                   />\r\n    //                 </React.Fragment>\r\n    //               );\r\n    //             })}\r\n    //           </Layer>\r\n    //           {/*  Canvas Layer 7 before 2 - y axis */}\r\n    //           <Layer\r\n    //             scale={{\r\n    //               x: previewSize / ChartState.containerSize.width,\r\n    //               y: previewSize / ChartState.containerSize.height,\r\n    //             }}\r\n    //           >\r\n    //             {ChartState.subCharts.map((subchart, subchartIdx) => {\r\n    //               return subchart.yaxis.map((singleYaxis, singleYaxisIdx) => {\r\n    //                 const yAxisTicks = singleYaxis.drawTicks;\r\n\r\n    //                 // const yAxisTicks =\r\n    //                 //   subchartIdx === 0 ? subchart.yaxis[0] : subchart.yaxis[0].slice(0, subchart.yaxis[0].length - 1);\r\n    //                 return yAxisTicks.map((yaxisTick, yaxisTickIdx) => {\r\n    //                   return (\r\n    //                     <React.Fragment key={yaxisTick.label}>\r\n    //                       <Line\r\n    //                         x={ChartState.containerSize.width - 1 - widthYAxis + 0.5}\r\n    //                         y={yaxisTick.pixY + 0.5}\r\n    //                         points={[0, 0, widthTickmarkLines, 0]}\r\n    //                         stroke={ChartState.xaxis.style.strokeColor}\r\n    //                         strokeWidth={1}\r\n    //                       />\r\n    //                       {!!ChartState.grid.useGridY ? (\r\n    //                         <Line\r\n    //                           x={0 + 0.5}\r\n    //                           y={yaxisTick.pixY + 0.5}\r\n    //                           points={[0, 0, ChartState.containerSize.width - 1 + 0.5, 0]}\r\n    //                           stroke={ChartState.grid.style.strokeColor}\r\n    //                           strokeWidth={1}\r\n    //                         />\r\n    //                       ) : null}\r\n    //                       <Shape\r\n    //                         sceneFunc={(context, shape) => {\r\n    //                           // context.fillS\r\n    //                           const ctx = context._context;\r\n    //                           ctx.font = ChartState.yaxis.style.fontSize + \"px \" + ChartState.yaxis.style.fontName;\r\n    //                           ctx.fillStyle = ChartState.yaxis.style.fontColor;\r\n    //                           ctx.textAlign = \"left\";\r\n    //                           ctx.textBaseline = \"middle\";\r\n    //                           ctx.fillText(\r\n    //                             yaxisTick.label,\r\n    //                             ChartState.containerSize.width - 1 - widthYAxis + widthTickmarkLines + 5 + 0.5,\r\n    //                             yaxisTick.pixY // additional 5px distance to end of tickmark\r\n    //                           );\r\n    //                           // (!) Konva specific method, it is very important\r\n    //                           context.fillStrokeShape(shape);\r\n    //                         }}\r\n    //                       />\r\n    //                     </React.Fragment>\r\n    //                   );\r\n    //                 });\r\n    //               });\r\n    //             })}\r\n    //           </Layer>\r\n    //         </Stage>\r\n    //       </Paper>\r\n    //     </Grid>\r\n    //   ) : null}\r\n    // </Grid>\r\n  );\r\n};\r\n","import { createChartGraphModel } from \"./CChartModel\";\r\nimport {\r\n  DataSeries,\r\n  ChartDataset,\r\n  IndicatorDataset,\r\n  isCandleChartDataset,\r\n  isVolumeDataset,\r\n  IndicatorDataSeries,\r\n  ChartDataSeries,\r\n  isLineChartDataset,\r\n  isIndicatorDataset,\r\n} from \"./Types/CChartTypes\";\r\nimport { AdditionalIndicatorGraphStateType, isChartGraph } from \"./Types/CChartStateTypes\";\r\n\r\nexport const iSMACalc = (\r\n  srcChartData: DataSeries,\r\n  srcChartName: string,\r\n  period: number = 20,\r\n  applyOn: \"open\" | \"close\" | \"high\" | \"low\" = \"close\"\r\n): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataSeries =\r\n    srcChartData.map((srcDataset, srcDatasetIdx) => {\r\n      if (srcDatasetIdx < period - 1) return { prices: [null], date: srcDataset.date };\r\n      let singleSmaAcc = 0;\r\n      srcChartData.slice(srcDatasetIdx - period + 1, srcDatasetIdx + 1).forEach((selSrcDataset) => {\r\n        if (isLineChartDataset(selSrcDataset)) singleSmaAcc += selSrcDataset.close;\r\n        else if (isIndicatorDataset(selSrcDataset))\r\n          singleSmaAcc += !!selSrcDataset.prices[0] ? selSrcDataset.prices[0] : 0;\r\n      });\r\n      return { prices: [singleSmaAcc / period], date: srcDataset.date };\r\n    }) || [];\r\n  return indicatorData;\r\n  // const indicatorData: IndicatorDataset[] = [];\r\n  // for (let i = 0; i < srcChartData.length; i++) {\r\n  //   if (i < period - 1) {\r\n  //     indicatorData.push({ prices: [null], date: srcChartData[i].date });\r\n  //     continue;\r\n  //   }\r\n  //   let singleSmaAcc = 0;\r\n  //   for (let j = i - period + 1; j <= i; j++) {\r\n  //     singleSmaAcc += srcChartData[j].close;\r\n  //   }\r\n  //   indicatorData.push({ prices: [singleSmaAcc / period], date: srcChartData[i].date });\r\n  // }\r\n  // return indicatorData;\r\n};\r\n\r\nexport const iSMA: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  indicatorFn: iSMACalc,\r\n  name: \"SMA\",\r\n  params: [{ name: \"period\", val: 10 }],\r\n  default: { params: [{ name: \"period\", val: 10 }], newSubchart: false },\r\n  type: \"line\",\r\n};\r\n\r\nexport const iEMACalc = (\r\n  srcChartData: DataSeries,\r\n  srcChartName: string,\r\n  period: number = 20,\r\n  applyOn: \"open\" | \"close\" | \"high\" | \"low\" = \"close\"\r\n): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataSeries = [];\r\n  for (let i = 0; i < srcChartData.length; i++) {\r\n    if (i < period - 1) {\r\n      indicatorData.push({ prices: [null], date: srcChartData[i].date });\r\n      continue;\r\n    } else if (i === period - 1) {\r\n      let initSMA = 0;\r\n      for (let j = 0; j < period; j++) {\r\n        const dataset = srcChartData[j];\r\n        const price = isLineChartDataset(dataset)\r\n          ? dataset.close\r\n          : isIndicatorDataset(dataset)\r\n          ? dataset.prices[0] || 0\r\n          : 0;\r\n        initSMA += price;\r\n      }\r\n      initSMA /= period;\r\n      indicatorData.push({ prices: [initSMA], date: srcChartData[i].date });\r\n    } else {\r\n      const multiplier = 2 / (period + 1);\r\n      const dataset = srcChartData[i];\r\n      const price = isLineChartDataset(dataset)\r\n        ? dataset.close\r\n        : isIndicatorDataset(dataset)\r\n        ? dataset.prices[0] || 0\r\n        : 0;\r\n      const ema =\r\n        (price - (indicatorData[i - 1].prices[0] as number)) * multiplier + (indicatorData[i - 1].prices[0] as number);\r\n      indicatorData.push({ prices: [ema], date: srcChartData[i].date });\r\n    }\r\n  }\r\n  return indicatorData;\r\n};\r\nexport const iEMA: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  indicatorFn: iEMACalc,\r\n  name: \"EMA\",\r\n  params: [{ name: \"period\", val: 10 }],\r\n  default: { params: [{ name: \"period\", val: 10 }], newSubchart: false },\r\n  type: \"line\",\r\n};\r\n\r\nexport const iATRCalc = (\r\n  srcChartData: ChartDataset[],\r\n  srcChartName: string,\r\n  period: number = 20,\r\n  applyOn: \"open\" | \"close\" | \"high\" | \"low\" = \"close\"\r\n): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataset[] = [];\r\n  for (let i = 0; i < srcChartData.length; i++) {\r\n    if (i < period) {\r\n      indicatorData.push({ prices: [null], date: srcChartData[i].date });\r\n      continue;\r\n    }\r\n    let singleValAcc = 0;\r\n    for (let j = i - period + 1; j <= i; j++) {\r\n      const dataset = srcChartData[j];\r\n      const dataset1 = srcChartData[j - 1];\r\n      let singleAtr = 0;\r\n      if (isCandleChartDataset(dataset) && isCandleChartDataset(dataset1)) {\r\n        const hl = dataset.high - dataset.low;\r\n        const hc1 = Math.abs(dataset.high - dataset1.close);\r\n        const lc1 = Math.abs(dataset.low - dataset1.close);\r\n        singleAtr = Math.max(hl, hc1, lc1);\r\n      } else {\r\n        const dc = Math.abs(dataset.close - dataset1.close);\r\n      }\r\n      singleValAcc += singleAtr;\r\n    }\r\n    indicatorData.push({ prices: [singleValAcc / period], date: srcChartData[i].date });\r\n  }\r\n  return indicatorData;\r\n};\r\nexport const iATR: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  indicatorFn: iATRCalc,\r\n  name: \"ATR\",\r\n  params: [{ name: \"period\", val: 14 }],\r\n  default: { params: [{ name: \"period\", val: 14 }], newSubchart: true },\r\n  type: \"line\",\r\n};\r\n\r\nexport const iRSICalc = (\r\n  srcChartData: ChartDataset[],\r\n  srcChartName: string,\r\n  period: number = 20,\r\n  applyOn: \"open\" | \"close\" | \"high\" | \"low\" = \"close\"\r\n): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataset[] = [];\r\n  let calcData: { lastUpEma: number; lastDwnEma: number } | null = null;\r\n  for (let i = 0; i < srcChartData.length; i++) {\r\n    if (i < period) {\r\n      indicatorData.push({ prices: [null], date: srcChartData[i].date });\r\n      if (i === 0) continue;\r\n    }\r\n    const dataset = srcChartData[i];\r\n    const dataset1 = srcChartData[i - 1];\r\n    const dClose = dataset.close - dataset1.close;\r\n    const up = dClose > 0 ? dClose : 0;\r\n    const dwn = dClose < 0 ? -dClose : 0;\r\n    const w = 1 / period;\r\n    if (i === 1) {\r\n      calcData = { lastUpEma: up, lastDwnEma: dwn };\r\n    }\r\n    if (!calcData || i < period) {\r\n      continue;\r\n    }\r\n    const upSmoothed = up * w + (1 - w) * calcData.lastUpEma;\r\n    calcData.lastUpEma = upSmoothed;\r\n    const dwnSmoothed = dwn * w + (1 - w) * calcData.lastDwnEma;\r\n    calcData.lastDwnEma = dwnSmoothed;\r\n    const rsi = dwnSmoothed === 0 ? 100 : 100 - 100 / (1 + upSmoothed / dwnSmoothed);\r\n    if (i < period) indicatorData.push({ prices: [null], date: srcChartData[i].date });\r\n    else indicatorData.push({ prices: [rsi], date: srcChartData[i].date });\r\n  }\r\n  return indicatorData;\r\n};\r\nexport const iRSI: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  indicatorFn: iRSICalc,\r\n  name: \"RSI\",\r\n  params: [{ name: \"period\", val: 14 }],\r\n  default: { params: [{ name: \"period\", val: 14 }], newSubchart: true, decimals: 2, fixedYScale: [0, 100] },\r\n  type: \"line\",\r\n};\r\n\r\nexport const iOBVCalc = (srcChartData: ChartDataset[]): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataset[] = [];\r\n  for (let i = 0; i < srcChartData.length; i++) {\r\n    const dataset = srcChartData[i];\r\n    if (i === 0 && isVolumeDataset(dataset)) {\r\n      indicatorData.push({ prices: [dataset.volume], date: dataset.date });\r\n      continue;\r\n    }\r\n    const dataset1 = srcChartData[i - 1];\r\n    if (!isVolumeDataset(dataset) || !isVolumeDataset(dataset1)) {\r\n      indicatorData.push({ prices: [null], date: srcChartData[i].date });\r\n      continue;\r\n    }\r\n    const obv = dataset.volume + dataset1.volume;\r\n    indicatorData.push({ prices: [obv], date: srcChartData[i].date });\r\n  }\r\n  return indicatorData;\r\n};\r\nexport const iOBV: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  name: \"OBV\",\r\n  type: \"line\",\r\n  params: [],\r\n  default: { params: [], newSubchart: true, decimals: 0 },\r\n  indicatorFn: iOBVCalc,\r\n};\r\n\r\nexport const iVolumeCalc = (srcChartData: ChartDataset[]): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataset[] = [];\r\n  for (let i = 0; i < srcChartData.length; i++) {\r\n    const dataset = srcChartData[i];\r\n    if (isVolumeDataset(dataset)) {\r\n      indicatorData.push({ prices: [dataset.volume], date: dataset.date });\r\n    } else {\r\n      indicatorData.push({ prices: [0], date: dataset.date });\r\n    }\r\n  }\r\n  return indicatorData;\r\n};\r\nexport const iVolume: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  indicatorFn: iVolumeCalc,\r\n  name: \"Volume\",\r\n  params: [],\r\n  default: { params: [], newSubchart: true, decimals: 0 },\r\n  type: \"bars\",\r\n};\r\n\r\nexport const iMACDCalc = (\r\n  srcChartData: ChartDataset[],\r\n  srcChartName: string,\r\n  periodEmaShort: number = 12,\r\n  periodEmaLong: number = 26,\r\n  periodSignal: number = 9,\r\n  applyOn: \"open\" | \"close\" | \"high\" | \"low\" = \"close\"\r\n): IndicatorDataSeries => {\r\n  const indicatorData: IndicatorDataSeries = [];\r\n  const emaShort = iEMACalc(srcChartData, srcChartName, periodEmaShort);\r\n  const emaLong = iEMACalc(srcChartData, srcChartName, periodEmaLong);\r\n\r\n  const macd: IndicatorDataSeries = emaShort.map((val, valIdx) => {\r\n    const emaLongVal = emaLong[valIdx].prices[0];\r\n    const emaShortVal = val.prices[0];\r\n    const macd = emaShortVal === null || emaLongVal === null ? null : emaShortVal - emaLongVal;\r\n    return {\r\n      prices: [macd],\r\n      date: srcChartData[valIdx].date,\r\n      priceLabels: [\"EMA\"],\r\n    };\r\n  });\r\n  //   // const emaIn = ema.map((ema1, ema1Idx) => ({ close: ema1.prices[0], date: ema1.date }));\r\n  const signal = iEMACalc(macd, srcChartName, periodSignal);\r\n  const macdComplete = macd.map((macdVal, macdIdx) => {\r\n    const macdValPrice = macdVal.prices[0];\r\n    const signalVal = signal[macdIdx].prices[0];\r\n    const macdHistogramm = macdValPrice === null || signalVal === null ? null : macdValPrice-signalVal; \r\n    return { ...macdVal, prices: [macdValPrice, signalVal, macdHistogramm] };\r\n  });\r\n  return macdComplete;\r\n};\r\n\r\nexport const iMACD: AdditionalIndicatorGraphStateType[\"indicator\"] = {\r\n  indicatorFn: iMACDCalc,\r\n  name: \"MACD\",\r\n  params: [\r\n    { name: \"period short\", val: 12 },\r\n    { name: \"period long\", val: 26 },\r\n    { name: \"signal period\", val: 9 },\r\n  ],\r\n  default: {\r\n    params: [\r\n      { name: \"period short\", val: 12 },\r\n      { name: \"period long\", val: 26 },\r\n      { name: \"signal period\", val: 9 },\r\n    ],\r\n    newSubchart: true,\r\n    // decimals: 0,\r\n  },\r\n  type: \"line\",\r\n};\r\n","import { makeStyles, Theme, createStyles, Typography, TypographyProps } from \"@material-ui/core\";\r\nimport { Variant } from \"@material-ui/core/styles/createTypography\";\r\nimport { TreeItemProps, TreeItem } from \"@material-ui/lab\";\r\n\r\nconst useTreeItemStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      color: theme.palette.text.secondary,\r\n      \"&:hover > $content\": {\r\n        backgroundColor: theme.palette.action.hover,\r\n      },\r\n      \"&:focus > $content, &$selected > $content\": {\r\n        backgroundColor: `var(--tree-view-bg-color, ${theme.palette.grey[400]})`,\r\n        color: \"var(--tree-view-color)\",\r\n      },\r\n      \"&:focus > $content $label, &:hover > $content $label, &$selected > $content $label\": {\r\n        backgroundColor: \"transparent\",\r\n      },\r\n    },\r\n    content: {\r\n      color: theme.palette.text.secondary,\r\n      borderTopRightRadius: theme.spacing(2),\r\n      borderBottomRightRadius: theme.spacing(2),\r\n      paddingRight: theme.spacing(1),\r\n      fontWeight: theme.typography.fontWeightMedium,\r\n      \"$expanded > &\": {\r\n        fontWeight: theme.typography.fontWeightRegular,\r\n      },\r\n      width: \"auto\",\r\n    },\r\n    group: {\r\n      marginLeft: 0,\r\n      \"& $content\": {\r\n        paddingLeft: theme.spacing(2),\r\n      },\r\n    },\r\n    expanded: {},\r\n    selected: {},\r\n    label: {\r\n      fontWeight: \"inherit\",\r\n      color: \"inherit\",\r\n    },\r\n    labelRoot: {\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      padding: theme.spacing(1, 0),\r\n    },\r\n    labelRootBtn: {\r\n      // display: \"flex\",\r\n      // alignItems: \"left\",\r\n      // padding: theme.spacing(0.5, 0),\r\n      width: \"max-content\",\r\n    },\r\n    btnLabel: {\r\n      padding: 0,\r\n    },\r\n    labelIcon: {\r\n      marginRight: theme.spacing(1),\r\n    },\r\n    labelText: {\r\n      fontWeight: \"inherit\",\r\n      flexGrow: 1,\r\n    },\r\n  })\r\n);\r\n\r\ndeclare module \"csstype\" {\r\n  interface Properties {\r\n    \"--tree-view-color\"?: string;\r\n    \"--tree-view-bg-color\"?: string;\r\n  }\r\n}\r\nexport type CTreeItemProps = TreeItemProps & {\r\n  bgColor?: string;\r\n  color?: string;\r\n  labelIcon?: JSX.Element;\r\n  labelInfo?: JSX.Element | string;\r\n  labelText: string | JSX.Element;\r\n  onLabelClick?: TreeItemProps[\"onLabelClick\"];\r\n  onIconClick?: TreeItemProps[\"onIconClick\"];\r\n  labelTypographyVariant?: Variant;\r\n  infoTypographyVariant?: Variant;\r\n  labelTypographyColor?: TypographyProps[\"color\"];\r\n  infoTypographyColor?: TypographyProps[\"color\"];\r\n};\r\n\r\nexport const CTreeItem = (props: CTreeItemProps) => {\r\n  const classes = useTreeItemStyles();\r\n  const {\r\n    labelText,\r\n    labelIcon: LabelIcon,\r\n    labelInfo,\r\n    color,\r\n    bgColor,\r\n    onLabelClick,\r\n    onIconClick,\r\n    labelTypographyVariant,\r\n    infoTypographyVariant,\r\n    labelTypographyColor,\r\n    infoTypographyColor,\r\n    ...other\r\n  } = props;\r\n\r\n  return (\r\n    <TreeItem\r\n      onLabelClick={onLabelClick}\r\n      onIconClick={onIconClick}\r\n      label={\r\n        <div className={classes.labelRoot}>\r\n          {LabelIcon}\r\n          <Typography\r\n            variant={labelTypographyVariant ?? \"body1\"}\r\n            className={classes.labelText}\r\n            color={labelTypographyColor ?? \"initial\"}\r\n          >\r\n            {labelText}\r\n          </Typography>\r\n          <Typography variant={infoTypographyVariant ?? \"caption\"} color={infoTypographyColor ?? \"initial\"}>\r\n            {labelInfo}\r\n          </Typography>\r\n        </div>\r\n      }\r\n      style={{\r\n        \"--tree-view-color\": color,\r\n        \"--tree-view-bg-color\": bgColor,\r\n        // boxSizing: \"content-box\",\r\n      }}\r\n      classes={{\r\n        root: classes.root,\r\n        content: classes.content,\r\n        expanded: classes.expanded,\r\n        selected: classes.selected,\r\n        group: classes.group,\r\n        label: classes.label,\r\n      }}\r\n      {...other}\r\n    />\r\n  );\r\n};\r\n","import { Button, Grid, IconButton, OutlinedInput, Popover, Slider, TextField, Typography } from \"@material-ui/core\";\r\nimport { mdiCheck, mdiExclamation, mdiHook } from \"@mdi/js\";\r\nimport Icon from \"@mdi/react\";\r\nimport React from \"react\";\r\nimport { colorNameToHex, colorNameToRGB, hexToRgb } from \"./utils\";\r\n\r\n// const colors = [\r\n//   \"#000\", //black to white\r\n//   \"#666\",\r\n//   \"#bbb\",\r\n//   \"#fff\",\r\n//   \"#9013fe\", //violets\r\n//   \"#bd10e0\",\r\n//   \"#3f51b5\", // blues\r\n//   \"#0693E3\",\r\n//   \"#8ED1FC\",\r\n//   \"#008080\", // greens\r\n//   \"#00D084\",\r\n//   \"#7BDCB5\",\r\n//   \"#b80000\", // reds\r\n//   \"#f50057\",\r\n//   \"#f78da7\",\r\n//   \"#795548\", // brown to yellow\r\n//   \"#FF6900\",\r\n//   \"#FCB900\",\r\n// ];\r\nconst rgbaColor = [\r\n  \"0, 0, 0\", //black to whites\r\n  \"102, 102, 102\",\r\n  \"187, 187, 187\",\r\n  \"255, 255, 255\",\r\n  \"144, 19, 254\", // violets\r\n  \"189, 16, 224\",\r\n  \"63, 81, 181\", //blues\r\n  \"6, 147, 227\",\r\n  \"142, 209, 252\",\r\n  \"0, 128, 128\", // greens\r\n  \"0, 208, 132\",\r\n  \"123, 220, 181\",\r\n  \"184, 0, 0\", // red\r\n  \"245, 0, 87\",\r\n  \"247, 141, 167\",\r\n  \"121, 85, 72\", // brown to yellow\r\n  \"255, 105, 0\",\r\n  \"252, 185, 0\",\r\n];\r\n\r\n// const useStyles = makeStyles((theme: Theme) =>\r\n//   createStyles({\r\n//     root: {\r\n//       \"& > *\": {\r\n//         margin: theme.spacing(1),\r\n//         width: \"25ch\",\r\n//       },\r\n//     },\r\n//   })\r\n// );\r\n\r\nexport const ColorRect = (props: {\r\n  color: React.CSSProperties[\"background\"];\r\n  width?: number;\r\n  height?: number;\r\n  container?: any;\r\n}) => {\r\n  const { color, width = 15, height = 15, container = {} } = props;\r\n  return (\r\n    <div style={{ width: 24, height: 24, boxSizing: \"border-box\", padding: 4, ...container }}>\r\n      <div\r\n        style={{\r\n          border: \"2px solid #000\",\r\n          width: width,\r\n          height: height,\r\n          borderRadius: 3,\r\n          boxSizing: \"border-box\",\r\n          background: color,\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport type ColorpickerProps = {\r\n  color: React.CSSProperties[\"background\"];\r\n  onColorSelected: (color: string) => void;\r\n};\r\nexport const Colorpicker = (props: ColorpickerProps) => {\r\n  const { color, onColorSelected } = props;\r\n  const [Open, setOpen] = React.useState(false);\r\n  const [ColorHover, setColorHover] = React.useState<string | null>(null);\r\n\r\n  const InputRef = React.useRef<HTMLButtonElement>(null);\r\n\r\n  const isHex = /((^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$))/i.test(color as string);\r\n  const hexToRgbRes = !!isHex && typeof color === \"string\" ? hexToRgb(color) : null;\r\n  const isRgb =\r\n    typeof color === \"string\"\r\n      ? (color as string).match(\r\n          /^(rgb)(a?)[(]\\s*([\\d.]+\\s*%?)\\s*,\\s*([\\d.]+\\s*%?)\\s*,\\s*([\\d.]+\\s*%?)\\s*(?:,\\s*([\\d.]+)\\s*)?[)]$/\r\n        )\r\n      : null;\r\n  const isRgba = !!isRgb && 2 in isRgb && isRgb[2] === \"a\";\r\n  const rgbInternal =\r\n    !!isRgb && 3 in isRgb && 4 in isRgb && 5 in isRgb\r\n      ? [parseFloat(isRgb[3]), parseFloat(isRgb[4]), parseFloat(isRgb[5])]\r\n      : isHex && !!hexToRgbRes\r\n      ? [hexToRgbRes.r, hexToRgbRes.g, hexToRgbRes.b]\r\n      : [];\r\n  if (rgbInternal.length === 0) {\r\n    const colorNameRes = colorNameToRGB(color as string);\r\n    if (!!colorNameRes) rgbInternal.push(colorNameRes.r, colorNameRes.g, colorNameRes.b);\r\n  }\r\n\r\n  const alphaProp = !!isRgba && !!isRgb && 6 in isRgb ? parseFloat(isRgb[6]) * 100 : 100;\r\n  const [AlphaVal, setAlphaVal] = React.useState(alphaProp);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <IconButton\r\n        color=\"primary\"\r\n        style={{ padding: 0 }}\r\n        onClick={() => {\r\n          setOpen(true);\r\n        }}\r\n        ref={InputRef}\r\n      >\r\n        <ColorRect color={color} />\r\n      </IconButton>\r\n      <Popover\r\n        id={\"id\"}\r\n        open={Open}\r\n        anchorEl={InputRef.current}\r\n        onClose={() => {\r\n          setOpen(false);\r\n        }}\r\n        anchorOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"center\",\r\n        }}\r\n        transformOrigin={{\r\n          vertical: \"top\",\r\n          horizontal: \"center\",\r\n        }}\r\n        style={{ width: 250 + 50 }}\r\n      >\r\n        <Grid\r\n          container\r\n          alignContent=\"center\"\r\n          alignItems=\"center\"\r\n          justify=\"space-evenly\"\r\n          spacing={1}\r\n          style={{ margin: \"10px 15px 10px 15px\", width: 250 }}\r\n        >\r\n          {rgbaColor.map((clr, clrIdx) => (\r\n            <Grid item xs={2} key={clrIdx}>\r\n              <IconButton\r\n                color=\"default\"\r\n                style={{ padding: 0 }}\r\n                onMouseOver={(e) => {\r\n                  setColorHover(`rgba(${rgbaColor[clrIdx]},${AlphaVal})`);\r\n                }}\r\n                onMouseLeave={() => {\r\n                  setColorHover(null);\r\n                }}\r\n                onClick={() => {\r\n                  onColorSelected(\"rgba(\" + rgbaColor[clrIdx] + \",\" + AlphaVal / 100 + \")\");\r\n                  // setOpen(false);\r\n                }}\r\n              >\r\n                <ColorRect\r\n                  color={\"rgba(\" + clr + \",1)\"}\r\n                  width={24}\r\n                  height={24}\r\n                  container={{ width: \"auto\", height: \"auto\" }}\r\n                />\r\n              </IconButton>\r\n            </Grid>\r\n          ))}\r\n          <Grid item xs={3}>\r\n            <Typography>Alpha</Typography>\r\n          </Grid>\r\n          <Grid item xs={6} style={{ padding: \"0px 10px\" }}>\r\n            <Slider\r\n              value={AlphaVal}\r\n              onChange={(e, val) => {\r\n                setAlphaVal(Array.isArray(val) ? val[0] : val);\r\n                onColorSelected(\r\n                  `rgba(${rgbInternal[0]},${rgbInternal[1]},${rgbInternal[2]},${\r\n                    (Array.isArray(val) ? val[0] : val) / 100\r\n                  })`\r\n                );\r\n              }}\r\n            ></Slider>\r\n          </Grid>\r\n          <Grid item xs={3}>\r\n            <TextField\r\n              margin=\"none\"\r\n              variant=\"outlined\"\r\n              size=\"small\"\r\n              inputProps={{ style: { padding: \"5px 5px 5px 10px\" } }}\r\n              value={AlphaVal}\r\n              onChange={(e) => {\r\n                let val = parseInt(e.target.value, 10);\r\n                if (isNaN(val)) val = 0;\r\n                if (val < 0 || val > 100) return;\r\n                setAlphaVal(val);\r\n                onColorSelected(`rgba(${rgbInternal[0]},${rgbInternal[1]},${rgbInternal[2]},${val / 100})`);\r\n              }}\r\n            />\r\n          </Grid>\r\n        </Grid>\r\n        <div style={{ background: \"#bbb\", borderTop: \"1px solid #666\" }}>\r\n          <Grid\r\n            container\r\n            alignItems=\"center\"\r\n            alignContent=\"center\"\r\n            justify=\"center\"\r\n            // spacing={.5}\r\n            style={{\r\n              paddingBottom: 5,\r\n\r\n              // width: \"100%\",\r\n              // padding: \"10px 10px 0px 15px\",\r\n              margin: \"10px 15px 0px 15px\",\r\n              width: 250,\r\n              // textAlign: \"center\",\r\n            }}\r\n            // style={{ margin: \"10px 10px 0px 15px\", width: 250 }}\r\n          >\r\n            <Grid item xs={2}>\r\n              <Typography component=\"div\" align=\"center\">\r\n                R\r\n              </Typography>\r\n            </Grid>\r\n\r\n            <Grid item xs={2}>\r\n              <Typography component=\"div\" align=\"center\">\r\n                G\r\n              </Typography>\r\n            </Grid>\r\n\r\n            <Grid item xs={2}>\r\n              <Typography component=\"div\" align=\"center\">\r\n                B\r\n              </Typography>\r\n            </Grid>\r\n            <Grid item xs={2}>\r\n              <Typography component=\"div\" align=\"center\">\r\n                A\r\n              </Typography>\r\n            </Grid>\r\n\r\n            {/* <Grid item xs={2} style={{ padding: \"5px 0 0 0\" }}>\r\n            <TextField\r\n              value={!!ColorHover ? ColorHover : color}\r\n              margin=\"none\"\r\n              variant=\"outlined\"\r\n              size=\"small\"\r\n              inputProps={{ style: { padding: 5, background: \"#bbb\" } }}\r\n            />\r\n          </Grid> */}\r\n            <Grid item xs={2} />\r\n            <Grid item xs={2}>\r\n              <ColorRect\r\n                color={!!ColorHover ? ColorHover : color}\r\n                width={24}\r\n                height={24}\r\n                container={{ width: \"auto\", height: \"auto\" }}\r\n              />\r\n            </Grid>\r\n          </Grid>\r\n          <Grid\r\n            container\r\n            alignItems=\"center\"\r\n            alignContent=\"center\"\r\n            justify=\"center\"\r\n            // spacing={.5}\r\n            style={{\r\n              paddingBottom: 15,\r\n              // borderTop: \"1px solid #666\",\r\n\r\n              // width: \"100%\",\r\n              // padding: \"10px 10px 0px 15px\",\r\n              paddingLeft: \"15px\",\r\n              // paddingRight: \"0px\",\r\n              // width: \"min-content\",\r\n              // textAlign: \"center\",\r\n            }}\r\n            // style={{ margin: \"10px 10px 0px 15px\", width: 250 }}\r\n          >\r\n            <Grid item xs={2}>\r\n              <TextField\r\n                value={!!rgbInternal ? rgbInternal[0] : color}\r\n                margin=\"none\"\r\n                variant=\"outlined\"\r\n                size=\"small\"\r\n                inputProps={{\r\n                  style: { padding: 5, background: `rgba(184, 0, 0, ${AlphaVal / 100})` },\r\n                }}\r\n              />\r\n            </Grid>\r\n\r\n            <Grid item xs={2}>\r\n              <TextField\r\n                value={!!rgbInternal ? rgbInternal[1] : color}\r\n                margin=\"none\"\r\n                variant=\"outlined\"\r\n                size=\"small\"\r\n                inputProps={{ style: { padding: 5, background: `rgba(0, 208, 132, ${AlphaVal / 100})` } }}\r\n                fullWidth\r\n              />\r\n            </Grid>\r\n            <Grid item xs={2}>\r\n              <TextField\r\n                value={!!rgbInternal ? rgbInternal[2] : color}\r\n                margin=\"none\"\r\n                variant=\"outlined\"\r\n                size=\"small\"\r\n                inputProps={{ style: { padding: 5, background: `rgba(6, 147, 227, ${AlphaVal / 100})` } }}\r\n              />\r\n            </Grid>\r\n            <Grid item xs={2}>\r\n              <TextField\r\n                value={AlphaVal}\r\n                margin=\"none\"\r\n                variant=\"outlined\"\r\n                size=\"small\"\r\n                inputProps={{ style: { padding: 5, background: `#bbb` } }}\r\n              />\r\n            </Grid>\r\n            <Grid item xs={1} />\r\n            <Grid item xs={3}>\r\n              <div style={{ textAlign: \"center\", margin: \"0px auto\" }}>\r\n                {/* <IconButton color=\"primary\" size=\"medium\" style={{ border: \"1px solid #666\", borderRadius: \"50%\", background: \"limegreen\" }}>\r\n                  <Icon path={mdiCheck} size={1} />\r\n                </IconButton> */}\r\n                <Button\r\n                  color=\"primary\"\r\n                  variant=\"outlined\"\r\n                  size=\"small\"\r\n                  style={{ minWidth: 0 }}\r\n                  onClick={() => setOpen(false)}\r\n                >\r\n                  OK\r\n                </Button>\r\n              </div>\r\n            </Grid>\r\n            {/* <Grid item xs={1} />  */}\r\n          </Grid>\r\n        </div>\r\n      </Popover>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Icon } from \"@mdi/react\";\r\nimport { ToggleButton, ToggleButtonGroup, TreeView } from \"@material-ui/lab\";\r\nimport {\r\n  mdiMenuDown,\r\n  mdiMenuRight,\r\n  mdiDiameterVariant,\r\n  mdiChartBellCurve,\r\n  mdiArrowExpandVertical,\r\n  mdiPoll,\r\n  mdiHome,\r\n  mdiFilter,\r\n  mdiMagnify,\r\n  mdiAlphabetical,\r\n  mdiSortAlphabeticalAscending,\r\n  mdiDivingScubaTank,\r\n  mdiBorderColor,\r\n  mdiClose,\r\n  mdiIframeVariableOutline,\r\n} from \"@mdi/js\";\r\nimport React from \"react\";\r\nimport { iSMA, iEMA, iRSI, iMACD, iATR, iVolume, iOBV } from \"../CIndicator\";\r\nimport {\r\n  AdditionalIndicatorGraphStateType,\r\n  CalculatedChartStateType,\r\n  ChartStateHookType,\r\n  isChartGraph,\r\n  isIndicatorGraph,\r\n} from \"../Types/CChartStateTypes\";\r\nimport { ChartDataSeries } from \"../Types/CChartTypes\";\r\nimport { Grid, IconButton, TextField, Typography, useTheme } from \"@material-ui/core\";\r\nimport { CTreeItem } from \"../CTreeItem\";\r\nimport { CChartMenuOpenType } from \"./ChartMenu\";\r\nimport { ReducerActionType } from \"../ChartState/CChartStateReducer\";\r\nimport { Colorpicker } from \"../Colorpicker\";\r\n\r\nconst onIndicatorLabelClick = (\r\n  indi: AdditionalIndicatorGraphStateType[\"indicator\"],\r\n  ChartState: CalculatedChartStateType\r\n) => {\r\n  if (indi.default.newSubchart)\r\n    return () => {\r\n      ChartState.methods.addSubchart(\r\n        ChartState.subCharts[0].yaxis[0].graphs[0].data as ChartDataSeries,\r\n        ChartState.subCharts[0].yaxis[0].graphs[0].name,\r\n        indi\r\n      );\r\n    };\r\n  else\r\n    return () => {\r\n      ChartState.methods.addGraph(\r\n        ChartState.subCharts[0].yaxis[0].graphs[0].data as ChartDataSeries,\r\n        ChartState.subCharts[0].yaxis[0].graphs[0].name,\r\n        0,\r\n        indi\r\n      );\r\n    };\r\n};\r\n\r\nexport const CIndicatorGraphTreeItem = (props: {\r\n  subchartIdx: number;\r\n  yaxisIdx: number;\r\n  graphIdx: number;\r\n  ChartState: CalculatedChartStateType;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n}) => {\r\n  const { subchartIdx, yaxisIdx, graphIdx, ChartState, ChartStateDispatch } = props;\r\n  const graphGeneric = ChartState.subCharts[subchartIdx].yaxis[yaxisIdx].graphs[graphIdx];\r\n  const graph = isIndicatorGraph(graphGeneric) ? graphGeneric : null;\r\n  const theme = useTheme();\r\n\r\n  if (!graph) return null;\r\n\r\n  return (\r\n    <CTreeItem\r\n      key={`graph-sub-${subchartIdx}-y-${yaxisIdx}-graph-${graphIdx}`}\r\n      nodeId={`graph-sub-${subchartIdx}-y-${yaxisIdx}-graph-${graphIdx}`}\r\n      labelText={graph.name}\r\n      bgColor=\"#eee\"\r\n      labelIcon={\r\n        <div\r\n          style={{\r\n            background: theme.palette.primary.main,\r\n            width: 32,\r\n            height: 32,\r\n            border: \"1px solid #666\",\r\n            borderRadius: 5,\r\n            marginRight: 10,\r\n          }}\r\n        >\r\n          <Icon path={mdiChartBellCurve} size={\"32px\"} color={theme.palette.secondary.contrastText} />\r\n        </div>\r\n      }\r\n      labelInfo={\r\n        subchartIdx !== 0 || graphIdx !== 0 ? (\r\n          <IconButton\r\n            size=\"small\"\r\n            onClick={(e) => {\r\n              e.preventDefault();\r\n              const action: ReducerActionType<\"removeGraph\"> = {\r\n                task: \"removeGraph\",\r\n                params: { subchartIdx, yaxisIdx: 0, graphIdx },\r\n              };\r\n              (ChartStateDispatch as React.Dispatch<ReducerActionType<\"removeGraph\">>)(action);\r\n            }}\r\n          >\r\n            <Icon path={mdiClose} size={1} color=\"#333\" />\r\n          </IconButton>\r\n        ) : undefined\r\n      }\r\n    >\r\n      <CTreeItem\r\n        key={subchartIdx * 1000 + yaxisIdx * 100 + graphIdx}\r\n        nodeId={(subchartIdx * 1000 + yaxisIdx * 100 + graphIdx).toString()}\r\n        labelText=\"line stroke color\"\r\n        labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n        labelInfo={\r\n          <Colorpicker\r\n            color={ChartState.subCharts[subchartIdx].yaxis[0].graphs[graphIdx].style?.strokeColor?.[0]}\r\n            onColorSelected={(color) => {\r\n              const action: ReducerActionType<\"setLineChartStrokeColor\"> = {\r\n                task: \"setLineChartStrokeColor\",\r\n                params: { color: color, subchartIdx, yaxisIdx: 0, graphIdx },\r\n              };\r\n              (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setLineChartStrokeColor\">>)(action);\r\n            }}\r\n          />\r\n        }\r\n      />\r\n      {graph.indicator.params.map((param, paramIdx) => (\r\n        <CTreeItem\r\n          nodeId={`${2 + subchartIdx}00-${graphIdx}-${paramIdx}`}\r\n          labelText={param.name}\r\n          labelIcon={<Icon path={mdiIframeVariableOutline} size={1} color=\"#333\" />}\r\n          labelInfo={\r\n            <TextField\r\n              variant=\"outlined\"\r\n              margin=\"none\"\r\n              size=\"small\"\r\n              inputProps={{ style: { padding: 5, width: 50 } }}\r\n              defaultValue={param.val}\r\n              onChange={(e) => {\r\n                const val = parseFloat(e.target.value);\r\n\r\n                if (isNaN(val)) return;\r\n                const action: ReducerActionType<\"setIndicatorParam\"> = {\r\n                  task: \"setIndicatorParam\",\r\n                  params: { val, subchartIdx, yaxisIdx: 0, graphIdx, paramIdx },\r\n                };\r\n                (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setIndicatorParam\">>)(action);\r\n              }}\r\n            />\r\n          }\r\n        />\r\n      ))}\r\n    </CTreeItem>\r\n  );\r\n};\r\n\r\nexport type IndicatorCategoryType = \"Average\" | \"Oszillator\" | \"Volatility\" | \"Volume\";\r\n\r\nexport const ChartMenuIndicators = (props: {\r\n  ChartState: CalculatedChartStateType;\r\n  onNavigate: (target: CChartMenuOpenType) => void;\r\n  open: CChartMenuOpenType;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n}) => {\r\n  const { ChartState, onNavigate, open, ChartStateDispatch } = props;\r\n  const theme = useTheme();\r\n  const [FilterCat, setFilterCat] = React.useState(true);\r\n\r\n  const categorys: { name: IndicatorCategoryType; icon: string }[] = [\r\n    { name: \"Average\", icon: mdiDiameterVariant },\r\n    { name: \"Oszillator\", icon: mdiChartBellCurve },\r\n    { name: \"Volatility\", icon: mdiArrowExpandVertical },\r\n    { name: \"Volume\", icon: mdiPoll },\r\n  ];\r\n  const indicators: {\r\n    name: string;\r\n    indicator: AdditionalIndicatorGraphStateType[\"indicator\"];\r\n    category: IndicatorCategoryType;\r\n  }[] = [\r\n    { name: \"SMA\", indicator: iSMA, category: \"Average\" },\r\n    { name: \"EMA\", indicator: iEMA, category: \"Average\" },\r\n    { name: \"RSI\", indicator: iRSI, category: \"Oszillator\" },\r\n    { name: \"MACD\", indicator: iMACD, category: \"Oszillator\" },\r\n    { name: \"ATR\", indicator: iATR, category: \"Volatility\" },\r\n    { name: \"Volume\", indicator: iVolume, category: \"Volume\" },\r\n    { name: \"OBV\", indicator: iOBV, category: \"Volume\" },\r\n  ];\r\n\r\n  const amtIndicators = ChartState.subCharts\r\n    .map((subchart, subIdx) =>\r\n      subchart.yaxis.map((yaxis, yaxixsIdx) => yaxis.graphs.filter((fgraph) => fgraph.type === \"indicator\").length)\r\n    )\r\n    .flat()\r\n    .reduce((acc, cur) => acc + cur);\r\n\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          right: 24, //see padding title bar\r\n          zIndex: 2,\r\n\r\n          // padding\r\n        }}\r\n      >\r\n        {amtIndicators > 0 ? (\r\n          <div style={{ paddingBottom: 5 }}>\r\n            <ToggleButtonGroup value={\"web\"} exclusive style={{ borderRadius: 500 }} size=\"small\">\r\n              <ToggleButton\r\n                // value=\"web\"\r\n                style={{\r\n                  borderBottomLeftRadius: 50,\r\n                  textTransform: \"none\",\r\n                  borderTopLeftRadius: 50,\r\n                  background: open === \"indicators\" ? theme.palette.secondary.light : \"#fff\",\r\n                }}\r\n                onClick={() => {\r\n                  onNavigate?.(\"indicators\");\r\n                }}\r\n              >\r\n                <Typography> Add</Typography>\r\n              </ToggleButton>\r\n              <ToggleButton\r\n                value=\"android\"\r\n                style={{\r\n                  borderBottomRightRadius: 50,\r\n                  borderTopRightRadius: 50,\r\n                  background: open === \"editIndicator\" ? theme.palette.secondary.light : \"#fff\",\r\n                }}\r\n                onClick={() => {\r\n                  onNavigate?.(\"editIndicator\");\r\n                }}\r\n              >\r\n                Edit\r\n              </ToggleButton>\r\n            </ToggleButtonGroup>\r\n          </div>\r\n        ) : null}\r\n        <div\r\n          style={{\r\n            background: theme.palette.secondary.light,\r\n            border: \"1px solid #666\",\r\n            borderRadius: 50,\r\n            padding: 5,\r\n          }}\r\n        >\r\n          <IconButton\r\n            size=\"small\"\r\n            style={{ border: \"1px solid #fff\", margin: \"0px 5px\" }}\r\n            onClick={() => alert(\"upcoming\")}\r\n          >\r\n            <Icon path={mdiMagnify} size={1} color={theme.palette.primary.contrastText} />\r\n          </IconButton>\r\n          <IconButton\r\n            size=\"small\"\r\n            style={{ border: \"1px solid #fff\", margin: \"0px 5px 0px 0px\" }}\r\n            onClick={() => setFilterCat((current) => !current)}\r\n          >\r\n            <Icon\r\n              path={FilterCat ? mdiSortAlphabeticalAscending : mdiFilter}\r\n              size={1}\r\n              color={theme.palette.primary.contrastText}\r\n            />\r\n          </IconButton>\r\n        </div>\r\n      </div>\r\n\r\n      <TreeView\r\n        //   className={classes.root}\r\n        //   defaultExpanded={[\"3\"]}\r\n        defaultCollapseIcon={<Icon path={mdiMenuDown} size={1} color=\"#333\" />}\r\n        defaultExpandIcon={<Icon path={mdiMenuRight} size={1} color=\"#333\" />}\r\n        defaultEndIcon={<div style={{ width: 24 }} />}\r\n        //   selected=\"1\"\r\n        //   onNodeSelect={() => {}}\r\n        disableSelection\r\n        // style={{height: 100, overflowY: \"scroll\"}}\r\n      >\r\n        {open === \"editIndicator\"\r\n          ? ChartState.subCharts.map((subchart, subchartIdx) =>\r\n              subchart.yaxis.map((yaxis, yaxisIdx) =>\r\n                yaxis.graphs.map((graph, graphIdx) =>\r\n                  isIndicatorGraph(graph) ? (\r\n                    <CIndicatorGraphTreeItem\r\n                      key={`editIndicator-sub-${subchartIdx}-yaxis-${yaxisIdx}-graph-${graphIdx}`}\r\n                      ChartState={ChartState}\r\n                      ChartStateDispatch={ChartStateDispatch}\r\n                      subchartIdx={subchartIdx}\r\n                      yaxisIdx={yaxisIdx}\r\n                      graphIdx={graphIdx}\r\n                    />\r\n                  ) : null\r\n                )\r\n              )\r\n            )\r\n          : !!FilterCat\r\n          ? categorys.map((cat, catIdx) => (\r\n              <CTreeItem\r\n                key={`cat-${catIdx}`}\r\n                nodeId={catIdx.toString()}\r\n                labelText={cat.name}\r\n                labelIcon={\r\n                  <div\r\n                    style={{\r\n                      border: \"1px solid #666\",\r\n                      borderRadius: 5,\r\n                      marginRight: 10,\r\n                      background: theme.palette.secondary.main,\r\n                      minWidth: 48,\r\n                      height: 48,\r\n                    }}\r\n                  >\r\n                    <Icon path={cat.icon} size={2} color={theme.palette.secondary.contrastText} />\r\n                  </div>\r\n                }\r\n                bgColor={theme.palette.primary.light}\r\n              >\r\n                {indicators\r\n                  .filter((indi) => indi.category === cat.name)\r\n                  .sort((a, b) => (a.name > b.name ? 1 : -1))\r\n                  .map((indi, indiIdx) => (\r\n                    <CTreeItem\r\n                      key={`cat-${catIdx}-indi-${indiIdx}`}\r\n                      nodeId={((catIdx + 1) * 100 + (indiIdx + 1)).toString()}\r\n                      labelText={indi.name}\r\n                      //   labelIcon={<Icon path={mdiFileChartOutline} size={1} color=\"#333\" />}\r\n                      bgColor={theme.palette.primary.light}\r\n                      onLabelClick={onIndicatorLabelClick(indi.indicator, ChartState)}\r\n                    />\r\n                  ))}\r\n              </CTreeItem>\r\n            ))\r\n          : indicators\r\n              .sort((a, b) => (a.name > b.name ? 1 : -1))\r\n              .map((indi, indiIdx) => (\r\n                <CTreeItem\r\n                  key={`cat-indi-${indiIdx}`}\r\n                  nodeId={(indiIdx + 1).toString()}\r\n                  labelText={indi.name}\r\n                  //   labelIcon={<Icon path={mdiFileChartOutline} size={1} color=\"#333\" />}\r\n                  bgColor={theme.palette.primary.light}\r\n                  onLabelClick={onIndicatorLabelClick(indi.indicator, ChartState)}\r\n                />\r\n              ))}\r\n      </TreeView>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Icon } from \"@mdi/react\";\r\nimport { ToggleButton, ToggleButtonGroup, TreeView } from \"@material-ui/lab\";\r\nimport {\r\n  mdiMenuDown,\r\n  mdiMenuRight,\r\n  mdiDiameterVariant,\r\n  mdiChartBellCurve,\r\n  mdiArrowExpandVertical,\r\n  mdiPoll,\r\n  mdiHome,\r\n  mdiFilter,\r\n  mdiMagnify,\r\n  mdiAlphabetical,\r\n  mdiSortAlphabeticalAscending,\r\n  mdiRuler,\r\n  mdiRulerSquareCompass,\r\n  mdiArrowSplitHorizontal,\r\n  mdiBorderColor,\r\n  mdiBullseye,\r\n  mdiHelp,\r\n  mdiMinus,\r\n} from \"@mdi/js\";\r\nimport React from \"react\";\r\n\r\nimport { CalculatedChartStateType, ChartStateHookType } from \"../Types/CChartStateTypes\";\r\nimport { ChartDataSeries } from \"../Types/CChartTypes\";\r\nimport { Grid, IconButton, TextField, Typography, useTheme } from \"@material-ui/core\";\r\nimport { CTreeItem } from \"../CTreeItem\";\r\nimport { ReducerActionType } from \"../ChartState/CChartStateReducer\";\r\nimport { Colorpicker } from \"../Colorpicker\";\r\nimport { CChartMenuOpenType } from \"./ChartMenu\";\r\n\r\nconst onToolLabelClick = (\r\n  ChartStateDispatch: ChartStateHookType[1],\r\n  type: NonNullable<CalculatedChartStateType[\"draw\"][\"type\"]>\r\n) => {\r\n  const subchartIdx = 0;\r\n  const action: ReducerActionType<\"draw\"> = { task: \"draw\", params: { type, subchartIdx } };\r\n  \r\n    (ChartStateDispatch as React.Dispatch<ReducerActionType<\"draw\">>)(action);\r\n  \r\n};\r\n\r\nexport const CToolTreeItem = (props: {\r\n  subchartIdx: number;\r\n  yaxisIdx: number;\r\n  toolIdx: number;\r\n  ChartState: CalculatedChartStateType;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n}) => {\r\n  const { subchartIdx, yaxisIdx, toolIdx, ChartState, ChartStateDispatch } = props;\r\n  const toolIn = ChartState.subCharts?.[subchartIdx]?.yaxis?.[yaxisIdx]?.tools?.[toolIdx];\r\n  const tool = !!toolIn ? toolIn : null;\r\n  if (!tool) return null;\r\n\r\n  return (\r\n    <CTreeItem\r\n      key={`tool-${toolIdx}`}\r\n      nodeId={`tool-${subchartIdx}-${toolIdx}`}\r\n      labelText={\r\n        tool.type === \"hline\"\r\n          ? \"horizontal line\"\r\n          : tool.type === \"vline\"\r\n          ? \"vertical line\"\r\n          : tool.type === \"trendline\"\r\n          ? \"Trendline\"\r\n          : \"Tool\"\r\n      }\r\n      labelIcon={\r\n        <Icon\r\n          path={tool.type === \"hline\" || tool.type === \"vline\" || tool.type === \"trendline\" ? mdiMinus : mdiHelp}\r\n          size={1}\r\n          color=\"#333\"\r\n          rotate={tool.type === \"trendline\" ? -45 : tool.type === \"vline\" ? 90 : 0}\r\n        />\r\n      }\r\n    >\r\n      {tool.type === \"hline\" ? (\r\n        <CTreeItem\r\n          key={`tool-${subchartIdx}-y0-${toolIdx}-hlinelevel`}\r\n          nodeId={`tool-${subchartIdx}-y0-${toolIdx}-hlinelevel`}\r\n          labelText={\"Y-Level\"}\r\n          labelIcon={<Icon path={mdiArrowSplitHorizontal} size={1} color=\"#333\" />}\r\n          labelInfo={\r\n            <TextField\r\n              variant=\"outlined\"\r\n              margin=\"none\"\r\n              size=\"small\"\r\n              inputProps={{ style: { padding: 5, width: 50 } }}\r\n              defaultValue={tool.xy[0][1]}\r\n              onChange={(e) => {\r\n                const val = parseFloat(e.target.value);\r\n                if (isNaN(val)) return;\r\n                const action: ReducerActionType<\"setHlineYlevel\"> = {\r\n                  task: \"setHlineYlevel\",\r\n                  params: { val, subchartIdx, yaxisIdx: 0, toolIdx },\r\n                };\r\n                (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setHlineYlevel\">>)(action);\r\n              }}\r\n            />\r\n          }\r\n        />\r\n      ) : null}\r\n      <CTreeItem\r\n        key={`tool-${subchartIdx}-${toolIdx}-stroke`}\r\n        nodeId={`tool-${subchartIdx}-${toolIdx}-stroke`}\r\n        labelText={\"stroke color\"}\r\n        labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n        labelInfo={\r\n          <Colorpicker\r\n            color={tool.style.strokeColor}\r\n            onColorSelected={(color) => {\r\n              const action: ReducerActionType<\"setToolStrokeColor\"> = {\r\n                task: \"setToolStrokeColor\",\r\n                params: { color: color, subchartIdx, yaxisIdx: 0, toolIdx },\r\n              };\r\n              (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setToolStrokeColor\">>)(action);\r\n            }}\r\n          />\r\n        }\r\n      />\r\n      <CTreeItem\r\n        key={`tool-${subchartIdx}-${toolIdx}-anchorColor`}\r\n        nodeId={`tool-${subchartIdx}-${toolIdx}-anchorColor`}\r\n        labelText={\"anchor color\"}\r\n        labelIcon={<Icon path={mdiBullseye} size={1} color=\"#333\" />}\r\n        labelInfo={\r\n          <Colorpicker\r\n            color={tool.style.anchorColor}\r\n            onColorSelected={(color) => {\r\n              const action: ReducerActionType<\"setToolAnchorColor\"> = {\r\n                task: \"setToolAnchorColor\",\r\n                params: { color: color, subchartIdx, yaxisIdx: 0, toolIdx },\r\n              };\r\n              (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setToolAnchorColor\">>)(action);\r\n            }}\r\n          />\r\n        }\r\n      />\r\n    </CTreeItem>\r\n  );\r\n};\r\n\r\nexport type ToolCategoryType = \"Lines\" | \"Upcoming\";\r\n\r\nexport const ChartMenuTools = (props: {\r\n  ChartState: CalculatedChartStateType;\r\n  onNavigate: (target: CChartMenuOpenType) => void;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n  open: CChartMenuOpenType;\r\n}) => {\r\n  const { ChartState, onNavigate, ChartStateDispatch, open } = props;\r\n  const theme = useTheme();\r\n  const [FilterCat, setFilterCat] = React.useState(true);\r\n\r\n  const categorys: { name: ToolCategoryType; icon: string }[] = [\r\n    { name: \"Lines\", icon: mdiRuler },\r\n    { name: \"Upcoming\", icon: mdiRulerSquareCompass },\r\n  ];\r\n  const tools: {\r\n    name: string;\r\n    type: NonNullable<CalculatedChartStateType[\"draw\"][\"type\"]>;\r\n    category: ToolCategoryType;\r\n  }[] = [\r\n    { name: \"trendline\", type: \"trendline\", category: \"Lines\" },\r\n    { name: \"horizontal\", type: \"hline\", category: \"Lines\" },\r\n    { name: \"vertical\", type: \"vline\", category: \"Lines\" },\r\n  ];\r\n\r\n  const amtTools = ChartState.subCharts\r\n    .map((subchart) => subchart.yaxis.map((yaxis) => yaxis.tools.length))\r\n    .flat()\r\n    .reduce((acc, cur) => acc + cur);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          right: 24, //see padding title bar\r\n          zIndex: 2,\r\n\r\n          // padding\r\n        }}\r\n      >\r\n        {amtTools > 0 ? (\r\n          <div style={{ paddingBottom: 5 }}>\r\n            <ToggleButtonGroup value={\"web\"} exclusive style={{ borderRadius: 500 }} size=\"small\">\r\n              <ToggleButton\r\n                style={{\r\n                  borderBottomLeftRadius: 50,\r\n                  textTransform: \"none\",\r\n                  borderTopLeftRadius: 50,\r\n                  background: open === \"tools\" ? theme.palette.secondary.light : \"#fff\",\r\n                }}\r\n                onClick={() => {\r\n                  onNavigate?.(\"tools\");\r\n                }}\r\n              >\r\n                <Typography> Add</Typography>\r\n              </ToggleButton>\r\n              <ToggleButton\r\n                value=\"android\"\r\n                style={{\r\n                  borderBottomRightRadius: 50,\r\n                  borderTopRightRadius: 50,\r\n                  background: open === \"editTool\" ? theme.palette.secondary.light : \"#fff\",\r\n                }}\r\n                onClick={() => {\r\n                  onNavigate?.(\"editTool\");\r\n                }}\r\n              >\r\n                Edit\r\n              </ToggleButton>\r\n            </ToggleButtonGroup>\r\n          </div>\r\n        ) : null}\r\n\r\n        <div\r\n          style={{ background: theme.palette.secondary.light, border: \"1px solid #666\", borderRadius: 50, padding: 5 }}\r\n        >\r\n          <IconButton\r\n            size=\"small\"\r\n            style={{ border: \"1px solid #fff\", margin: \"0px 5px\" }}\r\n            onClick={() => alert(\"upcoming\")}\r\n          >\r\n            <Icon path={mdiMagnify} size={1} color={theme.palette.primary.contrastText} />\r\n          </IconButton>\r\n          <IconButton\r\n            size=\"small\"\r\n            style={{ border: \"1px solid #fff\", margin: \"0px 5px 0px 0px\" }}\r\n            onClick={() => setFilterCat((current) => !current)}\r\n          >\r\n            <Icon\r\n              path={FilterCat ? mdiSortAlphabeticalAscending : mdiFilter}\r\n              size={1}\r\n              color={theme.palette.primary.contrastText}\r\n            />\r\n          </IconButton>\r\n        </div>\r\n      </div>\r\n      <TreeView\r\n        //   className={classes.root}\r\n        //   defaultExpanded={[\"3\"]}\r\n        defaultCollapseIcon={<Icon path={mdiMenuDown} size={1} color=\"#333\" />}\r\n        defaultExpandIcon={<Icon path={mdiMenuRight} size={1} color=\"#333\" />}\r\n        defaultEndIcon={<div style={{ width: 24 }} />}\r\n        //   selected=\"1\"\r\n        //   onNodeSelect={() => {}}\r\n        disableSelection\r\n        // style={{height: 100, overflowY: \"scroll\"}}\r\n      >\r\n        {open === \"editTool\"\r\n          ? ChartState.subCharts.map((subchart, subchartIdx) =>\r\n              subchart.yaxis.map((yaxis, yaxisIdx) =>\r\n                yaxis.tools.map((tool, toolIdx) => (\r\n                  <CToolTreeItem\r\n                    key={`editIndicator-sub-${subchartIdx}-yaxis-${yaxisIdx}-graph-${toolIdx}`}\r\n                    ChartState={ChartState}\r\n                    ChartStateDispatch={ChartStateDispatch}\r\n                    subchartIdx={subchartIdx}\r\n                    yaxisIdx={yaxisIdx}\r\n                    toolIdx={toolIdx}\r\n                  />\r\n                ))\r\n              )\r\n            )\r\n          : !!FilterCat\r\n          ? categorys.map((cat, catIdx) => (\r\n              <CTreeItem\r\n                key={`cat-${catIdx}`}\r\n                nodeId={catIdx.toString()}\r\n                labelText={cat.name}\r\n                labelIcon={\r\n                  <div\r\n                    style={{\r\n                      border: \"1px solid #666\",\r\n                      borderRadius: 5,\r\n                      marginRight: 10,\r\n                      background: theme.palette.secondary.main,\r\n                      minWidth: 48,\r\n                      height: 48,\r\n                    }}\r\n                  >\r\n                    <Icon path={cat.icon} size={2} color={theme.palette.secondary.contrastText} />\r\n                  </div>\r\n                }\r\n                bgColor={theme.palette.primary.light}\r\n              >\r\n                {tools\r\n                  .filter((tool) => tool.category === cat.name)\r\n                  .sort((a, b) => (a.name > b.name ? 1 : -1))\r\n                  .map((tool, toolIdx) => (\r\n                    <CTreeItem\r\n                      key={`cat-${catIdx}-tool-${toolIdx}`}\r\n                      nodeId={((catIdx + 1) * 100 + (toolIdx + 1)).toString()}\r\n                      labelText={tool.name}\r\n                      //   labelIcon={<Icon path={mdiFileChartOutline} size={1} color=\"#333\" />}\r\n                      bgColor={theme.palette.primary.light}\r\n                      onLabelClick={() => {\r\n                        onToolLabelClick(ChartStateDispatch, tool.type);\r\n                        onNavigate?.(null);\r\n                      }}\r\n                    />\r\n                  ))}\r\n              </CTreeItem>\r\n            ))\r\n          : tools\r\n              .sort((a, b) => (a.name > b.name ? 1 : -1))\r\n              .map((tool, toolIdx) => (\r\n                <CTreeItem\r\n                  key={`cat-tool-${toolIdx}`}\r\n                  nodeId={(toolIdx + 1).toString()}\r\n                  labelText={tool.name}\r\n                  //   labelIcon={<Icon path={mdiFileChartOutline} size={1} color=\"#333\" />}\r\n                  bgColor={theme.palette.primary.light}\r\n                  onLabelClick={() => {\r\n                    onToolLabelClick(ChartStateDispatch, tool.type);\r\n                    onNavigate?.(null);\r\n                  }}\r\n                />\r\n              ))}\r\n      </TreeView>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Icon } from \"@mdi/react\";\r\nimport { ToggleButton, ToggleButtonGroup, TreeView } from \"@material-ui/lab\";\r\nimport {\r\n  mdiMenuDown,\r\n  mdiMenuRight,\r\n  mdiDiameterVariant,\r\n  mdiChartBellCurve,\r\n  mdiArrowExpandVertical,\r\n  mdiPoll,\r\n  mdiHome,\r\n  mdiFilter,\r\n  mdiMagnify,\r\n  mdiAlphabetical,\r\n  mdiSortAlphabeticalAscending,\r\n  mdiRuler,\r\n  mdiRulerSquareCompass,\r\n  mdiFileChartOutline,\r\n  mdiWater,\r\n  mdiArrowSplitHorizontal,\r\n  mdiBorderColor,\r\n  mdiBullseye,\r\n  mdiChartAreaspline,\r\n  mdiChartLine,\r\n  mdiClose,\r\n  mdiFormatText,\r\n  mdiGrid,\r\n  mdiHelp,\r\n  mdiIframeVariableOutline,\r\n  mdiMinus,\r\n  mdiPencilRuler,\r\n} from \"@mdi/js\";\r\nimport React from \"react\";\r\n\r\nimport {\r\n  CalculatedChartStateType,\r\n  ChartStateHookType,\r\n  isChartGraph,\r\n  isIndicatorGraph,\r\n} from \"../Types/CChartStateTypes\";\r\nimport { ChartDataSeries } from \"../Types/CChartTypes\";\r\nimport { Button, Checkbox, Grid, IconButton, Menu, MenuItem, TextField, Typography, useTheme } from \"@material-ui/core\";\r\nimport { CTreeItem } from \"../CTreeItem\";\r\nimport { ReducerActionType } from \"../ChartState/CChartStateReducer\";\r\nimport { Colorpicker } from \"../Colorpicker\";\r\nimport { CChartMenuOpenType } from \"./ChartMenu\";\r\nimport { CIndicatorGraphTreeItem } from \"./ChartMenuIndicators\";\r\nimport { CToolTreeItem } from \"./ChartMenuTools\";\r\n\r\nconst onToolLabelClick = (\r\n  ChartStateDispatch: ChartStateHookType[1],\r\n  type: NonNullable<CalculatedChartStateType[\"draw\"][\"type\"]>\r\n) => {\r\n  const subchartIdx = 0;\r\n  const action: ReducerActionType<\"draw\"> = { task: \"draw\", params: { type, subchartIdx } };\r\n  return () => {\r\n    (ChartStateDispatch as React.Dispatch<ReducerActionType<\"draw\">>)(action);\r\n  };\r\n};\r\n\r\nexport type ToolCategoryType = \"Lines\" | \"Upcoming\";\r\n\r\nexport const ChartMenuSettings = (props: {\r\n  ChartState: CalculatedChartStateType;\r\n  onNavigate: (target: CChartMenuOpenType) => void;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n}) => {\r\n  const { ChartState, onNavigate, ChartStateDispatch } = props;\r\n  const theme = useTheme();\r\n  const [FilterCat, setFilterCat] = React.useState(false);\r\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\r\n\r\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleClose = (target?: CChartMenuOpenType) => {\r\n    setAnchorEl(null);\r\n    if (!!target) onNavigate?.(target);\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          right: 24, //see padding title bar\r\n          zIndex: 2,\r\n\r\n          // padding\r\n        }}\r\n      >\r\n        {/* <div\r\n          style={{\r\n            background: theme.palette.secondary.light,\r\n            border: \"1px solid #666\",\r\n            borderRadius: 50,\r\n            padding: 5,\r\n          }}\r\n        >\r\n          <IconButton\r\n            size=\"small\"\r\n            style={{ border: \"1px solid #fff\", margin: \"0px 5px\" }}\r\n            // onClick={() => onNavigate(\"menu\")}\r\n          >\r\n            <Icon path={mdiMagnify} size={1} color={theme.palette.primary.contrastText} />\r\n          </IconButton>\r\n          <IconButton\r\n            size=\"small\"\r\n            style={{ border: \"1px solid #fff\", margin: \"0px 5px 0px 0px\" }}\r\n            onClick={() => setFilterCat((current) => !current)}\r\n          >\r\n            <Icon\r\n              path={FilterCat ? mdiSortAlphabeticalAscending : mdiFilter}\r\n              size={1}\r\n              color={theme.palette.primary.contrastText}\r\n            />\r\n          </IconButton>\r\n        </div> */}\r\n        <div style={{ paddingBottom: 5 }}>\r\n          <Button\r\n            // value=\"web\"\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 50,\r\n              padding: 5,\r\n              // marginTop: 5,\r\n              textTransform: \"none\",\r\n              background: theme.palette.secondary.light,\r\n              width: \"100%\",\r\n              color: theme.palette.secondary.contrastText,\r\n            }}\r\n            onClick={handleClick}\r\n          >\r\n            <Typography> Add...</Typography>\r\n          </Button>\r\n          <Menu\r\n            id=\"quick-add\"\r\n            anchorEl={anchorEl}\r\n            keepMounted\r\n            open={Boolean(anchorEl)}\r\n            onClose={() => handleClose(undefined)}\r\n            anchorOrigin={{\r\n              vertical: \"top\",\r\n              horizontal: \"center\",\r\n            }}\r\n            transformOrigin={{\r\n              vertical: \"bottom\",\r\n              horizontal: \"center\",\r\n            }}\r\n          >\r\n            <MenuItem onClick={() => handleClose(\"indicators\")}>Indicator</MenuItem>\r\n            <MenuItem onClick={() => handleClose(\"tools\")}>Tool</MenuItem>\r\n            {/* <MenuItem onClick={handleClose}></MenuItem> */}\r\n          </Menu>\r\n        </div>\r\n      </div>\r\n\r\n      <TreeView\r\n        //   className={classes.root}\r\n        //   defaultExpanded={[\"3\"]}\r\n        defaultCollapseIcon={<Icon path={mdiMenuDown} size={1} color=\"#333\" />}\r\n        defaultExpandIcon={<Icon path={mdiMenuRight} size={1} color=\"#333\" />}\r\n        defaultEndIcon={<div style={{ width: 24 }} />}\r\n        //   selected=\"1\"\r\n        //   onNodeSelect={() => {}}\r\n        disableSelection\r\n        // style={{height: 100, overflowY: \"scroll\"}}\r\n      >\r\n        <CTreeItem\r\n          nodeId=\"1\"\r\n          labelText=\"General\"\r\n          labelIcon={\r\n            <div\r\n              style={{\r\n                background: theme.palette.secondary.main,\r\n                width: 48,\r\n                height: 48,\r\n                border: \"1px solid #666\",\r\n                borderRadius: 5,\r\n                marginRight: 10,\r\n              }}\r\n            >\r\n              <Icon path={mdiFileChartOutline} size={2} color={theme.palette.secondary.contrastText} />\r\n            </div>\r\n          }\r\n          bgColor={theme.palette.primary.light}\r\n          labelTypographyVariant=\"h6\"\r\n        >\r\n          <CTreeItem\r\n            nodeId=\"11\"\r\n            labelText=\"background color\"\r\n            labelIcon={<Icon path={mdiWater} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Colorpicker\r\n                color={ChartState.backgroundColor}\r\n                onColorSelected={(color) => {\r\n                  // const action: ReducerActionType<\"setBackgroundColor\"> = {\r\n                  //   task: \"setBackgroundColor\",\r\n                  //   params: { color: color },\r\n                  // };\r\n                  ChartStateDispatch({\r\n                    task: \"setBackgroundColor\",\r\n                    params: { color },\r\n                  } as ReducerActionType<\"setBackgroundColor\">);\r\n                }}\r\n              />\r\n            }\r\n            //   color=\"#fff\"\r\n            bgColor=\"#eee\"\r\n          />\r\n          <CTreeItem\r\n            nodeId=\"12\"\r\n            labelText=\"axis fill color\"\r\n            labelIcon={<Icon path={mdiWater} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Colorpicker\r\n                color={ChartState.xaxis.style.fillColor}\r\n                onColorSelected={(color) => {\r\n                  const action: ReducerActionType<\"setAxisFillColor\"> = {\r\n                    task: \"setAxisFillColor\",\r\n                    params: { color: color },\r\n                  };\r\n                  (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setAxisFillColor\">>)(action);\r\n                }}\r\n              />\r\n            }\r\n            //   color=\"#e3742f\"\r\n            bgColor=\"#eee\"\r\n          />\r\n          <CTreeItem\r\n            nodeId=\"13\"\r\n            labelText=\"axis stroke color\"\r\n            labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Colorpicker\r\n                color={ChartState.xaxis.style.strokeColor}\r\n                onColorSelected={(color) => {\r\n                  const action: ReducerActionType<\"setAxisStrokeColor\"> = {\r\n                    task: \"setAxisStrokeColor\",\r\n                    params: { color: color },\r\n                  };\r\n                  (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setAxisStrokeColor\">>)(action);\r\n                }}\r\n              />\r\n            }\r\n            //   color=\"#a250f5\"\r\n            bgColor=\"#eee\"\r\n          />\r\n          <CTreeItem\r\n            nodeId=\"14\"\r\n            labelText=\"axis text color\"\r\n            labelIcon={<Icon path={mdiFormatText} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Colorpicker\r\n                color={ChartState.xaxis.style.fontColor}\r\n                onColorSelected={(color) => {\r\n                  const action: ReducerActionType<\"setAxisTextColor\"> = {\r\n                    task: \"setAxisTextColor\",\r\n                    params: { color: color },\r\n                  };\r\n                  (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setAxisTextColor\">>)(action);\r\n                }}\r\n              />\r\n            }\r\n            color=\"#3c8039\"\r\n            bgColor=\"#eee\"\r\n          />\r\n          <CTreeItem\r\n            nodeId=\"15\"\r\n            labelText=\"use x-axis grid\"\r\n            labelIcon={<Icon path={mdiGrid} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Checkbox\r\n                checked={ChartState.grid.useGridX}\r\n                size=\"small\"\r\n                style={{ padding: 0, width: 24, height: 24 }}\r\n                onChange={() => {\r\n                  const action: ReducerActionType<\"toggleXaxisGrid\"> = {\r\n                    task: \"toggleXaxisGrid\",\r\n                    params: {},\r\n                  };\r\n                  (ChartStateDispatch as React.Dispatch<ReducerActionType<\"toggleXaxisGrid\">>)(action);\r\n                }}\r\n              />\r\n            }\r\n            color=\"#3c8039\"\r\n            bgColor=\"#eee\"\r\n          />\r\n          <CTreeItem\r\n            nodeId=\"16\"\r\n            labelText=\"use y-axis grid\"\r\n            labelIcon={<Icon path={mdiGrid} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Checkbox\r\n                checked={ChartState.grid.useGridY}\r\n                size=\"small\"\r\n                style={{ padding: 0, width: 24, height: 24 }}\r\n                onChange={() => {\r\n                  const action: ReducerActionType<\"toggleYaxisGrid\"> = {\r\n                    task: \"toggleYaxisGrid\",\r\n                    params: {},\r\n                  };\r\n                  (ChartStateDispatch as React.Dispatch<ReducerActionType<\"toggleYaxisGrid\">>)(action);\r\n                }}\r\n              />\r\n            }\r\n            color=\"#3c8039\"\r\n            bgColor=\"#eee\"\r\n          />\r\n          <CTreeItem\r\n            nodeId=\"17\"\r\n            labelText=\"grid stroke color\"\r\n            labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n            labelInfo={\r\n              <Colorpicker\r\n                color={ChartState.grid.style.strokeColor}\r\n                onColorSelected={(color) => {\r\n                  const action: ReducerActionType<\"setGridStrokeColor\"> = {\r\n                    task: \"setGridStrokeColor\",\r\n                    params: { color: color },\r\n                  };\r\n                  (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setGridStrokeColor\">>)(action);\r\n                }}\r\n              />\r\n            }\r\n            color=\"#3c8039\"\r\n            bgColor=\"#eee\"\r\n          />\r\n        </CTreeItem>\r\n\r\n        {ChartState.subCharts.map((subchart, subchartIdx) => (\r\n          <CTreeItem\r\n            labelTypographyVariant=\"h6\"\r\n            key={`sub-${subchartIdx}`}\r\n            nodeId={`sub-${2 + subchartIdx}`}\r\n            labelText={subchartIdx === 0 ? \"Mainchart\" : `Subchart ${subchartIdx}`}\r\n            bgColor={theme.palette.primary.light}\r\n            labelIcon={\r\n              <div\r\n                style={{\r\n                  background: theme.palette.secondary.main,\r\n                  width: 48,\r\n                  height: 48,\r\n                  border: \"1px solid #666\",\r\n                  borderRadius: 5,\r\n                  marginRight: 10,\r\n                }}\r\n              >\r\n                <Icon path={mdiChartAreaspline} size={2} color={theme.palette.secondary.contrastText} />\r\n              </div>\r\n            }\r\n            labelInfo={\r\n              subchartIdx !== 0 ? (\r\n                <IconButton\r\n                  size=\"small\"\r\n                  onClick={(e) => {\r\n                    e.preventDefault();\r\n                    const action: ReducerActionType<\"removeSubchart\"> = {\r\n                      task: \"removeSubchart\",\r\n                      params: { subchartIdx },\r\n                    };\r\n                    (ChartStateDispatch as React.Dispatch<ReducerActionType<\"removeSubchart\">>)(action);\r\n                  }}\r\n                >\r\n                  <Icon path={mdiClose} size={1} color=\"#333\" />\r\n                </IconButton>\r\n              ) : undefined\r\n            }\r\n          >\r\n            {subchart.yaxis[0].graphs.map((graph, graphIdx) =>\r\n              isIndicatorGraph(graph) ? (\r\n                <CIndicatorGraphTreeItem\r\n                  key={`editIndicator-sub-${subchartIdx}-yaxis-${0}-graph-${graphIdx}`}\r\n                  ChartState={ChartState}\r\n                  ChartStateDispatch={ChartStateDispatch}\r\n                  subchartIdx={subchartIdx}\r\n                  yaxisIdx={0}\r\n                  graphIdx={graphIdx}\r\n                />\r\n              ) : isChartGraph(graph) ? (\r\n                <React.Fragment>\r\n                  <CTreeItem\r\n                    key={`graph-sub-${subchartIdx}-yaxis-${0}-graph-${graphIdx}`}\r\n                    nodeId={`graph-sub-${subchartIdx}-yaxis-${0}-graph-${graphIdx}`}\r\n                    labelText={graph.name}\r\n                    bgColor=\"#eee\"\r\n                    labelIcon={\r\n                      <div\r\n                        style={{\r\n                          background: theme.palette.primary.main,\r\n                          width: 32,\r\n                          height: 32,\r\n                          border: \"1px solid #666\",\r\n                          borderRadius: 5,\r\n                          marginRight: 10,\r\n                        }}\r\n                      >\r\n                        <Icon path={mdiChartLine} size={\"32px\"} color={theme.palette.secondary.contrastText} />\r\n                      </div>\r\n                    }\r\n                    labelInfo={\r\n                      subchartIdx !== 0 || graphIdx !== 0 ? (\r\n                        <IconButton\r\n                          size=\"small\"\r\n                          onClick={(e) => {\r\n                            e.preventDefault();\r\n                            const action: ReducerActionType<\"removeGraph\"> = {\r\n                              task: \"removeGraph\",\r\n                              params: { subchartIdx, yaxisIdx: 0, graphIdx },\r\n                            };\r\n                            (ChartStateDispatch as React.Dispatch<ReducerActionType<\"removeGraph\">>)(action);\r\n                          }}\r\n                        >\r\n                          <Icon path={mdiClose} size={1} color=\"#333\" />\r\n                        </IconButton>\r\n                      ) : undefined\r\n                    }\r\n                  >\r\n                    {graph.meta.type === \"linechart\" ? (\r\n                      <CTreeItem\r\n                        nodeId={`${2 + subchartIdx}00-${graphIdx}`}\r\n                        labelText=\"line stroke color\"\r\n                        labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n                        labelInfo={\r\n                          <Colorpicker\r\n                            color={ChartState.subCharts[subchartIdx].yaxis[0].graphs[graphIdx].style?.strokeColor?.[0]}\r\n                            onColorSelected={(color) => {\r\n                              const action: ReducerActionType<\"setLineChartStrokeColor\"> = {\r\n                                task: \"setLineChartStrokeColor\",\r\n                                params: { color: color, subchartIdx, yaxisIdx: 0, graphIdx },\r\n                              };\r\n                              (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setLineChartStrokeColor\">>)(\r\n                                action\r\n                              );\r\n                            }}\r\n                          />\r\n                        }\r\n                      />\r\n                    ) : graph.meta.type === \"candlechart\" ? (\r\n                      <React.Fragment>\r\n                        <CTreeItem\r\n                          nodeId={`${2 + subchartIdx}00-${graphIdx}`}\r\n                          labelText=\"candle up color\"\r\n                          labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n                          labelInfo={\r\n                            <Colorpicker\r\n                              color={graph.style.candleUpColor}\r\n                              onColorSelected={(color) => {\r\n                                const action: ReducerActionType<\"setCandleChartUpColor\"> = {\r\n                                  task: \"setCandleChartUpColor\",\r\n                                  params: { color: color, subchartIdx, yaxisIdx: 0, graphIdx },\r\n                                };\r\n                                (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setCandleChartUpColor\">>)(\r\n                                  action\r\n                                );\r\n                              }}\r\n                            />\r\n                          }\r\n                        />\r\n                        <CTreeItem\r\n                          nodeId={`${2 + subchartIdx}00-${graphIdx}`}\r\n                          labelText=\"candle down color\"\r\n                          labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n                          labelInfo={\r\n                            <Colorpicker\r\n                              color={graph.style.candleDownColor}\r\n                              onColorSelected={(color) => {\r\n                                const action: ReducerActionType<\"setCandleChartDownColor\"> = {\r\n                                  task: \"setCandleChartDownColor\",\r\n                                  params: { color: color, subchartIdx, yaxisIdx: 0, graphIdx },\r\n                                };\r\n                                (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setCandleChartDownColor\">>)(\r\n                                  action\r\n                                );\r\n                              }}\r\n                            />\r\n                          }\r\n                        />\r\n                        <CTreeItem\r\n                          nodeId={`${2 + subchartIdx}00-${graphIdx}`}\r\n                          labelText=\"candle stroke color\"\r\n                          labelIcon={<Icon path={mdiBorderColor} size={1} color=\"#333\" />}\r\n                          labelInfo={\r\n                            <Colorpicker\r\n                              color={graph.style.candleStrokeColor}\r\n                              onColorSelected={(color) => {\r\n                                const action: ReducerActionType<\"setCandleChartStrokeColor\"> = {\r\n                                  task: \"setCandleChartStrokeColor\",\r\n                                  params: { color: color, subchartIdx, yaxisIdx: 0, graphIdx },\r\n                                };\r\n                                (ChartStateDispatch as React.Dispatch<ReducerActionType<\"setCandleChartStrokeColor\">>)(\r\n                                  action\r\n                                );\r\n                              }}\r\n                            />\r\n                          }\r\n                        />\r\n                      </React.Fragment>\r\n                    ) : null}\r\n                  </CTreeItem>\r\n                </React.Fragment>\r\n              ) : null\r\n            )}\r\n\r\n            {subchart.yaxis[0].tools.length > 0 ? (\r\n              <CTreeItem\r\n                key={`tools-${subchartIdx}-y0`}\r\n                nodeId={`tools-${subchartIdx}-y0`}\r\n                labelIcon={\r\n                  <div\r\n                    style={{\r\n                      background: theme.palette.primary.main,\r\n                      width: 32,\r\n                      height: 32,\r\n                      border: \"1px solid #666\",\r\n                      borderRadius: 5,\r\n                      marginRight: 10,\r\n                    }}\r\n                  >\r\n                    <Icon path={mdiPencilRuler} size={\"32px\"} color={theme.palette.secondary.contrastText} />\r\n                  </div>\r\n                }\r\n                labelText=\"Tools\"\r\n                bgColor=\"#eee\"\r\n              >\r\n                {subchart.yaxis[0].tools.map((tool, toolIdx) => (\r\n                  <CToolTreeItem\r\n                    key={`editIndicator-sub-${subchartIdx}-yaxis-${0}-tool-${toolIdx}`}\r\n                    ChartState={ChartState}\r\n                    ChartStateDispatch={ChartStateDispatch}\r\n                    subchartIdx={subchartIdx}\r\n                    yaxisIdx={0}\r\n                    toolIdx={toolIdx}\r\n                  />\r\n                ))}\r\n              </CTreeItem>\r\n            ) : null}\r\n          </CTreeItem>\r\n        ))}\r\n      </TreeView>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import {\r\n  Button,\r\n  Grid,\r\n  ListItem,\r\n  List,\r\n  Paper,\r\n  Typography,\r\n  useMediaQuery,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  useTheme,\r\n} from \"@material-ui/core\";\r\nimport { mdiChartLine, mdiChartBellCurve, mdiPencilRuler, mdiTune, mdiStarShooting, mdiBroom } from \"@mdi/js\";\r\nimport Icon, { Stack } from \"@mdi/react\";\r\nimport React from \"react\";\r\nimport { CalculatedChartStateType, ChartStateHookType, TypedDispatcher } from \"../Types/CChartStateTypes\";\r\nimport { CChartMenuOpenType } from \"./ChartMenu\";\r\n\r\nexport const ChartMenuQuickys = (props: {\r\n  ChartState: CalculatedChartStateType;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n  onNavigate: (target: CChartMenuOpenType) => void;\r\n}) => {\r\n  const { ChartState, onNavigate, ChartStateDispatch } = props;\r\n\r\n  const isMinSm = useMediaQuery(\"(min-width:600px)\");\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {/* <Grid container>\r\n        <Grid item> */}\r\n      <List>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            ChartStateDispatch({\r\n              task: \"clearChart\",\r\n              params: { mode: \"indicators\" },\r\n            }) as unknown as TypedDispatcher<\"clearChart\">;\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n              position: \"relative\",\r\n              top: 0,\r\n            }}\r\n          >\r\n            <Icon\r\n              path={mdiBroom}\r\n              size={2}\r\n              color={theme.palette.secondary.contrastText}\r\n              style={{ position: \"absolute\", top: 0, left: 0 }}\r\n              rotate={5}\r\n            />\r\n            <Icon\r\n              path={mdiChartBellCurve}\r\n              size={0.8}\r\n              color={\"#fff\"}\r\n              style={{ position: \"absolute\", bottom: 0, right: 0 }}\r\n            />\r\n          </ListItemIcon>\r\n          <ListItemText\r\n            primary=\"Clear All Indicators\"\r\n            primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }}\r\n          />\r\n        </ListItem>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            ChartStateDispatch({\r\n              task: \"clearChart\",\r\n              params: { mode: \"tools\" },\r\n            }) as unknown as TypedDispatcher<\"clearChart\">;\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n              position: \"relative\",\r\n              top: 0,\r\n            }}\r\n          >\r\n            <Icon\r\n              path={mdiBroom}\r\n              size={2}\r\n              color={theme.palette.secondary.contrastText}\r\n              style={{ position: \"absolute\", top: 0, left: 0 }}\r\n              rotate={5}\r\n            />\r\n            <Icon\r\n              path={mdiPencilRuler}\r\n              size={0.7}\r\n              color={\"#fff\"}\r\n              style={{ position: \"absolute\", bottom: 1, right: 1 }}\r\n            />\r\n          </ListItemIcon>\r\n          <ListItemText primary=\"Clear All Tools\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n        </ListItem>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            // onNavigate?.(\"settings\");\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              width: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiTune} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText\r\n            primary=\"Autoscale Y axis (mode to disable upcoming)\"\r\n            primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }}\r\n          />\r\n        </ListItem>\r\n      </List>\r\n      {/* </Grid>\r\n      </Grid> */}\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport MuiAlert, { AlertProps } from \"@material-ui/lab/Alert\";\r\nimport { makeStyles, Theme } from \"@material-ui/core/styles\";\r\n\r\nfunction Alert(props: AlertProps) {\r\n  return <MuiAlert elevation={6} variant=\"filled\" {...props} />;\r\n}\r\n\r\n// const useStyles = makeStyles((theme: Theme) => ({\r\n//   root: {\r\n//     width: \"100%\",\r\n//     \"& > * + *\": {\r\n//       marginTop: theme.spacing(2),\r\n//     },\r\n//   },\r\n// }));\r\n\r\nexport const CSnackBar = (props: { open: boolean; onClose: () => void; content: React.ReactNode }) => {\r\n  const { open, onClose, content } = props;\r\n  //   const classes = useStyles();\r\n\r\n  //   const [open, setOpen] = React.useState(false);\r\n\r\n  //   const handleClick = () => {\r\n  //     setOpen(true);\r\n  //   };\r\n\r\n  const handleClose = (event?: React.SyntheticEvent, reason?: string) => {\r\n    if (reason === \"clickaway\") return;\r\n\r\n    onClose?.();\r\n  };\r\n\r\n  return (\r\n    <Snackbar\r\n      open={open}\r\n      autoHideDuration={6000}\r\n      onClose={handleClose}\r\n      anchorOrigin={{ vertical: \"bottom\", horizontal: \"center\" }}\r\n    >\r\n      <Alert onClose={handleClose} severity=\"error\">\r\n        {content}\r\n      </Alert>\r\n    </Snackbar>\r\n  );\r\n};\r\n","import {\r\n  List,\r\n  ListItem,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  makeStyles,\r\n  TextField,\r\n  Tooltip,\r\n  IconButton,\r\n  useTheme,\r\n} from \"@material-ui/core\";\r\nimport {\r\n  mdiChartLine,\r\n  mdiChartBellCurve,\r\n  mdiWeb,\r\n  mdiFileDelimitedOutline,\r\n  mdiArrowRightThick,\r\n  mdiClose,\r\n} from \"@mdi/js\";\r\nimport { Icon } from \"@mdi/react\";\r\nimport React from \"react\";\r\nimport { CSnackBar } from \"../CSnackbar\";\r\nimport { getDateString } from \"../Time/CChartDateTime\";\r\nimport { CalculatedChartStateType, ChartStateHookType } from \"../Types/CChartStateTypes\";\r\nconst parse = require(\"csv-parse/lib/sync\");\r\n\r\nconst useStyles = makeStyles({\r\n  popper: {\r\n    zIndex: 1800,\r\n  },\r\n  tooltip: {\r\n    background: \"rgba(205, 205, 205, 0.95)\",\r\n    //   filter: \"blur(1px)\",\r\n  },\r\n});\r\n\r\nexport async function parseCsvFileObj(data: File) {\r\n  const res: any = await data.text().then((dataString) => {\r\n    // console.log(dataString);\r\n    const rowDelimiter = [\r\n      { chars: \"\\n\", amt: dataString.match(/\\n/gm)?.length ?? 0 },\r\n      { chars: \"\\r\", amt: dataString.match(/\\r/gm)?.length ?? 0 },\r\n      { chars: \"\\r\\n\", amt: dataString.match(/\\r\\n/gm)?.length ?? 0 },\r\n    ];\r\n    const rowDelimiterAmts = rowDelimiter.map((val) => val.amt);\r\n    const maxAmtRowDelimiterIdx = rowDelimiterAmts.indexOf(Math.max(...rowDelimiterAmts));\r\n    const guessedRowDelimiter = rowDelimiter[maxAmtRowDelimiterIdx].chars;\r\n    const rows = dataString.split(guessedRowDelimiter);\r\n\r\n    // only first line is checked for delimiter\r\n    const delimiter = [\r\n      { chars: \",\", amt: rows[0].match(/,/gm)?.length ?? 0 },\r\n      { chars: \";\", amt: rows[0].match(/;/gm)?.length ?? 0 },\r\n    ];\r\n    const delimiterAmts = delimiter.map((del) => del.amt);\r\n    const maxAmtDelimiterIdx = delimiterAmts.indexOf(Math.max(...delimiterAmts));\r\n    const guessedDelimiter = delimiter[maxAmtDelimiterIdx].chars;\r\n\r\n    // last delimiter is likely decimal delimiter\r\n    let amtDecDel = { dots: 0, commas: 0 };\r\n    rows.forEach((row) => {\r\n      row.split(guessedDelimiter).forEach((val) => {\r\n        const lastDot = val.lastIndexOf(\".\");\r\n        const lastComma = val.lastIndexOf(\",\");\r\n        if (lastDot !== -1 && lastComma !== -1) {\r\n          if (lastDot > lastComma) amtDecDel.dots++;\r\n          else amtDecDel.commas++;\r\n        } else if (lastDot !== -1 && lastComma === -1) amtDecDel.dots++;\r\n        else if (lastDot === -1 && lastComma !== -1) amtDecDel.commas++;\r\n      });\r\n    });\r\n    const isCommaDecDel = amtDecDel.dots < amtDecDel.commas;\r\n    const isCommaDigitSeparator = amtDecDel.dots > amtDecDel.commas && amtDecDel.commas > 0;\r\n\r\n    const newDataString = isCommaDecDel\r\n      ? dataString.replaceAll(\".\", \"\").replaceAll(\",\", \".\")\r\n      : isCommaDigitSeparator\r\n      ? dataString.replaceAll(\",\", \"\")\r\n      : dataString;\r\n\r\n    // console.log(isCommaDecDel, isCommaDigitSeparator);\r\n    // const parseNumbers = (val: string) => {\r\n    //   if (typeof val !== \"string\") return val;\r\n    //   if (isCommaDecDel) return parseFloat(val.replace(\".\", \"\").replace(\",\", \".\"));\r\n    //   else if (isCommaDigitSeparator) return parseFloat(val.replace(\",\", \"\"));\r\n    //   return parseFloat(val);\r\n    // };\r\n\r\n    let parseRes = parse(newDataString, {\r\n      delimiter: guessedDelimiter,\r\n      record_delimiter: guessedRowDelimiter,\r\n      cast: true,\r\n      trim: true,\r\n      cast_date: true,\r\n    }).map((dataset: any[]) => ({\r\n      date: dataset[0],\r\n      open: dataset[1],\r\n      high: dataset[2],\r\n      low: dataset[3],\r\n      close: dataset[4],\r\n      volume: dataset[5],\r\n    }));\r\n    parseRes.shift();\r\n    return parseRes;\r\n  });\r\n  return res;\r\n}\r\n\r\nexport const ChartMenuChart = (props: {\r\n  ChartState: CalculatedChartStateType;\r\n  //   onNavigate: (target: CChartMenuOpenType) => void;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n}) => {\r\n  const { ChartState, ChartStateDispatch } = props;\r\n  const classes = useStyles();\r\n  const [IsError, setIsError] = React.useState<string | null>(null);\r\n\r\n  const theme = useTheme();\r\n  const HiddenInputRef: React.RefObject<HTMLInputElement> = React.useRef(null);\r\n  const [ShowUrlPopup, setShowUrlPopup] = React.useState(false);\r\n  const [CsvUrl, setCsvUrl] = React.useState(\"\");\r\n\r\n  async function handleInputFileChange(evt: React.ChangeEvent<HTMLInputElement>) {\r\n    const files = evt.target.files;\r\n    if (!files) return;\r\n    if (files.length > 0) {\r\n      try {\r\n        const res = await parseCsvFileObj(files[0]);\r\n        ChartState.methods.addSubchart(res, \"some chart\", undefined, true);\r\n      } catch (err) {\r\n        console.log(\"Error - could not parse provided local file\", err);\r\n        setIsError(\"Error - could not parse provided local file\");\r\n      }\r\n    }\r\n  }\r\n\r\n  // evt handler for KeyUp evt of Input/Textfield -> Callback onEnter\r\n  const HandleOnKeyUp = (e: React.KeyboardEvent<HTMLInputElement>): void => {\r\n    if (e.key === \"Enter\" && e.type === \"keyup\") {\r\n      fetchCsvFromURL();\r\n    }\r\n  };\r\n  async function fetchCsvFromURL() {\r\n    try {\r\n      const resp = await fetch(CsvUrl);\r\n      if (!resp) throw Error(\"cant download file from url\");\r\n      let file = resp as unknown as File;\r\n      const res = await parseCsvFileObj(file);\r\n      ChartState.methods.addSubchart(res, \"some chart\", undefined, true);\r\n    } catch (err) {\r\n      console.log(\"Error - could not download file from URL or File could not be parsed\", err);\r\n      setIsError(\"Error - could not download file from URL or File could not be parsed\");\r\n    }\r\n    // const data = fetch(CsvUrl).then((response) => {\r\n    //   return await parseCsvFileObj(response);\r\n    // });\r\n\r\n    setShowUrlPopup(false);\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <CSnackBar open={!!IsError} onClose={() => setIsError(null)} content={IsError ? IsError : \"\"}></CSnackBar>\r\n      <input\r\n        type=\"file\"\r\n        style={{ visibility: \"hidden\", position: \"absolute\", top: 0, height: 0, width: 0 }}\r\n        ref={HiddenInputRef}\r\n        onChange={handleInputFileChange}\r\n      />\r\n      <List>\r\n        <ListItem\r\n          button\r\n          onClick={() => {\r\n            HiddenInputRef?.current?.click?.();\r\n          }}\r\n        >\r\n          <ListItemIcon\r\n            style={{\r\n              border: \"1px solid #666\",\r\n              borderRadius: 5,\r\n              marginRight: 10,\r\n              background: theme.palette.secondary.main,\r\n              minWidth: 48,\r\n              height: 48,\r\n            }}\r\n          >\r\n            <Icon path={mdiFileDelimitedOutline} size={2} color={theme.palette.secondary.contrastText} />\r\n          </ListItemIcon>\r\n          <ListItemText primary=\"CSV from device\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n        </ListItem>\r\n\r\n        <Tooltip\r\n          PopperProps={{ disablePortal: true }}\r\n          classes={{ popper: classes.popper, tooltip: classes.tooltip }}\r\n          style={{ zIndex: 1500 }}\r\n          open={ShowUrlPopup}\r\n          //   onClose={() => setShowUrlPopup(false)}\r\n          title={\r\n            <div>\r\n              <TextField\r\n                helperText=\"Enter/Paste URL\"\r\n                // style={{ width: 320 }}\r\n                fullWidth\r\n                onKeyUp={HandleOnKeyUp}\r\n                value={CsvUrl}\r\n                onChange={(e) => setCsvUrl(e.target.value)}\r\n                InputProps={{\r\n                  endAdornment: (\r\n                    <React.Fragment>\r\n                      <IconButton onClick={fetchCsvFromURL} size=\"small\">\r\n                        <Icon path={mdiArrowRightThick} size={1} />\r\n                      </IconButton>\r\n                      <IconButton onClick={() => setShowUrlPopup(false)}>\r\n                        <Icon path={mdiClose} size={1} />\r\n                      </IconButton>\r\n                    </React.Fragment>\r\n                  ),\r\n                }}\r\n              />\r\n            </div>\r\n          }\r\n          interactive\r\n          arrow\r\n          placement=\"bottom\"\r\n          //   open={true}\r\n          //   onClose={() => { }}\r\n        >\r\n          <ListItem\r\n            button\r\n            onClick={() => {\r\n              // onNavigate?.(\"indicators\");\r\n              // HiddenInputRef?.current?.click?.();\r\n              setShowUrlPopup(true);\r\n            }}\r\n          >\r\n            <ListItemIcon\r\n              style={{\r\n                border: \"1px solid #666\",\r\n                borderRadius: 5,\r\n                marginRight: 10,\r\n                background: theme.palette.secondary.main,\r\n                minWidth: 48,\r\n                height: 48,\r\n              }}\r\n            >\r\n              <Icon path={mdiWeb} size={2} color={theme.palette.secondary.contrastText} />\r\n            </ListItemIcon>\r\n            <ListItemText primary=\"CSV from URL\" primaryTypographyProps={{ variant: \"h6\", color: \"textSecondary\" }} />\r\n          </ListItem>\r\n        </Tooltip>\r\n      </List>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport {\r\n  createStyles,\r\n  Drawer,\r\n  Grid,\r\n  IconButton,\r\n  makeStyles,\r\n  Theme,\r\n  Typography,\r\n  useMediaQuery,\r\n  useTheme,\r\n} from \"@material-ui/core\";\r\nimport { mdiClose, mdiFullscreen, mdiHome } from \"@mdi/js\";\r\nimport Icon from \"@mdi/react\";\r\nimport { CalculatedChartStateType, ChartStateHookType } from \"../Types/CChartStateTypes\";\r\nimport { ChartMenuHome } from \"./ChartMenuHome\";\r\nimport { ChartMenuIndicators } from \"./ChartMenuIndicators\";\r\nimport { ChartMenuTools } from \"./ChartMenuTools\";\r\nimport { ChartMenuSettings } from \"./ChartMenuSettings\";\r\nimport { ChartMenuQuickys } from \"./ChartMenuQuickys\";\r\nimport { ChartMenuChart } from \"./ChartMenuChart\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    paper: {\r\n      minHeight: \"33%\",\r\n      border: \"1px solid #666\",\r\n      borderTopLeftRadius: 10,\r\n      borderTopRightRadius: 10,\r\n    },\r\n    paperDesktop: {\r\n      minHeight: \"33%\",\r\n      border: \"1px solid #666\",\r\n      borderBottomRightRadius: 10,\r\n      borderTopRightRadius: 10,\r\n    },\r\n  })\r\n);\r\n\r\nexport type CChartMenuOpenType =\r\n  | \"menu\"\r\n  | \"chart\"\r\n  | \"indicators\"\r\n  | \"tools\"\r\n  | \"settings\"\r\n  | \"quickys\"\r\n  | \"editIndicator\"\r\n  | \"editTool\"\r\n  | null;\r\n\r\nexport const CChartMenu2 = (props: {\r\n  open: CChartMenuOpenType;\r\n  onClose: () => void;\r\n  ChartState: CalculatedChartStateType;\r\n  onNavigate: (target: CChartMenuOpenType) => void;\r\n  ChartStateDispatch: ChartStateHookType[1];\r\n}) => {\r\n  const { onClose, open, ChartState, onNavigate, ChartStateDispatch } = props;\r\n  const theme = useTheme();\r\n  const isMinSm = useMediaQuery(\"(min-width:600px)\");\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <Drawer\r\n      anchor={!!isMinSm ? \"left\" : \"bottom\"}\r\n      open={!!open}\r\n      classes={{ paper: !!isMinSm ? classes.paperDesktop : classes.paper }}\r\n      ModalProps={{ hideBackdrop: true }}\r\n    >\r\n      <div style={{ background: theme.palette.primary.main, color: theme.palette.primary.contrastText, padding: 10 }}>\r\n        <Grid container alignItems=\"center\" justify=\"center\">\r\n          <Grid item>\r\n            <Typography component=\"div\" variant=\"h4\">\r\n              {open === \"quickys\"\r\n                ? \"Quick Tasks\"\r\n                : open === \"editIndicator\"\r\n                ? \"Edit Indicator\"\r\n                : open === \"indicators\"\r\n                ? \"Add Indicator\"\r\n                : open === \"editTool\"\r\n                ? \"Edit Tool\"\r\n                : open === \"tools\"\r\n                ? \"Add Tool\"\r\n                : open === \"settings\"\r\n                ? \"Settings\"\r\n                : \"Chart Menu\"}\r\n            </Typography>\r\n          </Grid>\r\n          <Grid item xs></Grid>\r\n          <Grid item>\r\n            <div style={{ height: \"2.6rem\" }}>\r\n              {!!open && open !== \"menu\" ? (\r\n                <IconButton\r\n                  size=\"small\"\r\n                  onClick={() => {\r\n                    onNavigate(\"menu\");\r\n                  }}\r\n                >\r\n                  <Icon path={mdiHome} size={1.75} color={theme.palette.primary.contrastText}></Icon>\r\n                </IconButton>\r\n              ) : null}\r\n\r\n              <IconButton\r\n                size=\"small\"\r\n                onClick={() => {\r\n                  //   onClose?.();\r\n                }}\r\n              >\r\n                <Icon path={mdiFullscreen} size={1.75} color={theme.palette.primary.contrastText}></Icon>\r\n              </IconButton>\r\n              <IconButton\r\n                size=\"small\"\r\n                onClick={() => {\r\n                  onClose?.();\r\n                }}\r\n              >\r\n                <Icon path={mdiClose} size={1.75} color={theme.palette.primary.contrastText}></Icon>\r\n              </IconButton>\r\n            </div>\r\n          </Grid>\r\n        </Grid>\r\n      </div>\r\n      <div style={{ padding: 10 }}>\r\n        {open === \"menu\" ? (\r\n          <ChartMenuHome ChartState={ChartState} onNavigate={onNavigate} />\r\n        ) : open === \"indicators\" || open === \"editIndicator\" ? (\r\n          <ChartMenuIndicators\r\n            ChartState={ChartState}\r\n            onNavigate={onNavigate}\r\n            open={open}\r\n            ChartStateDispatch={ChartStateDispatch}\r\n          />\r\n        ) : open === \"tools\" || open === \"editTool\" ? (\r\n          <ChartMenuTools\r\n            ChartState={ChartState}\r\n            ChartStateDispatch={ChartStateDispatch}\r\n            onNavigate={onNavigate}\r\n            open={open}\r\n          />\r\n        ) : open === \"settings\" ? (\r\n          <ChartMenuSettings ChartState={ChartState} ChartStateDispatch={ChartStateDispatch} onNavigate={onNavigate} />\r\n        ) : open === \"quickys\" ? (\r\n          <ChartMenuQuickys ChartState={ChartState} onNavigate={onNavigate} ChartStateDispatch={ChartStateDispatch} />\r\n        ) : open === \"chart\" ? (\r\n          <ChartMenuChart ChartState={ChartState} ChartStateDispatch={ChartStateDispatch} />\r\n        ) : null}\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};\r\n","import React, { RefObject } from \"react\";\r\nimport { Stage, Layer, Rect, Line, Shape } from \"react-konva\";\r\nimport {\r\n  CChartProps,\r\n  Dataset,\r\n} from \"./Types/CChartTypes\";\r\nimport { isIndicatorGraph } from \"./Types/CChartStateTypes\";\r\nimport Ajv from \"ajv\";\r\nimport { chartDataSchema } from \"./CChartDataSchema\";\r\nimport { CChartLabel } from \"./CChartLabel\";\r\nimport { CChartCrosshair } from \"./CChartCrosshair\";\r\n\r\nimport { CCandleChart } from \"./Charts/CCandleChart\";\r\nimport { CLineChart } from \"./Charts/CLineChart\";\r\nimport { CBarChart } from \"./Charts/CBarChart\";\r\nimport { ReducerActionType } from \"./ChartState/CChartStateReducer\";\r\nimport { useChartState } from \"./ChartState/CChartState\";\r\nimport { CTrendline } from \"./Tools/CTrendline\";\r\nimport { CVline } from \"./Tools/CVLine\";\r\nimport { CHline } from \"./Tools/CHLine\";\r\nimport { Button, ThemeProvider, Typography, useTheme } from \"@material-ui/core\";\r\n\r\nimport { muiTheme } from \"./MuiTheme\";\r\nimport { CChartMenu2, CChartMenuOpenType } from \"./Menu2/ChartMenu\";\r\nimport Icon from \"@mdi/react\";\r\nimport { mdiMenu } from \"@mdi/js\";\r\nconst ajv = new Ajv();\r\n\r\nexport const CChart = (props: CChartProps) => {\r\n  // get props + -> deviceRatio (does konva need that anymore?!)\r\n  const { width, height, chartData, style, viewMode } = props;\r\n  // responsive container and pointer events\r\n  let widthPerTick = 20;\r\n  const ContainerRef: RefObject<HTMLDivElement> = React.useRef(null);\r\n\r\n  const [ChartMenu2Open, setChartMenu2Open] = React.useState<CChartMenuOpenType>(null);\r\n  const [ChartState, ChartStateDispatch] = useChartState(ContainerRef, { width, height, viewMode });\r\n  widthPerTick = ChartState.xaxis.scaledWidthPerTick;\r\n  const { widthYAxis, widthTickmarkLines } = ChartState.yaxis;\r\n  const { heightXAxis, heightTickMarkLines } = ChartState.xaxis;\r\n  const containerWidth = ChartState.containerSize.width - 1;\r\n  const containerHeight = ChartState.containerSize.height - 1;\r\n  const isContainerInit = ChartState.containerSize.init;\r\n  // const theme = useTheme();\r\n\r\n  // const CanvasLayerCharts: React.RefObject<LayerType> = React.useRef(null);\r\n\r\n  // check chartData schema every time chartData is modified\r\n  React.useEffect(() => {\r\n    if (!isContainerInit) return;\r\n    const validate = ajv.compile(chartDataSchema);\r\n    const valid = validate(chartData);\r\n    if (!valid) {\r\n      alert(\"ERROR - chartData prop is not valid, check console\");\r\n      console.log(\"ERROR - chartData prop is not valid -> \", \"data:\", chartData, \"errors:\", validate.errors);\r\n    } else if (ChartState.subCharts.length === 0) {\r\n      const action: ReducerActionType<\"addSubchart\"> = {\r\n        task: \"addSubchart\",\r\n        params: { chartSeries: chartData[0].data, chartName: chartData[0].name, containerHeight },\r\n      };\r\n      (ChartStateDispatch as React.Dispatch<ReducerActionType<\"addSubchart\">>)(action);\r\n      // addSubchart(chartData[0].data, chartData[0].name, { indicatorFn: ATR, params: [14] });\r\n      // addSubchart(chartData[0].data, chartData[0].name, { indicatorFn: RSI, params: [14] });\r\n      // addGraph(chartData[0].data, chartData[0].name, 0, { indicatorFn: SMA, params: [10] });\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [chartData, ChartState.subCharts.length, containerHeight, isContainerInit, heightXAxis]);\r\n  const fullState = ChartState;\r\n\r\n  console.log(fullState);\r\n  const xAxis = fullState.xaxis.xAxisTicks;\r\n  return (\r\n    // <div style={{ width: \"100%\", height: \"100%\", position: \"fixed\", top: 0 }}>\r\n    <React.Fragment>\r\n      <ThemeProvider theme={muiTheme}>\r\n        <div //responsive container (above is not necessary)\r\n          ref={ContainerRef}\r\n          style={{\r\n            boxSizing: \"border-box\",\r\n            // width: !!width ? width : \"100%\",\r\n            // height: !!height ? height : \"100%\",\r\n            // width: \"100%\",\r\n            // height: \"100%\",\r\n            // position: \"fixed\",\r\n            border: \"1px solid red\",\r\n            background: fullState.backgroundColor,\r\n            // ...addContainerStyles,\r\n          }}\r\n        >\r\n          <Stage //konva container\r\n            width={ChartState.containerSize.width}\r\n            height={ChartState.containerSize.height}\r\n            listening={false}\r\n\r\n            // style={{ boxSizing: \"border-box\" }}\r\n          >\r\n            {/*  Canvas Layer 3 - chart and example */}\r\n            <Layer>\r\n              {/* <Rect\r\n              x={20 + ChartState.pointer.totalTranslatedX}\r\n              y={50 + ChartState.pointer.totalTranslatedY}\r\n              width={100}\r\n              height={100}\r\n              fill=\"red\"\r\n              shadowBlur={10}\r\n            /> */}\r\n              {0 in fullState.subCharts ? <CCandleChart fullState={fullState} /> : null}\r\n              {fullState.subCharts.map((subchart, subchartIdx) =>\r\n                subchart.yaxis.map((singleYaxis, singleYaxisIdx) =>\r\n                  singleYaxis.graphs.map((graph, graphIdx) => {\r\n                    const stateGraph = fullState.subCharts[subchartIdx].yaxis[0].graphs[graphIdx];\r\n                    // const type = stateGraph.type;\r\n                    const indicatorType = isIndicatorGraph(stateGraph) ? stateGraph.indicator.type : null;\r\n                    if (isIndicatorGraph(stateGraph) && stateGraph.data.length > 0) {\r\n                      const indicatorLines = stateGraph.data[stateGraph.data.length - 1].prices;\r\n\r\n                      if (indicatorType === \"line\") {\r\n                        return indicatorLines.map((indicatorDataSeries, indDataSeriesIdx) => (\r\n                          <CLineChart\r\n                            fullState={fullState}\r\n                            subchartIdx={subchartIdx}\r\n                            yaxisIdx={0}\r\n                            graphIdx={graphIdx}\r\n                            key={`${subchartIdx}-${graphIdx}-${indDataSeriesIdx}`}\r\n                            indSeriesIdx={indDataSeriesIdx}\r\n                          />\r\n                        ));\r\n                      } else if (indicatorType === \"bars\") {\r\n                        return (\r\n                          <CBarChart\r\n                            fullState={fullState}\r\n                            subchartIdx={subchartIdx}\r\n                            yaxisIdx={0}\r\n                            graphIdx={graphIdx}\r\n                            key={`${subchartIdx}-${graphIdx}`}\r\n                          />\r\n                        );\r\n                      }\r\n                    }\r\n                    return null;\r\n                  })\r\n                )\r\n              )}\r\n              {/* NEW TLINE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */}\r\n              {!!fullState.pointer.move.isMoving && fullState.draw.pixXy.length >= 1 ? (\r\n                <Line\r\n                  x={0}\r\n                  y={0}\r\n                  points={[\r\n                    fullState.draw.pixXy[0][0],\r\n                    fullState.draw.pixXy[0][1],\r\n                    !!fullState.pointer?.chartPointer.move.x\r\n                      ? fullState.methods.xToPix(fullState.pointer.chartPointer.move.x)\r\n                      : fullState.pointer.move.xy[0],\r\n                    !!fullState.pointer?.chartPointer?.move.snapDatasets?.[0]?.pixYSnap\r\n                      ? fullState.pointer?.chartPointer?.move.snapDatasets[0].pixYSnap\r\n                      : fullState.pointer.move.xy[1],\r\n                  ]}\r\n                  stroke={\"red\"}\r\n                  strokeWidth={1}\r\n                />\r\n              ) : null}\r\n              {/* EXISTING TLINES!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */}\r\n              {0 in fullState.subCharts\r\n                ? fullState.subCharts[0].yaxis[0].tools.map((tool, toolIdx) => {\r\n                    if (tool.type === \"trendline\" && tool.xy.length === 2)\r\n                      return (\r\n                        <CTrendline\r\n                          mode=\"trendline\"\r\n                          subchartTop={fullState.subCharts[0].top}\r\n                          subchartBottom={fullState.subCharts[0].bottom}\r\n                          pixXy={[\r\n                            [fullState.methods.xToPix(tool.xy[0][0]), fullState.methods.yToPix(tool.xy[0][1], 0, 0)],\r\n                            [fullState.methods.xToPix(tool.xy[1][0]), fullState.methods.yToPix(tool.xy[1][1], 0, 0)],\r\n                          ]}\r\n                          style={{ anchorColor: tool.style.anchorColor, strokeColor: tool.style.strokeColor }}\r\n                        />\r\n                      );\r\n                    else if (tool.type === \"vline\" && tool.xy.length === 1)\r\n                      return (\r\n                        <CVline\r\n                          mode=\"extendUpDown\"\r\n                          subchartTop={fullState.subCharts[0].top}\r\n                          subchartBottom={fullState.subCharts[0].bottom}\r\n                          pixXy={[\r\n                            [fullState.methods.xToPix(tool.xy[0][0]), fullState.methods.yToPix(tool.xy[0][1], 0, 0)],\r\n                          ]}\r\n                          style={{ anchorColor: tool.style.anchorColor, strokeColor: tool.style.strokeColor }}\r\n                        />\r\n                      );\r\n                    else if (tool.type === \"hline\" && tool.xy.length === 1)\r\n                      return (\r\n                        <CHline\r\n                          mode=\"extendLeftRight\"\r\n                          pixXstart={0}\r\n                          pixXend={fullState.containerSize.width - fullState.yaxis.widthYAxis}\r\n                          pixXy={[\r\n                            [fullState.methods.xToPix(tool.xy[0][0]), fullState.methods.yToPix(tool.xy[0][1], 0, 0)],\r\n                          ]}\r\n                          style={{ anchorColor: tool.style.anchorColor, strokeColor: tool.style.strokeColor }}\r\n                        />\r\n                      );\r\n                    else return null;\r\n                  })\r\n                : null}\r\n            </Layer>\r\n\r\n            {/*  Canvas Layer 5 (before 0) - axis bg rects + future chartbgcolor? */}\r\n            <Layer>\r\n              <Rect\r\n                x={0 + 0.5}\r\n                y={containerHeight - heightXAxis + 0.5}\r\n                width={containerWidth}\r\n                height={heightXAxis}\r\n                fill={ChartState.xaxis.style.fillColor}\r\n                stroke={ChartState.xaxis.style.strokeColor}\r\n                strokeWidth={1}\r\n              />\r\n              {fullState.subCharts.map((subchart, subchartIdx) => (\r\n                <React.Fragment key={subchartIdx}>\r\n                  <Rect\r\n                    // key={`subchartPrimaryYaxis-${subchartIdx}`}\r\n                    x={containerWidth - widthYAxis + 0.5}\r\n                    y={subchart.top + 0.5}\r\n                    width={widthYAxis}\r\n                    height={subchart.bottom - subchart.top}\r\n                    // fill={ChartState.xaxis.style.fillColor}\r\n                    stroke={ChartState.xaxis.style.strokeColor}\r\n                    strokeWidth={1}\r\n                  />\r\n                  <Rect\r\n                    // key={`subchartBorder-${subchartIdx}`}\r\n                    x={0 + 0.5}\r\n                    y={subchart.top + 0.5}\r\n                    width={containerWidth - widthYAxis}\r\n                    height={subchart.bottom - subchart.top}\r\n                    stroke={ChartState.xaxis.style.strokeColor}\r\n                    strokeWidth={1}\r\n                  />\r\n                </React.Fragment>\r\n              ))}\r\n            </Layer>\r\n            {/*  Canvas Layer 6 before 1 - x axis */}\r\n            <Layer>\r\n              {xAxis.map((xaxisTick, xaxisTickIdx) => {\r\n                return (\r\n                  <React.Fragment key={xaxisTickIdx}>\r\n                    <Line\r\n                      x={xaxisTick.x}\r\n                      y={ChartState.containerSize.height - 1 - heightXAxis + 0.5}\r\n                      points={[0, 0, 0, heightTickMarkLines]}\r\n                      stroke={ChartState.xaxis.style.strokeColor}\r\n                      strokeWidth={1}\r\n                    />\r\n                    {!!ChartState.grid.useGridX ? (\r\n                      <Line\r\n                        x={xaxisTick.x}\r\n                        y={0 + 0.5}\r\n                        points={[0, 0, 0, ChartState.containerSize.height - 1 - heightXAxis + 0.5]}\r\n                        stroke={ChartState.grid.style.strokeColor}\r\n                        strokeWidth={1}\r\n                      />\r\n                    ) : null}\r\n                    <Shape\r\n                      sceneFunc={(context, shape) => {\r\n                        // context.fillS\r\n                        const ctx = context._context;\r\n                        ctx.font = ChartState.xaxis.style.fontSize + \"px \" + ChartState.xaxis.style.fontName;\r\n                        ctx.fillStyle = ChartState.xaxis.style.fontColor;\r\n                        ctx.textAlign = \"center\";\r\n                        ctx.textBaseline = \"top\";\r\n                        ctx.fillText(\r\n                          xaxisTick.dateString,\r\n                          xaxisTick.x,\r\n                          ChartState.containerSize.height - 1 - heightXAxis + 0.5 + 20 + 5 // additional 5px distance to end of tickmark\r\n                        );\r\n                        // (!) Konva specific method, it is very important\r\n                        context.fillStrokeShape(shape);\r\n                      }}\r\n                      // fill=\"#333\"\r\n                      // stroke={ChartState.options.xAxis.style.fontColor}\r\n                      // strokeWidth={1}\r\n                    />\r\n                  </React.Fragment>\r\n                );\r\n              })}\r\n            </Layer>\r\n            {/*  Canvas Layer 7 before 2 - y axis */}\r\n            <Layer>\r\n              {fullState.subCharts.map((subchart, subchartIdx) => {\r\n                return subchart.yaxis.map((singleYaxis, singleYaxisIdx) => {\r\n                  const yAxisTicks = singleYaxis.drawTicks;\r\n\r\n                  // const yAxisTicks =\r\n                  //   subchartIdx === 0 ? subchart.yaxis[0] : subchart.yaxis[0].slice(0, subchart.yaxis[0].length - 1);\r\n                  return yAxisTicks.map((yaxisTick, yaxisTickIdx) => {\r\n                    return (\r\n                      <React.Fragment key={yaxisTick.label}>\r\n                        <Line\r\n                          x={ChartState.containerSize.width - 1 - widthYAxis + 0.5}\r\n                          y={yaxisTick.pixY + 0.5}\r\n                          points={[0, 0, widthTickmarkLines, 0]}\r\n                          stroke={ChartState.xaxis.style.strokeColor}\r\n                          strokeWidth={1}\r\n                        />\r\n                        {!!ChartState.grid.useGridY ? (\r\n                          <Line\r\n                            x={0 + 0.5}\r\n                            y={yaxisTick.pixY + 0.5}\r\n                            points={[0, 0, ChartState.containerSize.width - 1 + 0.5, 0]}\r\n                            stroke={ChartState.grid.style.strokeColor}\r\n                            strokeWidth={1}\r\n                          />\r\n                        ) : null}\r\n                        <Shape\r\n                          sceneFunc={(context, shape) => {\r\n                            // context.fillS\r\n                            const ctx = context._context;\r\n                            ctx.font = ChartState.yaxis.style.fontSize + \"px \" + ChartState.yaxis.style.fontName;\r\n                            ctx.fillStyle = ChartState.yaxis.style.fontColor;\r\n                            ctx.textAlign = \"left\";\r\n                            ctx.textBaseline = \"middle\";\r\n                            ctx.fillText(\r\n                              yaxisTick.label,\r\n                              ChartState.containerSize.width - 1 - widthYAxis + widthTickmarkLines + 5 + 0.5,\r\n                              yaxisTick.pixY // additional 5px distance to end of tickmark\r\n                            );\r\n                            // (!) Konva specific method, it is very important\r\n                            context.fillStrokeShape(shape);\r\n                          }}\r\n                        />\r\n                      </React.Fragment>\r\n                    );\r\n                  });\r\n                });\r\n              })}\r\n            </Layer>\r\n            {/*  Canvas Layer 4 - crosshair */}\r\n            <Layer>\r\n              {!!ChartState.pointer.move?.xy && !!ChartState.pointer.isHovering ? (\r\n                <CChartCrosshair fullState={fullState} />\r\n              ) : null}\r\n            </Layer>\r\n          </Stage>\r\n        </div>\r\n\r\n        {!!fullState.xaxis.xEnd && xAxis.length > 0\r\n          ? fullState.subCharts.map((subchart, subchartIdx) =>\r\n              subchart.yaxis[0].graphs.map((graph, graphIdx) => {\r\n                const name =\r\n                  isIndicatorGraph(graph) && graph.indicator.params.length > 0\r\n                    ? `${graph.indicator.name}(${graph.indicator.params[0].val})`\r\n                    : isIndicatorGraph(graph) && graph.indicator.params.length === 0\r\n                    ? `${graph.indicator.name}`\r\n                    : graph.name;\r\n                if (!graph.datasets.last) return null;\r\n\r\n                const tmpDataset: Dataset =\r\n                  (fullState.pointer.isHovering &&\r\n                  subchartIdx === fullState.pointer?.chartPointer?.move.subchartIdx &&\r\n                  fullState.pointer?.chartPointer?.move.snapDatasets?.[0]?.graphIdx === graphIdx\r\n                    ? fullState.pointer?.chartPointer?.move?.snapDatasets?.[0]?.data\r\n                    : fullState.pointer.isHovering &&\r\n                      // subchartIdx === fullState.pointer?.chartPointer?.move.subchartIdx &&\r\n                      fullState.pointer.chartPointer.move.x !== null\r\n                    ? graph.data[fullState.pointer.chartPointer.move.x]\r\n                    : graph.datasets.last.data) || graph.datasets.last.data;\r\n\r\n                return (\r\n                  <CChartLabel\r\n                    key={`${subchartIdx}-${graphIdx}`}\r\n                    onClick={() => setChartMenu2Open(\"settings\")}\r\n                    name={name}\r\n                    dataset={tmpDataset}\r\n                    decimals={\r\n                      isIndicatorGraph(graph) && graph.indicator.default.decimals !== undefined\r\n                        ? graph.indicator.default.decimals\r\n                        : graph.decimals\r\n                    }\r\n                    top={subchart.top + graphIdx * 30} // get height automatically!\r\n                  />\r\n                );\r\n              })\r\n            )\r\n          : null}\r\n        <div style={{ position: \"absolute\", top: (fullState.subCharts?.[0]?.bottom ?? 0) - 64 - 10, left: 10 }}>\r\n          <Button\r\n            color=\"primary\"\r\n            variant=\"contained\"\r\n            style={{ width: 64, height: 64, textTransform: \"none\", borderRadius: 5, opacity: 0.8 }}\r\n            onClick={() => setChartMenu2Open(\"menu\")}\r\n          >\r\n            <div style={{ position: \"relative\", top: 0, height: 64 }}>\r\n              <Icon path={mdiMenu} size=\"64px\" color=\"#fff\" />\r\n            </div>\r\n          </Button>\r\n        </div>\r\n\r\n        <CChartMenu2\r\n          open={ChartMenu2Open}\r\n          onClose={() => {\r\n            setChartMenu2Open(null);\r\n          }}\r\n          onNavigate={(target) => setChartMenu2Open(target)}\r\n          ChartState={fullState}\r\n          ChartStateDispatch={ChartStateDispatch}\r\n        />\r\n      </ThemeProvider>\r\n    </React.Fragment>\r\n    // </div>\r\n  );\r\n};\r\n","import React from \"react\";\nimport logo from \"./logo.svg\";\nimport \"./App.css\";\nimport { CChart } from \"./Chart/CChart\";\n\n\nconst parse = require(\"csv-parse/lib/sync\");\n\n// function parseData(pars: any) {\n//   return function (d: any) {\n//     d.date = parseDate(d.date);\n//     d.open = +d.open;\n//     d.high = +d.high;\n//     d.low = +d.low;\n//     d.close = +d.close;\n//     d.volume = +d.volume;\n\n//     return d;\n//   };\n// }\n// const parseDate = timeParse(\"%Y-%m-%d\");\n\nexport function getData() {\n  const promiseMSFT = fetch(\"https://raw.githubusercontent.com/carmnk/resources/main/data/csv/BAYN.DE.csv\")\n    .then((response) => {\n      return response.text();\n    })\n    .then((data) => {\n      //   console.log(data);\n      let res = parse(data, { delimiter: \",\", cast: true, trim: true, cast_date: true })\n        .map((dataset: any[]) => ({\n          date: dataset[0],\n          open: dataset[1],\n          high: dataset[2],\n          low: dataset[3],\n          close: dataset[4],\n          volume: dataset[5],\n        }));\n      res.shift();\n      return res\n    })\n    \n  return promiseMSFT;\n}\n\n// const Sub = (props: any) => {\n//   console.log(`Sub no ${props.id} rendered`);\n//   React.useLayoutEffect(() => {\n//     // console.log(`Sub no ${props.id} layout mounted`);\n//   }, []);\n//   React.useEffect(() => {\n//     console.log(`Sub no ${props.id} mounted`);\n//   }, []);\n//   // React.useEffect(() => {\n//   //   console.log(`Sub no ${props.id} loaded`);\n//   // })\n//   return (\n//     <div>\n//       {props.id}\n//       {props?.test?.toString()}\n//     </div>\n//   );\n// };\n// const Sub2 = (props: any) => {\n//   console.log(`Sub2 no ${props.id} rendered`);\n//   return (\n//     <div>\n//       {props.id} {!!props?.test?.is ? \"ja\" : \"nein\"}\n//       <Sub id={props.id * 10 + 1}></Sub>\n//     </div>\n//   );\n// };\n\n// const Main = (props: any) => {\n//   const [TestState, setTestState] = React.useState({ one: false, two: false, three: { is: false } });\n//   console.log(\"main rendered\");\n//   React.useLayoutEffect(() => {\n//     // console.log(`main layout mounted`);\n//   }, []);\n//   React.useEffect(() => {\n//     console.log(`main mounted`);\n//     // setTestState(current => { return ({...current, one: true}) })\n//   }, []);\n//   props.a.b = 2;\n//   // props.c = 3;\n//   console.log(props);\n//   return (\n//     <div>\n//       <Sub id={1} test={TestState.one}>\n//         <Sub id={11} />\n//       </Sub>\n//       <Sub id={2}>\n//         <Sub id={21} />\n//       </Sub>\n//       <Sub2 id={4} test={TestState.three}></Sub2>\n//       <button onClick={() => setTestState((current) => ({ ...current, three: { is: !current.three.is } }))}>\n//         SET IT\n//       </button>\n//     </div>\n//   );\n// };\n\nfunction App() {\n  const [Data, setData] = React.useState<any>(null);\n  const [W, setW] = React.useState(400);\n  React.useEffect(() => {\n    // parse()\n    getData().then((res) => setData(res));\n  }, []);\n\n  if (!Data) return null;\n  console.log(\"DATA:\", [{ data: Data, name: \"coolChart\" }]);\n\n  return (\n    <React.Fragment>\n      <div style={{ height: \"100%\" }}>\n        <CChart chartData={[{ data: Data, name: \"coolChart\" }]} viewMode=\"fullscreen\" style=\"TODO\" />\n      </div>\n      {/* <button style={{position: \"fixed\", top: 100}} onClick={() => {\n        console.log(\"YA\")\n        setW(800)\n      }}>AAAAAAAAAAAAAa</button> */}\n    </React.Fragment>\n    // <Main a={{ b: 1 }} c={0} />\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}